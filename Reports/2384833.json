{
  "id": 2384833,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMzg0ODMz",
  "url": "https://hackerone.com/reports/2384833",
  "title": "CVE-2024-2004: Usage of disabled protocol",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2024-02-21T19:56:12.005Z",
  "submitted_at": "2024-02-21T19:56:12.137Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "dfandrich",
    "url": "/dfandrich",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 35663,
    "url": "https://hackerone.com/curl",
    "handle": "curl",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "curl",
      "twitter_handle": "",
      "website": "https://curl.se",
      "about": "cURL is an Open Source project providing a library and command-line tool doing internet transfers"
    }
  },
  "has_bounty?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": true,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2024-2004"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2024-03-27T17:48:56.893Z",
  "bug_reporter_agreed_on_going_public_at": "2024-03-27T17:48:53.859Z",
  "team_member_agreed_on_going_public_at": "2024-03-27T07:23:21.958Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Summary:\n` --proto` in some circumstances ENABLES all protocols after being given `-all`, potentially leading to sending sensitive data over an unencrypted channel.\n\n## Steps To Reproduce:\n`curl -Ivs --proto -all,-http http://curl.se`\nThis command should result in `curl: (1) Protocol \"http\" disabled` but it actually succeeds.\n\n## Supporting Material/References:\nThe example command above performs a request to curl.se over http, despite being http support being disabled, both implicitly (-all) and explicitly (-http).  It appears that a `--proto` string starting with `-all` and only ever removes protocols without adding them fails in this way. For example:\n\nExample failure scenarios (allowing ALL protocols to go through):\n```\n--proto -all\n--proto -all,-http\n--proto -all,-ftp,-smtp,-pop3\n```\nExample correct scenarios (behaving as documented):\n```\n--proto -all,https\n--proto -all,https,-http\n--proto -all,-ftp,-smtp,-pop3,pop3s\n--proto -http\n```\nThe only failure scenarios I could find were those that first removed all protocols with -all, then (optionally) removed additional, individual\nprotocols, and never added any. The documented behaviour for this would be to fail ALL curl transfers, so it shouldn't happen anywhere in production\nsituations (since generally people want to do transfers with curl). However, I could still imagine it happening, such as when the list of allowed protocols is programmatically computed in a system where a particular situation should not allow any transfers. But this bug means that transfers would go ahead, anyway.\n\nIn a situation where something is relying on curl to block an unencrypted transfer, the consequences of this bug can be pretty severe (unencrypted data travelling over the Internet) and therefore High severity. On the other hand, IF this is the only situation where this bug occurs (where all protocols are supposed to be disabled), then I'm guessing this generally pretty uncommon and therefore Medium or even Low may be more appropriate. It's hard to know if anyone is relying on this.\n\nI bisected the problem to [this commit]( https://github.com/curl/curl/commit/e6f8445edef8e7996d1cfb141d6df184efef972c) which was released in 7.85.0 and introduced string-based protocol selection:\n```\ne6f8445edef8e7996d1cfb141d6df184efef972c is the first bad commit\ncommit e6f8445edef8e7996d1cfb141d6df184efef972c\nAuthor: Daniel Stenberg <daniel@haxx.se>\nDate:   Mon Jun 13 09:30:45 2022 +0200\n\n    setopt: add CURLOPT_PROTOCOLS_STR and CURLOPT_REDIR_PROTOCOLS_STR\n\n    ... as replacements for deprecated CURLOPT_PROTOCOLS and\n    CURLOPT_REDIR_PROTOCOLS as these new ones do not risk running into the\n    32 bit limit the old ones are facing.\n\n    CURLINFO_PROTCOOL is now deprecated.\n\n    The curl tool is updated to use the new options.\n\n    Added test 1597 to verify the libcurl protocol parser.\n\n    Closes #8992\n```\nI discovered it while replying to https://github.com/curl/curl/issues/12942\n\nAn example test case to show the problem is attached.\n\n## Impact\n\nData can be sent over an unencrypted channel because curl'ls mechanism to prevent it does not work.",
  "weakness": {
    "id": 266,
    "name": "Misinterpretation of Input"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 3066810,
      "file_name": "test1684",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/a7vky4g7kwre2549qpudy1d2q4m4?response-content-disposition=attachment%3B%20filename%3D%22test1684%22%3B%20filename%2A%3DUTF-8%27%27test1684&response-content-type=application%2Foctet-stream&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ65VHY4Z7%2F20250920%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250920T190857Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQCyg%2B5Ssf9GRU59%2Bkync2bOt7x6A4WYOE2EWe8N9ua8DgIgSNulINmRAv2Bt0wwr8UYwa5xpgMH6LtJxEneNLUcFRsqugUI8f%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDOTz%2FpGvx8cQysomJiqOBS99Jtfa15bKJomjTK5QnIoppnlQkyD4rjs%2FsJTgjQoYAXbWi7xejVNGhvBzQi4ad2dUQIYFs7OAzdT%2FUllZvMfuZpYyWOg3l04gn1q%2BRyvMLsBr%2FbOr%2BqcwAlNBKJpnd%2BgSEHRk1fsnuCuN1whhpTdUc6mxHlyDoEnZDNZKENrXz7QOuc2yv9ZXCJE%2BmssW9ffIQK3n%2FlQOeh31Ss2Wlrp1TQSVOxUFVgGA2G%2BXb7THpC7A9IZN7juETY1FNPV2ve52kdkpdpl9yphdTxuVrxvd5AYAhkzMmBXxEwR1Cj1yovx0IunZaV879Bazbm%2BcfHZgwys5Qat2muSFv9NFAiayu63r9kkgSXKRgJTBSo27EVJ0hLPmeHl5pSs3%2B3z7Rz3K2JTWBJKacaNrY4ityJHG0lChY3AiUUEQfm6FH56HSdUCzlRhCgRXw7vHnhxfH8Pm2LwZpJ1qxaE%2ByXIQZ%2Fbkdw8aXV5z5Idg213EEC0ILR4vgn1Orzbwl0g1%2FrOTESYLHasy0wcLKIa7%2Bx5GsybsaztcM%2FaeDIkgmyDHrE8dmUM4OGGoFrEiLptvi4ipQTfOnZv%2FW8L0DmN1mCew0ZGuLQoDefflIXeN3js453tCYkgw47FLq5o3XWx7t83rShJXDkk9Z67O91QPdHoajRK2WUBEfSdSx0K4ZP%2BUUnEyFH7UNpgQ0RGtT1YKDRo6DnWUZNpFUV72FrTG%2B%2B%2BWhirUXxnwzxtN49el9oy%2B6Zp%2FjfTVEDNdGnKmLX4Rp5BzUPGHXo9%2F2M76%2Fo9gaYWPekSq%2B%2FGwN9jyRLHBAVa1AwiFHx8rdMSBE9uFPnYCooXI%2BCZoWzutS%2B%2B6zqgl2eAD1hzd7%2FXRzzh9u64VTZ3tijDbnrvGBjqxARFf0E54%2BgdK7Dqw81sRnbmFvMlT3dHf%2BiqrwGKs4KOFIaHkwmBzOVE3vpsUIrNUgO920xXt4Wxnl%2BYVYIiB%2BzXNbT46JlZcZk%2FbfkQJG9TKQLeemXNwhR3OPAW0ypnaTobqy2zzn8d3dbTbKWbz5CaaRn%2B%2BgyNRP2zWb6y7hi4GhpVQS4%2FKbVxoNvkNg6OpFGsFaCjVmQzDmM300a0zrZ2shsdclYZacrrYxRPYPrAzDg%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=2039ee64e0d9a5833b11fc32c3546f52385b8543f87d541d65664ccba6d3b00f",
      "file_size": 471,
      "type": "application/octet-stream",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": "2024-04-26T07:23:22.207Z",
  "allow_singular_disclosure_after": -44279135.69266537,
  "singular_disclosure_allowed": true,
  "vote_count": 33,
  "voters": [
    "exec_iq",
    "zy9ard3",
    "thalaivar304",
    "cyborg_m",
    "0xdead4f",
    "kichukishor",
    "swarnimbandekar",
    "sushant102",
    "justmvg",
    "edra",
    "and 23 more..."
  ],
  "severity": {
    "rating": "low",
    "author_type": "Team"
  },
  "structured_scope": {
    "databaseId": 18844,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/curl/curl",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
