{
  "id": 3027461,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMDI3NDYx",
  "url": "https://hackerone.com/reports/3027461",
  "title": "Bypass of Cloudflare's Cache Keys and WAF via header overflow",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "high",
  "readable_substate": "Resolved",
  "created_at": "2025-03-10T00:38:34.290Z",
  "submitted_at": "2025-03-12T09:03:39.767Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "david96",
    "url": "/david96",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/wjl8x8j5266ivnffkyj8nbem61j4/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 41,
    "url": "https://hackerone.com/cloudflare",
    "handle": "cloudflare",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/041/a819f0d518a4854df667be26210167805f38a6a4_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Cloudflare Public Bug Bounty",
      "twitter_handle": "cloudflare",
      "website": "https://www.cloudflare.com/disclosure",
      "about": "Help us build a better Internet"
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": true,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "no-content",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2025-11-18T08:08:43.770Z",
  "bug_reporter_agreed_on_going_public_at": "2025-06-20T15:07:10.624Z",
  "team_member_agreed_on_going_public_at": "2025-11-18T08:08:43.138Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "",
  "weakness": {
    "id": 26,
    "name": "Improper Access Control - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 3,
  "voters": [
    "david96",
    "n1m0",
    "2026"
  ],
  "severity": {
    "rating": "high",
    "author_type": "Team"
  },
  "structured_scope": {
    "databaseId": 548858,
    "asset_type": "OTHER",
    "asset_identifier": "Cloudflare Cache ",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 713202,
      "category": "team",
      "content": "A limitation in our HTTP request header parsing in Front Line (FL) processing enables attackers to bypass defined rulesets. The maximum amount of headers being parsed by openresty is 100 HTTP headers including internal ones. This problem applies to any ruleset on HTTP headers. Attackers are able to bypass for instance WAF rules and perform cache forcing/poisoning. Our WAF team implemented a global rule to block, when too many headers were provided (https://developers.cloudflare.com/changelog/2025-10-20-waf-release/), which is recommended to be enabled.\nWe want to emphasize that https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/http.request.headers.truncated/ indicates if rulesets is not seeing all the request headers. Moreover, the length problem of parsed HTTP headers will be mitigated with the rollout of our new Front Line implementation.",
      "updated_at": "2025-10-27T15:47:49.612Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 2841975,
        "username": "mschwarzl",
        "name": "Martin Schwarzl",
        "bio": null,
        "cleared": false,
        "verified": false,
        "website": null,
        "location": null,
        "created_at": "2023-08-01T08:53:10.302Z",
        "url": "https://hackerone.com/mschwarzl",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png",
          "medium": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png",
          "xtralarge": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
        }
      }
    },
    {
      "id": 651774,
      "category": "researcher",
      "content": "\n# Summary\n\nA vulnerability in HTTP request header processing allowed attackers to exploit cache poisoning attacks on all Cloudflare customers. By appending a keyed header after an overflow triggered by exceeding ``94`` headers, attackers could manipulate cache behavior.\n- The vulnerability enabled attackers to bypass Cloudflare’s Cache Key configuration, refer to [Cloudflare Cache Key documentation](https://developers.cloudflare.com/cache/how-to/cache-keys/). Both custom and default keyed headers were excluded from the Cache Key evaluation when the header count exceeded ``94``.\n\n- This also allowed attackers to force caching of assets not intended for caching, bypassing [Cache Rules](https://developers.cloudflare.com/cache/how-to/cache-rules/). For example, responses configured to avoid caching based on specific headers or cookies were cached.\n\n- When the header count surpassed ``94``, Cloudflare’s evaluation of Cache Rules, Custom Cache Keys, and Default Cache Keys ceased.\n\ne.g\n\n```\n[94+ headers with arbitrary data]\n1: 1\n1: 1\n1: 1\n1: 1\n1: 1\n1: 1\nX-HTTP-Method-Override: HEAD\nHost: victim.com\n...\n```\n\nAttackers could add a header initially in the cache key (e.g., ``X-HTTP-Method-Override``) to manipulate the response and cache incorrect or malicious content to be served in subsequent responses. \n\nThis led to cache poisoning denial of service, and stored XSS attacks.\n\n## WAF Bypass\n\nAttackers could also bypass Cloudflare’s Web Application Firewall (WAF) and both [custom and managed firewall rules](https://developers.cloudflare.com/waf/custom-rules/), allowing malicious requests to reach the origin server uninspected.\n\nThis vulnerability could be exploited to achieve stored XSS through cache poisoning and WAF bypass. For example, consider a website with a strict rule that prohibits closing tags (e.g., ``</tag>``) and reflects the ``User-Agent`` header in its responses. The website's WAF returns a 403 error page if the request lacks the header overflow. By manipulating the ``User-Agent`` an attacker could chain these issues to  poison the cache, and achieve stored XSS.\n\n```\n[94+ headers with arbitrary data]\n1: 1\n1: 1\n1: 1\n1: 1\n1: 1\n1: 1\nUser-Agent: </script><svg onload=alert(1)>\nHost: victim.com\n...\n```\n\n##Current Front Line (FL) Behavior: \n\nAs noted in the Cloudflare Ruleset Engine documentation, the current Front Line does not mitigate this issue. Header truncation detection (``http.request.headers.truncated``) is recommended to identify and block requests with excessive headers: https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/http.request.headers.truncated/\n\n> Hi @david96,\nw.r.t WAF bypass - the behavior will stay like this with the current Front Line (FL):\nhttps://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/http.request.headers.truncated/\nAfter a full migration to our new Front Line layer, WAF will have the capability to inspect/block all headers...\n\n\n## This report was awarded _$1,250_\n",
      "updated_at": "2025-06-23T12:20:47.447Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 727340,
        "username": "david96",
        "name": "David",
        "bio": "Be humble",
        "cleared": true,
        "verified": true,
        "website": null,
        "location": "Spain",
        "created_at": "2019-08-31T18:21:47.992Z",
        "url": "https://hackerone.com/david96",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/wjl8x8j5266ivnffkyj8nbem61j4/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/wjl8x8j5266ivnffkyj8nbem61j4/d9695107bfcd68eeb1c9e0912b109cdae9a6c00c0bda6fd4cbd6d9bdb828840a",
          "xtralarge": "https://profile-photos.hackerone-user-content.com/variants/wjl8x8j5266ivnffkyj8nbem61j4/4ac84fbe897190579a137d0cf55152b233cdd4f9984435bd80ef67e5e51a0586"
        }
      }
    }
  ]
}
