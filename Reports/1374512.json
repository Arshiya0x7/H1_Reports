{
  "id": 1374512,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMzc0NTEy",
  "url": "https://hackerone.com/reports/1374512",
  "title": "The Host Authorization middleware in Action Pack is vulnerable to crafted X-Forwarded-Host values",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2021-10-19T18:33:36.000Z",
  "submitted_at": "2021-10-19T18:33:36.091Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "mshtawythug",
    "url": "/mshtawythug",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/1vnmq8y40a9fs6obyeyz6nhsl2cp/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef?response-content-disposition=inline%3B%20filename%3D%22FB_IMG_1633561087152.jpg%22%3B%20filename%2A%3DUTF-8%27%27FB_IMG_1633561087152.jpg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ35T6K4IF%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T010545Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEH0aCXVzLXdlc3QtMiJHMEUCIQDPEAvaZ%2FvLeuRoaLfLXdA6mmt8NeE4EcHMdEnKiQYxBAIgQAcR7QaOvsWqFUoty3eI9NBYZ9edyOn035ycgCkKuWwqugUI9v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDJbxesrBYe2kzIoHRyqOBcinJjA8aAlm%2Bnvs4nWgO3kcLGwKWP5isvckwVvjix03%2B1XZ3O1hBseTxJ5o79VmQtVbCVHNop1oSaebb0Y%2FIBB31Zt%2FJ3tqNSSpoaADaLyP06r8cJJcf%2B6O9gf6Tfz5o%2BxsVcCm10hyrLmxoEjB7JcIJbJkNbTdPOMRXTv6GNta22Qh%2FhCA8HfxLnJohYN1tHs06Fw84zZxZgFfoi%2F%2BpF1YBf%2BigqM9iRmLbRalo4ueuaA1Oclt9ovcTPq5L8e3qmDekZwQOuQVgSJvMc%2BQWFyC14JJRA%2Fx4uRc9MdCBwEwBVwZOLh5PldpQl2jUhs5ST7UkCNpFfGqxKITQg1xsyKbpu6JmKWcXV951x%2BIjsfvGQkMBL13OQYbo%2FDBY%2Fy5zVsZZ0WpTojg5bVdppmVn%2FjTtzOrpf%2B%2BVYHD7EGdVb5HkeiRpN43gCHJ4snOdrd7UinO5O6gKWEqcOVn%2FZjiCo8IVqrZ6asbJkPD5vtbcfdZPwv4abHGyC651WavF1cOEnyJqxd0gz6IqleLZrSz2kntoisyN40PCMqYBIQ8RYxntGtqvxATlSIEslv4EkgyrkGkL9bcNePvbTccSxUP%2Bo8%2FyHOVtKWpXu%2FphJhIcdO1XzB4kZcd4x%2BGi2FADPz32SmIatRtdDC6vE%2FjMCScFaMvUeKfU5wHSffSk6TDyGCLlQzf5VyyhTzlDRIJeZOJFE7h%2Biuqf1SFkp%2FUbA7TLcJ5shBQJr2QKU6q%2Fnjdlnn%2B95PGhqbrTYmL4TtK0ZtXaka76ZaWo0sWdAg6IoPzcHyy9l3DiveHaLsZTefPenK2stD%2B5QpgpfTzbKf%2FvDd0Hyc3nAWvIkQrJUT6FoBwJ%2B%2FyNjSp21H%2FvxuMMOCwyDCss7zGBjqxAfNFlg7BnOWu2lX%2Fx3HSk3PERI%2FQdO2VFtK4FpK06GICCytDslgE9kzLlsEfs1kcNEO447iWMAjBsJPvUcGfEvmEWMYacCxlNw2SmfUP9%2FEwlQ2uofGYc5klI2uwBY7ykPvx0kA6fh1kOMY1h%2Btv%2Blrshwzi78hWKf83FJn4T2%2Fd%2FFsGrE5EhqR96Vtccl%2BXucm67xB81IRw4ruJmKA1muxa5hWLQryQ0MY3%2B%2FRPbsaiIg%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=324a09e9b51c4882b34895fc25810cdb87ee276319ed9ef59f341d6e09338e09"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ35T6K4IF%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T010545Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEH0aCXVzLXdlc3QtMiJHMEUCIQDPEAvaZ%2FvLeuRoaLfLXdA6mmt8NeE4EcHMdEnKiQYxBAIgQAcR7QaOvsWqFUoty3eI9NBYZ9edyOn035ycgCkKuWwqugUI9v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDJbxesrBYe2kzIoHRyqOBcinJjA8aAlm%2Bnvs4nWgO3kcLGwKWP5isvckwVvjix03%2B1XZ3O1hBseTxJ5o79VmQtVbCVHNop1oSaebb0Y%2FIBB31Zt%2FJ3tqNSSpoaADaLyP06r8cJJcf%2B6O9gf6Tfz5o%2BxsVcCm10hyrLmxoEjB7JcIJbJkNbTdPOMRXTv6GNta22Qh%2FhCA8HfxLnJohYN1tHs06Fw84zZxZgFfoi%2F%2BpF1YBf%2BigqM9iRmLbRalo4ueuaA1Oclt9ovcTPq5L8e3qmDekZwQOuQVgSJvMc%2BQWFyC14JJRA%2Fx4uRc9MdCBwEwBVwZOLh5PldpQl2jUhs5ST7UkCNpFfGqxKITQg1xsyKbpu6JmKWcXV951x%2BIjsfvGQkMBL13OQYbo%2FDBY%2Fy5zVsZZ0WpTojg5bVdppmVn%2FjTtzOrpf%2B%2BVYHD7EGdVb5HkeiRpN43gCHJ4snOdrd7UinO5O6gKWEqcOVn%2FZjiCo8IVqrZ6asbJkPD5vtbcfdZPwv4abHGyC651WavF1cOEnyJqxd0gz6IqleLZrSz2kntoisyN40PCMqYBIQ8RYxntGtqvxATlSIEslv4EkgyrkGkL9bcNePvbTccSxUP%2Bo8%2FyHOVtKWpXu%2FphJhIcdO1XzB4kZcd4x%2BGi2FADPz32SmIatRtdDC6vE%2FjMCScFaMvUeKfU5wHSffSk6TDyGCLlQzf5VyyhTzlDRIJeZOJFE7h%2Biuqf1SFkp%2FUbA7TLcJ5shBQJr2QKU6q%2Fnjdlnn%2B95PGhqbrTYmL4TtK0ZtXaka76ZaWo0sWdAg6IoPzcHyy9l3DiveHaLsZTefPenK2stD%2B5QpgpfTzbKf%2FvDd0Hyc3nAWvIkQrJUT6FoBwJ%2B%2FyNjSp21H%2FvxuMMOCwyDCss7zGBjqxAfNFlg7BnOWu2lX%2Fx3HSk3PERI%2FQdO2VFtK4FpK06GICCytDslgE9kzLlsEfs1kcNEO447iWMAjBsJPvUcGfEvmEWMYacCxlNw2SmfUP9%2FEwlQ2uofGYc5klI2uwBY7ykPvx0kA6fh1kOMY1h%2Btv%2Blrshwzi78hWKf83FJn4T2%2Fd%2FFsGrE5EhqR96Vtccl%2BXucm67xB81IRw4ruJmKA1muxa5hWLQryQ0MY3%2B%2FRPbsaiIg%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=477719b68342cf15f3ea336958409758151724885b422c29fac9cab7eec83f56",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ35T6K4IF%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T010545Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEH0aCXVzLXdlc3QtMiJHMEUCIQDPEAvaZ%2FvLeuRoaLfLXdA6mmt8NeE4EcHMdEnKiQYxBAIgQAcR7QaOvsWqFUoty3eI9NBYZ9edyOn035ycgCkKuWwqugUI9v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDJbxesrBYe2kzIoHRyqOBcinJjA8aAlm%2Bnvs4nWgO3kcLGwKWP5isvckwVvjix03%2B1XZ3O1hBseTxJ5o79VmQtVbCVHNop1oSaebb0Y%2FIBB31Zt%2FJ3tqNSSpoaADaLyP06r8cJJcf%2B6O9gf6Tfz5o%2BxsVcCm10hyrLmxoEjB7JcIJbJkNbTdPOMRXTv6GNta22Qh%2FhCA8HfxLnJohYN1tHs06Fw84zZxZgFfoi%2F%2BpF1YBf%2BigqM9iRmLbRalo4ueuaA1Oclt9ovcTPq5L8e3qmDekZwQOuQVgSJvMc%2BQWFyC14JJRA%2Fx4uRc9MdCBwEwBVwZOLh5PldpQl2jUhs5ST7UkCNpFfGqxKITQg1xsyKbpu6JmKWcXV951x%2BIjsfvGQkMBL13OQYbo%2FDBY%2Fy5zVsZZ0WpTojg5bVdppmVn%2FjTtzOrpf%2B%2BVYHD7EGdVb5HkeiRpN43gCHJ4snOdrd7UinO5O6gKWEqcOVn%2FZjiCo8IVqrZ6asbJkPD5vtbcfdZPwv4abHGyC651WavF1cOEnyJqxd0gz6IqleLZrSz2kntoisyN40PCMqYBIQ8RYxntGtqvxATlSIEslv4EkgyrkGkL9bcNePvbTccSxUP%2Bo8%2FyHOVtKWpXu%2FphJhIcdO1XzB4kZcd4x%2BGi2FADPz32SmIatRtdDC6vE%2FjMCScFaMvUeKfU5wHSffSk6TDyGCLlQzf5VyyhTzlDRIJeZOJFE7h%2Biuqf1SFkp%2FUbA7TLcJ5shBQJr2QKU6q%2Fnjdlnn%2B95PGhqbrTYmL4TtK0ZtXaka76ZaWo0sWdAg6IoPzcHyy9l3DiveHaLsZTefPenK2stD%2B5QpgpfTzbKf%2FvDd0Hyc3nAWvIkQrJUT6FoBwJ%2B%2FyNjSp21H%2FvxuMMOCwyDCss7zGBjqxAfNFlg7BnOWu2lX%2Fx3HSk3PERI%2FQdO2VFtK4FpK06GICCytDslgE9kzLlsEfs1kcNEO447iWMAjBsJPvUcGfEvmEWMYacCxlNw2SmfUP9%2FEwlQ2uofGYc5klI2uwBY7ykPvx0kA6fh1kOMY1h%2Btv%2Blrshwzi78hWKf83FJn4T2%2Fd%2FFsGrE5EhqR96Vtccl%2BXucm67xB81IRw4ruJmKA1muxa5hWLQryQ0MY3%2B%2FRPbsaiIg%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=ec7b0046cc32cd470cce50e40ac8c1a52c80f23abf24333b7165a0085248c1c5"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2021-22942"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2021-11-18T21:03:04.941Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2021-10-19T21:02:46.555Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Title:         The Host Authorization middleware in Action Pack is vulnerable to crafted X-Forwarded-Host values\nScope:         https://github.com/rails/rails\nWeakness:      Open Redirect\nSeverity:      Medium\nLink:          https://hackerone.com/reports/1189310\nDate:          2021-05-09 06:29:19 +0000\nBy:            @mshtawy\nCVE IDs:       CVE-2021-22942, CVE-2021-22881\n\nDetails:\n### Steps to reproduce\nThis is a follow up to  [CVE-2021-22881](https://github.com/advisories/GHSA-8877-prq4-9xfw) and  https://github.com/rails/rails/commit/83a6ac3fee8fd538ce7e0088913ff54f0f9bcb6f\n\nwith a controller like the following\n```ruby\nclass TestsController < ApplicationController\n  extend ActiveSupport::Concern\n\n  def index\n    redirect_to('/')\n  end\nend\n```\nwhen sending a request like the following where the URL has a mixed case characters \n``` bash\ncurl 'http://localhost:3000/tests' -H 'X-Forwarded-Host: Evil.com'\n```\nOr all capital case \n``` bash\ncurl 'http://localhost:3000/tests' -H 'X-Forwarded-Host: EVIL.COM'\n```\n\n### Expected behavior\n```html\n<div id=\"container\">\n  <h2>To allow requests to evil.com, add the following to your environment configuration:</h2>\n  <pre>config.hosts &lt;&lt; \"Evil.com\"</pre>\n</div>\n```\n\n### Actual behavior\n```html\n<html><body>You are being <a href=\"http://Evil.com/\">redirected</a>.</body></html>% \n```\n\n### System configuration\n**Rails version**: \nTested on Rails 6.1.3.1 and Rails 6.1.3.2\n**Ruby version**:\nN/A\n\n### Notes\n\nThis was fixed in `main` in this PR https://github.com/rails/rails/pull/41435 but still affects <= 6.1.3.1 \n\nThe problem is in this code https://github.com/rails/rails/blob/6-1-stable/actionpack/lib/action_dispatch/middleware/host_authorization.rb#L115\n\n``` ruby\norigin_host = valid_host.match(\n  request.get_header(\"HTTP_HOST\").to_s.downcase)\nforwarded_host = valid_host.match(\n  request.x_forwarded_host.to_s.split(/,\\s?/).last)\n```\n\n`forwarded_host` is missing a `downcase` after the `.to_s`, which results in `nil` assigned to `forwarded_host`, which then results in `true` in the following  code\n```ruby\norigin_host && @permissions.allows?(origin_host[:host]) && (forwarded_host.nil? || @permissions.allows?(forwarded_host[:host]))\n```\nbecause of the `nil?` check on the `forwarded_host`\n```ruby\nforwarded_host.nil? || @permissions.allows?(forwarded_host[:host])\n```\n\nThe examples I gave are using `localhost`, but I also confirmed this using a production environment with a configuration like the following\n\n```ruby\n    Rails.application.config.hosts = %w(.EXAMPLE.com)\n```\n\n## Impact\n\nHackers can redirect victims to a malicious website.\n\nTimeline:\n2021-08-03 20:27:55 +0000: @tenderlove (bug triaged)\n\n\n---\n\n2021-09-07 20:30:35 +0000: @tenderlove (cve id added)\n\n\n---\n\n2021-10-05 20:37:19 +0000: @tenderlove (bug resolved)\n\n## Impact\n\nHackers can redirect victims to a malicious website.",
  "weakness": {
    "id": 53,
    "name": "Open Redirect"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2021-11-18T21:02:47.371Z",
  "allow_singular_disclosure_after": -121147378.34061222,
  "singular_disclosure_allowed": true,
  "vote_count": 9,
  "voters": [
    "fqdn",
    "akashhamal0x01",
    "spaghettisec",
    "khizer47",
    "pr0f0x01",
    "onorbayar",
    "meispi",
    "testwlp",
    "sajal010x"
  ],
  "severity": {
    "rating": "medium",
    "author_type": "User"
  },
  "structured_scope": {
    "databaseId": 80881,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/rails",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
