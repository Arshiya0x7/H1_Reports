{
  "id": 3328291,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMzI4Mjkx",
  "url": "https://hackerone.com/reports/3328291",
  "title": "Existence of completed pods allows for bypass of Kubernetes NetworkPolicy",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2025-09-05T11:23:38.370Z",
  "submitted_at": "2025-09-05T11:23:38.612Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "is_triager?": false,
  "reporter": {
    "disabled": false,
    "username": "savannabungee",
    "url": "/savannabungee",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 84809,
    "url": "https://hackerone.com/aws_vdp",
    "handle": "aws_vdp",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/fgfqam8gl7lzo8u8v0kiphkxfyt8/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/fgfqam8gl7lzo8u8v0kiphkxfyt8/d9695107bfcd68eeb1c9e0912b109cdae9a6c00c0bda6fd4cbd6d9bdb828840a"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": false,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "AWS VDP",
      "twitter_handle": "amazon",
      "website": "https://aws.amazon.com/",
      "about": "Amazon Web Services (AWS) is a secure cloud services platform, offering compute power and other functionality to help businesses scale and grow. "
    }
  },
  "has_bounty?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2025-11-19T23:05:18.521Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2025-11-19T22:59:57.606Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "# Description\n\nThe Amazon VPC CNI controller, when configured to manage NetworkPolicy rules, will incorrectly apply firewall rules for Completed pods as if the pods are still running, causing these rules to be applied to other unrelated pods that happen to receive the same IP address as a Completed pod.\n\nFor example, if you have a pod A with IP address X. Pod A is allowed some access via NetworkPolicy, which the VPC CNI controller effects by adding firewall rules on nodes for IP address X. When Pod A finished (for example if it's a Job) these firewall rules are not removed. As the pod is finished other pods are free to receive the same IP address. If pod B which is not granted any access by NetworkPolicy is assigned the same IP address X, then pod B will inherit the network access pod A had, until the Completed pod A is deleted.\n\nThe correct behavior would be to check for pod completion and treat pod completion the same as pod deletion, removing firewall rules when a pod is finished.\n\n# Affected versions\n\nI tested this on EKS version 1.33:\n* With auto mode with the [network policy controller enabled](https://docs.aws.amazon.com/eks/latest/userguide/auto-net-pol.html)\n* Without auto mode, with VPC CNI add-on v1.19.5-eksbuild.1\n* Without auto mode, with VPC CNI add-on v1.20.1-eksbuild.3\nStrict mode does not have any effect.\n\n# POC\n\nOn an EKS cluster with auto mode enabled, or the VPC CNI controller with `enableNetworkPolicy` set to true, apply the following preparatory Kubernetes resources:\n```\n---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: networkpolicy-test\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: whoami\n  namespace: networkpolicy-test\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: whoami\n  template:\n    metadata:\n      labels:\n        app: whoami\n    spec:\n      containers:\n        - name: whoami\n          image: traefik/whoami:latest\n          ports:\n            - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: whoami\nspec:\n  ports:\n    - port: 80\n      targetPort: 80\n      protocol: TCP\n  selector:\n    app: whoami\n---\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: ingress\n  namespace: networkpolicy-test\nspec:\n  podSelector: {}\n  policyTypes:\n  - Ingress\n  ingress:\n  - from:\n    - podSelector:\n        matchLabels:\n          test: allowed\n    ports:\n    - protocol: TCP\n      port: 80\n```\nThis NetworkPolicy configuration will allow the following Job to connect to the Deployment\n```\n---\napiVersion: batch/v1\nkind: Job\nmetadata:\n  name: allowed\n  namespace: networkpolicy-test\nspec:\n  template:\n    metadata:\n      name: curl\n      labels:\n        test: allowed\n    spec:\n      containers:\n        - name: curl\n          image: \"alpine/curl:latest\"\n          command: [\"curl\", \"-v\", \"whoami.networkpolicy-test.svc.cluster.local:80\"]\n      restartPolicy: Never\n```\nbut the following Job will be blocked and time out:\n```\n---\napiVersion: batch/v1\nkind: Job\nmetadata:\n  name: blocked\n  namespace: networkpolicy-test\nspec:\n  template:\n    metadata:\n      name: curl\n      labels:\n        test: blocked\n    spec:\n      containers:\n        - name: curl\n          image: \"alpine/curl:latest\"\n          command: [\"curl\", \"-v\", \"whoami.networkpolicy-test.svc.cluster.local:80\"]\n      restartPolicy: Never\n```\nHowever if there is an _allowed_ job in Completed state, the _blocked_ pod has a chance of receiving the same IP address as the completed _allowed_ pod, when that happens the _blocked_ pod will, in violation of the NetworkPolicy, be able to access the Deployment.\n\nTo make it easy to reproduce I would suggest applying the attached █████████ file to create 20 _allowed_ Jobs. Wait for all 20 Jobs to finish, then apply the attached ██████████to create 20 _blocked_ Jobs. Almost certainly some of the _blocked_ pods will be given IP addresses matching those of completed _allowed_ pods, and will therefore be able to connect to the Deployment and exit successfully. Some of the _blocked_ pods will be given different IP addresses and as a result will correctly not be able to connect to the Deployment, hang and then error.\n\n## Impact\n\n## Summary: On an EKS cluster relying on Kubernetes NetworkPolicy rules to restrict network access, having Completed pods that were allowed some access will result in other pods being given the same access.",
  "weakness": {
    "id": 26,
    "name": "Improper Access Control - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 0,
  "voters": [],
  "severity": {
    "rating": "medium",
    "score": 4.3,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "low",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "none",
      "integrity": "low",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 680608,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/aws/amazon-vpc-cni-k8s",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
