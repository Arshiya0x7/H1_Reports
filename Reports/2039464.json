{
  "id": 2039464,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDM5NDY0",
  "url": "https://hackerone.com/reports/2039464",
  "title": "Code inject via nginx.ingress.kubernetes.io/permanent-redirect annotation",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "high",
  "readable_substate": "Resolved",
  "created_at": "2023-06-26T23:46:37.188Z",
  "submitted_at": "2023-06-26T23:46:37.276Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "jkroepke",
    "url": "/jkroepke",
    "profile_picture_urls": {
      "small": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MzE1MTY0NiwicHVyIjoiYmxvYl9pZCJ9fQ==--2329da107f2e8d02ff4fa69103e1698c358f392d/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJwbmciLCJncmF2aXR5IjoiQ2VudGVyIiwicmVzaXplIjoiNjJ4NjJeIiwiY3JvcCI6IjYyeDYyKzArMCJ9LCJwdXIiOiJ2YXJpYXRpb24ifX0=--a4d91faed3dff6024dfc1a7b7f8ccc6b45e38396/1560587.big-min.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 39386,
    "url": "https://hackerone.com/kubernetes",
    "handle": "kubernetes",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/039/386/486f4380e09776d05a912ca9f46be23f72fe8197_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Kubernetes",
      "twitter_handle": "kubernetesio",
      "website": "https://kubernetes.io/",
      "about": ""
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2023-5044"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2023-10-25T22:46:43.792Z",
  "bug_reporter_agreed_on_going_public_at": "2023-10-25T22:46:43.698Z",
  "team_member_agreed_on_going_public_at": "2023-10-25T21:23:02.474Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Report Submission Form\n\n## Summary:\nThe value of the `nginx.ingress.kubernetes.io/permanent-redirect` annotation will be not sanitized and passed into the nginx configuration. This leads into a code inject from any user that is allowed to create ingress objects.\n\n## Kubernetes Version:\nv1.26.3 (minikube)\n\n## Component Version:\n```\n-------------------------------------------------------------------------------\nNGINX Ingress controller\n  Release:       v1.8.0\n  Build:         35f5082ee7f211555aaff431d7c4423c17f8ce9e\n  Repository:    https://github.com/kubernetes/ingress-nginx\n  nginx version: nginx/1.21.6\n\n-------------------------------------------------------------------------------\n```\n\n## Steps To Reproduce:\n\n  1. Install ingress-nginx, using latest version and default values. For demo purpose, I set `allow-snippet-annotations=false`\n        ```bash\n        helm upgrade -i ingress-nginx ingress-nginx/ingress-nginx -f values.yaml # values.yaml is attached\n        ```\n  1. apply service and ingress object from attachments\n        ```bash\n        k apply -f ingress.yaml #ingress.yaml is attached\n        ```\n  1. Optional: If ingress-nginx is not exposed, run `kubectl port-forward deploy/ingress-nginx-controller 8080:80` and continue step 4 in a separate shell.\n  1. Validate, if the code is injected. This demo uses the hostname `kubernetes.api`, use the `--resolve` parameter of curl to do an request for the hidden server instance. The code below expect that ingress-nginx is accessible trough 127.0.0.1:8080\n\n        ```bash\n        curl -v --resolve \"kubernetes.api:8080:127.0.0.1\" http://kubernetes.api:8080/api/v1/namespaces/kube-system/secrets/\n        ```\n\n## Supporting Material/References:\n\n  * values.yaml - Used in step 1\n  * ingress.yaml - Used in step 2\n\n## Impact\n\nAll users with access to create or update ingress objects, are able to running commands on ingress-nginx-controller pod. Since the token of the ServiceAccount is mounted on filesystem, a user can call the Kubernetes API and fetch all secrets or config maps from the cluster. Additionally, the user can read or write files to the filesystem.",
  "bounty_amount": "2500.0",
  "formatted_bounty": "$2,500",
  "weakness": {
    "id": 70,
    "name": "Code Injection"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 2446863,
      "file_name": "values.yaml",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/j9s1gvh4pf8ojbmnenfr22onk9ym?response-content-disposition=attachment%3B%20filename%3D%22values.yaml%22%3B%20filename%2A%3DUTF-8%27%27values.yaml&response-content-type=application%2Fx-yaml&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ25H4ULWX%2F20250920%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250920T195819Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHkaCXVzLXdlc3QtMiJHMEUCIFvDs22IB59aPXwSBPharbcvAcrEg4dVal5Abjp08PsfAiEAj3niFovMcFMWKywzJUWcVlrap8po0UGtFWFcZOZjL64qugUI8v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDO3M7zgPYiXi%2FtH%2B%2FSqOBRQLYymVzwS86p0K3NxhOnpeYs%2FgS%2FBAONpTkPfW4UQ5qRX6%2BnAXx9ZVqrxZQVFcMvKegP7E0PNrlAIK9VU3VmVz4ZSkv7NIWmF%2FZvgY%2FR0%2FttsHJY%2F6ku84KsDvlE4hsHL1CYmpikKCrKEiqHw%2BaLcOnZBxvZXoa5P4SF9vUW4KOdnBcVRIlwoEQdARiKBAUqd29sB7Nel4l2p0t07fdj0yjDUhPC9ja6IHt2Fc0JzStvxjxoRlKQWeyH%2FPc0QFYixLKKRr%2B2J9EGahjx0lqKVpVW4hPlNK6BS9aMKzU%2Bc3p1SujUIsU4O8xzSgnLtmz9sLk6FIZIhwYo0NDrME%2BA7ep2i%2B44SdDKi%2B2oyAMZJnm%2FZcctqdyafjpnuLy6MaL9WdeO1yJfJnZdK4EwRxJ84DUvsXrnuQMrUCYN3ui2QFPq60%2F90gwm90hyWyOMVuuJ6mq%2BDpoO8bhUdUur788fC%2FXn0%2B9jXhO%2FdqPaQl1TQ0bZTGJZ72FqChZvlLY44cT%2FrZ2lHWOo9IyXSdQuosF45YDC6kaVL5Iw4PmcxCaaoRlkU7io5%2BjG7Q9KuNZIyd6f5qHhbIH%2BPjTe%2FnPunAkNzDYKxd%2FjsY1y%2Fsk2Z3nnV%2FMh2nuncvM95I4crYdqkBqtrg8zShfz75Nhqz8Ji%2FJI3D9g9Qb%2FWS9CAjMvp2cSD66nOy2%2FWKCFJ6K83s9VylCFQAgT7P4C0IpjcANhcuZYKJ5iMK7EtIR9N6vee9JHxrOchfaHFjAh55GaBR4eFH3RcBBW1TF6pC9A5NT19rjdFJLSE%2Beuw8tWt93mKahTiNF3W5v8tAex8z1VIIGZ15ygxEE8us%2Fx44c%2FEi8x5lVHpnzO4T9%2FNXMu3vM%2FXUpDDHurvGBjqxAQkCQuHZEgZXiVhnH%2FOk1z9Z8Hoy9WONuQZRvPCUqV44pVCw1qaVKXbDIoqYF2OfGJXSRudOdNHbiGj8KIicIjxMQyogloYOVJwHRQ2V6RZqzLxTRVz9yTpkLmqr9Cl0EhirlFJ%2FkrkZb0r4MDhU%2FCP6XQbG%2BDiRinsAW1DrO1ArlQ4m78xdL%2F6%2FRO2c5ENqXv2EWEnHG%2FlpTFKqVD7lc5%2BETPfi7IH4Yg6X0YFUpwU46Q%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=2db05a68e0de1659b9f9afa20273c91a7ca7643f296ef4edbdcb56fcce71a26f",
      "file_size": 59,
      "type": "application/x-yaml",
      "moderated": null
    },
    {
      "id": 2446864,
      "file_name": "ingress.yaml",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/993qk4koyke4g5cfzm3nrdsxkink?response-content-disposition=attachment%3B%20filename%3D%22ingress.yaml%22%3B%20filename%2A%3DUTF-8%27%27ingress.yaml&response-content-type=application%2Fx-yaml&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ25H4ULWX%2F20250920%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250920T195819Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHkaCXVzLXdlc3QtMiJHMEUCIFvDs22IB59aPXwSBPharbcvAcrEg4dVal5Abjp08PsfAiEAj3niFovMcFMWKywzJUWcVlrap8po0UGtFWFcZOZjL64qugUI8v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDO3M7zgPYiXi%2FtH%2B%2FSqOBRQLYymVzwS86p0K3NxhOnpeYs%2FgS%2FBAONpTkPfW4UQ5qRX6%2BnAXx9ZVqrxZQVFcMvKegP7E0PNrlAIK9VU3VmVz4ZSkv7NIWmF%2FZvgY%2FR0%2FttsHJY%2F6ku84KsDvlE4hsHL1CYmpikKCrKEiqHw%2BaLcOnZBxvZXoa5P4SF9vUW4KOdnBcVRIlwoEQdARiKBAUqd29sB7Nel4l2p0t07fdj0yjDUhPC9ja6IHt2Fc0JzStvxjxoRlKQWeyH%2FPc0QFYixLKKRr%2B2J9EGahjx0lqKVpVW4hPlNK6BS9aMKzU%2Bc3p1SujUIsU4O8xzSgnLtmz9sLk6FIZIhwYo0NDrME%2BA7ep2i%2B44SdDKi%2B2oyAMZJnm%2FZcctqdyafjpnuLy6MaL9WdeO1yJfJnZdK4EwRxJ84DUvsXrnuQMrUCYN3ui2QFPq60%2F90gwm90hyWyOMVuuJ6mq%2BDpoO8bhUdUur788fC%2FXn0%2B9jXhO%2FdqPaQl1TQ0bZTGJZ72FqChZvlLY44cT%2FrZ2lHWOo9IyXSdQuosF45YDC6kaVL5Iw4PmcxCaaoRlkU7io5%2BjG7Q9KuNZIyd6f5qHhbIH%2BPjTe%2FnPunAkNzDYKxd%2FjsY1y%2Fsk2Z3nnV%2FMh2nuncvM95I4crYdqkBqtrg8zShfz75Nhqz8Ji%2FJI3D9g9Qb%2FWS9CAjMvp2cSD66nOy2%2FWKCFJ6K83s9VylCFQAgT7P4C0IpjcANhcuZYKJ5iMK7EtIR9N6vee9JHxrOchfaHFjAh55GaBR4eFH3RcBBW1TF6pC9A5NT19rjdFJLSE%2Beuw8tWt93mKahTiNF3W5v8tAex8z1VIIGZ15ygxEE8us%2Fx44c%2FEi8x5lVHpnzO4T9%2FNXMu3vM%2FXUpDDHurvGBjqxAQkCQuHZEgZXiVhnH%2FOk1z9Z8Hoy9WONuQZRvPCUqV44pVCw1qaVKXbDIoqYF2OfGJXSRudOdNHbiGj8KIicIjxMQyogloYOVJwHRQ2V6RZqzLxTRVz9yTpkLmqr9Cl0EhirlFJ%2FkrkZb0r4MDhU%2FCP6XQbG%2BDiRinsAW1DrO1ArlQ4m78xdL%2F6%2FRO2c5ENqXv2EWEnHG%2FlpTFKqVD7lc5%2BETPfi7IH4Yg6X0YFUpwU46Q%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=2d28c5f8191f38ae361b9f60cee9b6dcdb66a8400b0062158aaa872029ea6f24",
      "file_size": 1587,
      "type": "application/x-yaml",
      "moderated": null
    },
    {
      "id": 2446878,
      "file_name": "demo.webm",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/nwu2wmdc3v717es78adjcetstbes?response-content-disposition=attachment%3B%20filename%3D%22demo.webm%22%3B%20filename%2A%3DUTF-8%27%27demo.webm&response-content-type=video%2Fwebm&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ25H4ULWX%2F20250920%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250920T195819Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHkaCXVzLXdlc3QtMiJHMEUCIFvDs22IB59aPXwSBPharbcvAcrEg4dVal5Abjp08PsfAiEAj3niFovMcFMWKywzJUWcVlrap8po0UGtFWFcZOZjL64qugUI8v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDO3M7zgPYiXi%2FtH%2B%2FSqOBRQLYymVzwS86p0K3NxhOnpeYs%2FgS%2FBAONpTkPfW4UQ5qRX6%2BnAXx9ZVqrxZQVFcMvKegP7E0PNrlAIK9VU3VmVz4ZSkv7NIWmF%2FZvgY%2FR0%2FttsHJY%2F6ku84KsDvlE4hsHL1CYmpikKCrKEiqHw%2BaLcOnZBxvZXoa5P4SF9vUW4KOdnBcVRIlwoEQdARiKBAUqd29sB7Nel4l2p0t07fdj0yjDUhPC9ja6IHt2Fc0JzStvxjxoRlKQWeyH%2FPc0QFYixLKKRr%2B2J9EGahjx0lqKVpVW4hPlNK6BS9aMKzU%2Bc3p1SujUIsU4O8xzSgnLtmz9sLk6FIZIhwYo0NDrME%2BA7ep2i%2B44SdDKi%2B2oyAMZJnm%2FZcctqdyafjpnuLy6MaL9WdeO1yJfJnZdK4EwRxJ84DUvsXrnuQMrUCYN3ui2QFPq60%2F90gwm90hyWyOMVuuJ6mq%2BDpoO8bhUdUur788fC%2FXn0%2B9jXhO%2FdqPaQl1TQ0bZTGJZ72FqChZvlLY44cT%2FrZ2lHWOo9IyXSdQuosF45YDC6kaVL5Iw4PmcxCaaoRlkU7io5%2BjG7Q9KuNZIyd6f5qHhbIH%2BPjTe%2FnPunAkNzDYKxd%2FjsY1y%2Fsk2Z3nnV%2FMh2nuncvM95I4crYdqkBqtrg8zShfz75Nhqz8Ji%2FJI3D9g9Qb%2FWS9CAjMvp2cSD66nOy2%2FWKCFJ6K83s9VylCFQAgT7P4C0IpjcANhcuZYKJ5iMK7EtIR9N6vee9JHxrOchfaHFjAh55GaBR4eFH3RcBBW1TF6pC9A5NT19rjdFJLSE%2Beuw8tWt93mKahTiNF3W5v8tAex8z1VIIGZ15ygxEE8us%2Fx44c%2FEi8x5lVHpnzO4T9%2FNXMu3vM%2FXUpDDHurvGBjqxAQkCQuHZEgZXiVhnH%2FOk1z9Z8Hoy9WONuQZRvPCUqV44pVCw1qaVKXbDIoqYF2OfGJXSRudOdNHbiGj8KIicIjxMQyogloYOVJwHRQ2V6RZqzLxTRVz9yTpkLmqr9Cl0EhirlFJ%2FkrkZb0r4MDhU%2FCP6XQbG%2BDiRinsAW1DrO1ArlQ4m78xdL%2F6%2FRO2c5ENqXv2EWEnHG%2FlpTFKqVD7lc5%2BETPfi7IH4Yg6X0YFUpwU46Q%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=02b35846a186ba339f9176304c63e4c6f414a10e070e458340c51a8a0d995a74",
      "file_size": 9185135,
      "type": "video/webm",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": "2023-11-24T21:23:02.575Z",
  "allow_singular_disclosure_after": -57537317.284476966,
  "singular_disclosure_allowed": true,
  "vote_count": 39,
  "voters": [
    "8910jq",
    "lones",
    "jadav_",
    "hacktus",
    "n1m0",
    "zy9ard3",
    "spell1",
    "sp1id3r",
    "hackduty",
    "eminfidan",
    "and 29 more..."
  ],
  "severity": {
    "rating": "high",
    "score": 7.6,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "low",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "high",
      "integrity": "low",
      "availability": "low"
    }
  },
  "structured_scope": {
    "databaseId": 32524,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/kubernetes/ingress-nginx",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
