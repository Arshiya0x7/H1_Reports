{
  "id": 317711,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMTc3MTE=",
  "url": "https://hackerone.com/reports/317711",
  "title": "twofactor_auth bypassable if provider fails to load",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2018-02-20T01:00:10.407Z",
  "submitted_at": "2018-02-20T01:00:10.407Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "cyphar",
    "url": "/cyphar",
    "profile_picture_urls": {
      "small": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MjIxOCwicHVyIjoiYmxvYl9pZCJ9fQ==--d64c459ef8b0d3b269ee00218b7591bb2d9e6de0/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGciLCJncmF2aXR5IjoiQ2VudGVyIiwicmVzaXplIjoiNjJ4NjJeIiwiY3JvcCI6IjYyeDYyKzArMCJ9LCJwdXIiOiJ2YXJpYXRpb24ifX0=--2de8067d228529d65848a4eeed0bed0bb2531bc3/profile.jpg"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 13291,
    "url": "https://hackerone.com/nextcloud",
    "handle": "nextcloud",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/tnqlkt8d6fcch8hj8brdjp8nw864/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/tnqlkt8d6fcch8hj8brdjp8nw864/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Nextcloud",
      "twitter_handle": "nextclouders",
      "website": "https://nextcloud.com",
      "about": "Access, share and protect your files, calendars, contacts, communication & more at home and in your enterprise."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2018-16465"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2018-09-27T10:10:19.480Z",
  "bug_reporter_agreed_on_going_public_at": "2018-09-27T10:10:19.418Z",
  "team_member_agreed_on_going_public_at": "2018-09-25T10:12:49.042Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "(Just want to preface this by saying that this is probably not a significant\nvulnerability, as it requires that the server either have recently been\nincorrectly upgraded or otherwise misconfigured. However in the administration\nof my own personal NextCloud instance I have hit this several times.)\n\nThis is a general trait of 2FA provider failures. If you enable 2FA for any\ngiven user on NextCloud, and the 2FA provider fails to by enabled for whatever\nreason (such as an upgrade which made the 2FA provider incompatible, or the 2FA\nprovider source code was removed or corrupted somehow) then 2FA will be\nbypassable for all accounts on the system.\n\nWhile this may not seem like a significant issue, since twofactor_auth\nproviders are not part of the main NextCloud server source, upgrading the main\nserver (either through the official updater app, or manually) will result in\ntwofactor_auth being disabled if the provider has not been updated. Thus there\nis a window around upgrading the NextCloud server where an attacker can bypass\n2FA.\n\nUltimately the solution to this problem would be to *always* require 2FA if 2FA\nhas been enabled, and if a provider is not available you must require that the\nuser enter one of their backup codes. I'm not sure how backup codes are\ncurrently implemented, but if they're implemented in the server (rather than\nindividually by each 2FA provider) this should not be overly complicated to\nimplement.\n\nI have only tested this with the TOTP 2FA provider, but I would be surprised if\nit didn't affect all 2FA providers.\n\n## Impact\n\nAttackers being able to bypass 2FA means that keyloggers or other tools could\nbe used to steal the users' passphrase, and then the attacker could gain access\nwhile the user would expect the attacker to require access to their 2FA token.",
  "weakness": {
    "id": 27,
    "name": "Improper Authentication - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2018-10-25T10:12:49.165Z",
  "allow_singular_disclosure_after": -218012191.10432893,
  "singular_disclosure_allowed": true,
  "vote_count": 9,
  "voters": [
    "ali",
    "eveeez",
    "japz",
    "cryptographer",
    "rayhanuddinakhand",
    "ricky__99",
    "jatacheers",
    "unknowed21",
    "destinedtohack"
  ],
  "severity": {
    "rating": "low",
    "author_type": "User"
  },
  "structured_scope": {
    "databaseId": 13,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "nextcloud/server",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
