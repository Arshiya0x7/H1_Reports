{
  "id": 2921724,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yOTIxNzI0",
  "url": "https://hackerone.com/reports/2921724",
  "title": "Deadlock in x86 HVM standard VGA handling",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2025-01-03T22:22:00.130Z",
  "submitted_at": "2025-01-03T22:22:00.514Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "stonksy",
    "url": "/stonksy",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/36bca6668139d77be42208d896968344ae7a76c55ee0f8b0f28281ccd492ff02?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQR26M2TQU%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T200455Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECsaCXVzLXdlc3QtMiJHMEUCIBKw%2FZT06MLRj4Lc34TSdy2YR8jqZx6COQTnVz%2BB80QmAiEAoDtI55%2Fo3wyn6kKBbhfI%2FgCUBnHXL4XPF3BiD7531kcqsgUINBADGgwwMTM2MTkyNzQ4NDkiDOEIC6Qmd6YA3OCvYyqPBR7Z8WBMwz%2BHajtho74RwrdyoYC1dmLEqPChyxTjgWQbOxQ%2FPXlaGDE4GxnjorZEw69JvgJauj8Y7dbqn1dAf%2FX4Xlj7%2F8Vwq1tgaRjCVoZp9kdGaBIdw7r1fT%2ByYPFey60p3c%2B5EPze34Zi2CqDAU0LR8Aeg29HLNwGdMI9OK1lkJpIf39fCQwVfIwT2zTXPjYF5V38LboK0oY9qKR2TA9PdkFSKRaaZ9AJlgIT%2F617th3LVkzzD3why2TKcbK1nK9cgMZvYw9YHGOV%2BNQ3eM4g%2FIN%2F6GH%2FK8nhMIgCcVGweTjhoyGds2K%2FJ32Apr3IoSnDdZTmyBe7E1x%2FXEDPDUHdNgfdRcWCTmkK3c1T%2BHBekeyH2T%2BLosAh%2FdMq9LFMR3uSieCchXMhIRtAxWDp9XJUOeeCE75zfqYebPtXW%2Fs2DV8c5IJEg55Qb8%2BUPKjj9DeJdLM1N7zb8Gaq6bFVSo3vztpE7ZBZtyaX9rctFQa8WDGxHknFRrXDkzcm7wamSyAXKk2RS%2BzgNZUXa0UHH1GNFTYE9lLc9wk70JtM6cnbwej7KXg9WY4DgQL8y9%2BM1TJrINLkfKqj3aiCWN%2BLraQRdaYB5sEH%2BGx%2FG51kipvsN2qCgjaXuZk%2F%2B2DGznsKdSR6Qu5%2BNm65JWhftW9jZmOGF9pJARaNnytkwJcoaWOBlxvbYFGGZKfNkuuRpOZ4VxDOFmPq4pOCibrlDoQuyNbwNVfeyDgh50slwoTp%2F%2BJkmTqLXVFxrPEG4saq%2BnyUJgUgjdWJ1rLExKKKwyBl3micsnJfoYJ7KdQ%2FuivCpf%2BJjuUHzYux0GcgiIwOOmQJeFl55yGhOno%2FFRIyllrMdojVShUNTo9lrr8Sd9iHmZYw3cGgwwY6sQG7dr02P5jijyV4HPZ0n8wGzog4p7P1%2B%2Bkof4dylsExePBWm4SBuTM113xUTfy%2FA48FLPRP%2BvatLkjHrYGO7YI40c6iWW3R%2BMVypDtvSy8eLYN4V5TbRlXdgVTXdKvrGkfiYPtzdAuu3YtUvEC7MgDEJyBtIDp7ZcPngCuLuLU3WaKVVdwxqrdv%2FngBB3LviKGQkjJjos6GYlB1GtjG4m3zSFV3JMgRsHSJy6g5Gekq9oc%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=9b2168770441f4f0099ed83f3b3a7ccea00e37437f7c25fcc63a9b2a8c00d791",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/19c85a12ac35f466af1ea2b0ae853bfe5e8f057fb1d6fb62db131707bb67b30d?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQR26M2TQU%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T200455Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECsaCXVzLXdlc3QtMiJHMEUCIBKw%2FZT06MLRj4Lc34TSdy2YR8jqZx6COQTnVz%2BB80QmAiEAoDtI55%2Fo3wyn6kKBbhfI%2FgCUBnHXL4XPF3BiD7531kcqsgUINBADGgwwMTM2MTkyNzQ4NDkiDOEIC6Qmd6YA3OCvYyqPBR7Z8WBMwz%2BHajtho74RwrdyoYC1dmLEqPChyxTjgWQbOxQ%2FPXlaGDE4GxnjorZEw69JvgJauj8Y7dbqn1dAf%2FX4Xlj7%2F8Vwq1tgaRjCVoZp9kdGaBIdw7r1fT%2ByYPFey60p3c%2B5EPze34Zi2CqDAU0LR8Aeg29HLNwGdMI9OK1lkJpIf39fCQwVfIwT2zTXPjYF5V38LboK0oY9qKR2TA9PdkFSKRaaZ9AJlgIT%2F617th3LVkzzD3why2TKcbK1nK9cgMZvYw9YHGOV%2BNQ3eM4g%2FIN%2F6GH%2FK8nhMIgCcVGweTjhoyGds2K%2FJ32Apr3IoSnDdZTmyBe7E1x%2FXEDPDUHdNgfdRcWCTmkK3c1T%2BHBekeyH2T%2BLosAh%2FdMq9LFMR3uSieCchXMhIRtAxWDp9XJUOeeCE75zfqYebPtXW%2Fs2DV8c5IJEg55Qb8%2BUPKjj9DeJdLM1N7zb8Gaq6bFVSo3vztpE7ZBZtyaX9rctFQa8WDGxHknFRrXDkzcm7wamSyAXKk2RS%2BzgNZUXa0UHH1GNFTYE9lLc9wk70JtM6cnbwej7KXg9WY4DgQL8y9%2BM1TJrINLkfKqj3aiCWN%2BLraQRdaYB5sEH%2BGx%2FG51kipvsN2qCgjaXuZk%2F%2B2DGznsKdSR6Qu5%2BNm65JWhftW9jZmOGF9pJARaNnytkwJcoaWOBlxvbYFGGZKfNkuuRpOZ4VxDOFmPq4pOCibrlDoQuyNbwNVfeyDgh50slwoTp%2F%2BJkmTqLXVFxrPEG4saq%2BnyUJgUgjdWJ1rLExKKKwyBl3micsnJfoYJ7KdQ%2FuivCpf%2BJjuUHzYux0GcgiIwOOmQJeFl55yGhOno%2FFRIyllrMdojVShUNTo9lrr8Sd9iHmZYw3cGgwwY6sQG7dr02P5jijyV4HPZ0n8wGzog4p7P1%2B%2Bkof4dylsExePBWm4SBuTM113xUTfy%2FA48FLPRP%2BvatLkjHrYGO7YI40c6iWW3R%2BMVypDtvSy8eLYN4V5TbRlXdgVTXdKvrGkfiYPtzdAuu3YtUvEC7MgDEJyBtIDp7ZcPngCuLuLU3WaKVVdwxqrdv%2FngBB3LviKGQkjJjos6GYlB1GtjG4m3zSFV3JMgRsHSJy6g5Gekq9oc%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=c58a995f1b57ddca993e83b7472adc09c75c379bcef508b5476e3b1514318dc0"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2024-45818"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2025-03-07T20:37:45.934Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2025-02-05T20:37:45.339Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "### Overview\n\nThis vulnerability has been reported to the Xen project maintainers in mid October 2024. The Xen project has acknowledged the vulnerability, published patches and released an advisory as well as a CVE, see: https://xenbits.xen.org/xsa/advisory-463.html\n\n### Vulnerability\n\nThe hypervisor contains code to accelerate VGA memory accesses for HVM guests, when the (virtual) VGA is in \"standard\" mode. Locking involved there has an unusual discipline, leaving a lock acquired past the return from the function that acquired it. This behavior results in a problem when emulating an instruction with two memory accesses, both of which touch VGA memory (plus some further constraints which aren't relevant here). When emulating the 2nd access, the lock that is already being held would be attempted to be re-acquired, resulting in a deadlock. This deadlock was already found when the code was first introduced, but was analysed incorrectly and the fix was incomplete. Analysis in light of the new finding cannot find a way to make the existing locking discipline work. In staging, this logic has all been removed because it was discovered to be accidentally disabled since Xen 4.7. Therefore, we are fixing the locking problem by backporting the removal of most of the feature. Note that even with the feature disabled, the lock would still be acquired for any accesses to the VGA MMIO region.\n\nAttached is the PoC that I utilized for the original report of the vulnerability to the Xen maintainers. It was tested on Xen version 4.19.\n\n## Impact\n\nAn attacker executing code in ring0 inside of an unprivileged x86-HVM-DomU can trigger a deadlock in the host hypervisor, resulting in a Denial of Service of all other Domains running under the Hypervisor, including the hypervisor itself.\n\"Xen versions 4.6 through 4.19 are vulnerable.\" as per the referenced XSA.\nThe CVE database (https://nvd.nist.gov/vuln/detail/CVE-2024-45818) contains a CVSS v3.x rating of: 6.5 Medium.",
  "bounty_amount": "2162.0",
  "formatted_bounty": "$2,162",
  "weakness": {
    "id": 107,
    "name": "Improper Input Validation"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 3912172,
      "file_name": "poc-stdvga-io-deadlock.tar.gz",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/lq5vjwdl8har9jz9foahvsyk8uqj?response-content-disposition=attachment%3B%20filename%3D%22poc-stdvga-io-deadlock.tar.gz%22%3B%20filename%2A%3DUTF-8%27%27poc-stdvga-io-deadlock.tar.gz&response-content-type=application%2Fgzip&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQR26M2TQU%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T200455Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECsaCXVzLXdlc3QtMiJHMEUCIBKw%2FZT06MLRj4Lc34TSdy2YR8jqZx6COQTnVz%2BB80QmAiEAoDtI55%2Fo3wyn6kKBbhfI%2FgCUBnHXL4XPF3BiD7531kcqsgUINBADGgwwMTM2MTkyNzQ4NDkiDOEIC6Qmd6YA3OCvYyqPBR7Z8WBMwz%2BHajtho74RwrdyoYC1dmLEqPChyxTjgWQbOxQ%2FPXlaGDE4GxnjorZEw69JvgJauj8Y7dbqn1dAf%2FX4Xlj7%2F8Vwq1tgaRjCVoZp9kdGaBIdw7r1fT%2ByYPFey60p3c%2B5EPze34Zi2CqDAU0LR8Aeg29HLNwGdMI9OK1lkJpIf39fCQwVfIwT2zTXPjYF5V38LboK0oY9qKR2TA9PdkFSKRaaZ9AJlgIT%2F617th3LVkzzD3why2TKcbK1nK9cgMZvYw9YHGOV%2BNQ3eM4g%2FIN%2F6GH%2FK8nhMIgCcVGweTjhoyGds2K%2FJ32Apr3IoSnDdZTmyBe7E1x%2FXEDPDUHdNgfdRcWCTmkK3c1T%2BHBekeyH2T%2BLosAh%2FdMq9LFMR3uSieCchXMhIRtAxWDp9XJUOeeCE75zfqYebPtXW%2Fs2DV8c5IJEg55Qb8%2BUPKjj9DeJdLM1N7zb8Gaq6bFVSo3vztpE7ZBZtyaX9rctFQa8WDGxHknFRrXDkzcm7wamSyAXKk2RS%2BzgNZUXa0UHH1GNFTYE9lLc9wk70JtM6cnbwej7KXg9WY4DgQL8y9%2BM1TJrINLkfKqj3aiCWN%2BLraQRdaYB5sEH%2BGx%2FG51kipvsN2qCgjaXuZk%2F%2B2DGznsKdSR6Qu5%2BNm65JWhftW9jZmOGF9pJARaNnytkwJcoaWOBlxvbYFGGZKfNkuuRpOZ4VxDOFmPq4pOCibrlDoQuyNbwNVfeyDgh50slwoTp%2F%2BJkmTqLXVFxrPEG4saq%2BnyUJgUgjdWJ1rLExKKKwyBl3micsnJfoYJ7KdQ%2FuivCpf%2BJjuUHzYux0GcgiIwOOmQJeFl55yGhOno%2FFRIyllrMdojVShUNTo9lrr8Sd9iHmZYw3cGgwwY6sQG7dr02P5jijyV4HPZ0n8wGzog4p7P1%2B%2Bkof4dylsExePBWm4SBuTM113xUTfy%2FA48FLPRP%2BvatLkjHrYGO7YI40c6iWW3R%2BMVypDtvSy8eLYN4V5TbRlXdgVTXdKvrGkfiYPtzdAuu3YtUvEC7MgDEJyBtIDp7ZcPngCuLuLU3WaKVVdwxqrdv%2FngBB3LviKGQkjJjos6GYlB1GtjG4m3zSFV3JMgRsHSJy6g5Gekq9oc%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=bed3a52aa6ac1d5d7d2e6e52bdb71bde023ef08ae242961566da46a1f2feed12",
      "file_size": 643,
      "type": "application/gzip",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": "2025-03-07T20:37:45.637Z",
  "allow_singular_disclosure_after": -10279629.482459525,
  "singular_disclosure_allowed": true,
  "vote_count": 84,
  "voters": [
    "aboalezz",
    "huseyin_tuc",
    "0xcyborg",
    "n1m0",
    "zy9ard3",
    "2026",
    "mohaned0101",
    "mr-alienx-kurd",
    "ahmed_xyz",
    "zimmer75",
    "and 74 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 5.5,
    "author_type": "User",
    "metrics": {
      "attack_vector": "local",
      "attack_complexity": "low",
      "privileges_required": "low",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "none",
      "integrity": "none",
      "availability": "high"
    }
  },
  "structured_scope": {
    "databaseId": 87519,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://wiki.xenproject.org/wiki/Xen_Project_Repositories",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 631157,
      "category": "team",
      "content": "ISSUE DESCRIPTION\n=================\n\nThe hypervisor contains code to accelerate VGA memory accesses for HVM\nguests, when the (virtual) VGA is in \"standard\" mode.  Locking involved\nthere has an unusual discipline, leaving a lock acquired past the\nreturn from the function that acquired it.  This behavior results in a\nproblem when emulating an instruction with two memory accesses, both of\nwhich touch VGA memory (plus some further constraints which aren't\nrelevant here).  When emulating the 2nd access, the lock that is already\nbeing held would be attempted to be re-acquired, resulting in a\ndeadlock.\n\nThis deadlock was already found when the code was first introduced, but\nwas analysed incorrectly and the fix was incomplete.  Analysis in light\nof the new finding cannot find a way to make the existing locking\ndiscipline work.\n\nIn staging, this logic has all been removed because it was discovered\nto be accidentally disabled since Xen 4.7.  Therefore, we are fixing the\nlocking problem by backporting the removal of most of the feature.  Note\nthat even with the feature disabled, the lock would still be acquired\nfor any accesses to the VGA MMIO region.\n\nAdvisory: https://xenbits.xen.org/xsa/advisory-463.txt",
      "updated_at": "2025-02-05T20:35:12.536Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 2032618,
        "username": "pr0tag0nist",
        "name": "p h",
        "bio": "",
        "cleared": false,
        "verified": false,
        "website": null,
        "location": "",
        "created_at": "2021-10-18T10:02:41.859Z",
        "url": "https://hackerone.com/pr0tag0nist",
        "hackerone_triager": false,
        "hackerone_employee": true,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png",
          "medium": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png",
          "xtralarge": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
        }
      }
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
