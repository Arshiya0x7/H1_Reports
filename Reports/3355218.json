{
  "id": 3355218,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMzU1MjE4",
  "url": "https://hackerone.com/reports/3355218",
  "title": "CVE-2025-10966: missing SFTP host verification with wolfSSH",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2025-09-23T15:14:16.228Z",
  "submitted_at": "2025-09-23T15:14:16.571Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "giant_anteater",
    "url": "/giant_anteater",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 35663,
    "url": "https://hackerone.com/curl",
    "handle": "curl",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/035/663/2faf4c279d437d64bfda6d23d62ce1833813a4d9_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "curl",
      "twitter_handle": "",
      "website": "https://curl.se",
      "about": "cURL is an Open Source project providing a library and command-line tool doing internet transfers"
    }
  },
  "has_bounty?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2025-10966"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2025-11-05T21:57:54.730Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2025-11-05T07:15:21.871Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Summary:\nWhen curl is built with the wolfSSH backend, the SSH/SFTP implementation in `lib/vssh/wolfssh.c` performs no server host key verification and exposes no host identity options in the curl tool. I verified this locally by building curl with wolfSSH (binary reports `wolfssh/1.4.20`), observing that the SSH host verification options are not available in the tool, and inspecting the wolfSSH code paths that connect without any host key check or known_hosts handling.\n\nAI usage statement: This report text was prepared with assistance, but the findings below were verified manually via local build, runtime behavior, and code inspection.\n\n## Affected version\nLocal build on macOS (Apple Silicon):\n\n```\n$ ./src/curl --version\ncurl 8.17.0-DEV (aarch64-apple-darwin23.3.0) libcurl/8.17.0-DEV wolfSSL/5.8.2 zlib/1.2.12 brotli/1.1.0 zstd/1.5.7 libidn2/2.3.8 libpsl/0.21.5 wolfssh/1.4.20 nghttp2/1.66.0 librtmp/2.3\nProtocols: dict file ftp ftps gopher gophers http https imap imaps ipfs ipns ldap ldaps mqtt pop3 pop3s rtmp rtsp sftp smb smbs smtp smtps telnet tftp ws wss\n```\n\n## Steps To Reproduce:\n\n1. Build wolfSSH (with SFTP) and install locally (macOS/Homebrew shown):\n   \n   ```bash\n   # Prereqs (Homebrew)\n   brew install wolfssl libpsl libidn2 libnghttp2\n\n   # Build and install wolfSSH with SFTP enabled\n   git clone --depth=1 https://github.com/wolfSSL/wolfssh.git\n   cd wolfssh\n   ./autogen.sh\n   ./configure \\\n     --prefix=$HOME/.local/wolfssh \\\n     --with-wolfssl=/opt/homebrew \\\n     --enable-sftp \\\n     --enable-sshclient \\\n     --enable-examples \\\n     CPPFLAGS='-I/opt/homebrew/include' \\\n     LDFLAGS='-L/opt/homebrew/lib'\n   make -j$(sysctl -n hw.ncpu)\n   make install\n   ```\n\n2. Configure and build curl with wolfSSH:\n   \n   ```bash\n   cd /Users/$USER/scanner-repos/curl\n   autoreconf -fi\n   PKG_CONFIG_PATH=\"$HOME/.local/wolfssh/lib/pkgconfig:/opt/homebrew/lib/pkgconfig\" \\\n   CPPFLAGS=\"-I$HOME/.local/wolfssh/include -I/opt/homebrew/include\" \\\n   LDFLAGS=\"-L$HOME/.local/wolfssh/lib -L/opt/homebrew/lib\" \\\n   ./configure \\\n     --without-libssh2 \\\n     --without-libssh \\\n     --with-wolfssh=$HOME/.local/wolfssh \\\n     --with-wolfssl=/opt/homebrew \\\n     --disable-shared\n   make -j$(sysctl -n hw.ncpu)\n   ```\n\n3. Verify the build shows wolfSSH:\n   \n   ```bash\n   ./src/curl --version\n   # Output includes: wolfssh/1.4.20\n   ```\n\n4. Observe that SSH host identity options are unavailable in this build:\n   \n   ```bash\n   ./src/curl --help ssh\n   # No --ssh-knownhosts or --hostpubsha256 listed\n\n   ./src/curl --ssh-knownhosts /tmp/kh -vvv sftp://localhost:22/\n   # Error observed:\n   # curl: option --ssh-knownhosts: is unknown\n\n   ./src/curl -v --hostpubsha256 AAAA sftp://demo:password@test.rebex.net/readme.txt\n   # Error observed:\n   # curl: option --hostpubsha256: the installed libcurl version does not support this\n   ```\n\n   These runtime observations match the wolfSSH backend’s code, which does not implement host key verification or known_hosts integration.\n\n5. Code references in `lib/vssh/wolfssh.c` and `lib/vssh/ssh.h` (exact lines):\n\n   - Connection setup: no host key verification callback or known_hosts loading, then immediately enters the state machine.\n\n```399:461:curl/lib/vssh/wolfssh.c\nstatic CURLcode wssh_connect(struct Curl_easy *data, bool *done)\n{\n  struct connectdata *conn = data->conn;\n  struct ssh_conn *sshc = Curl_conn_meta_get(conn, CURL_META_SSH_CONN);\n  struct SSHPROTO *sshp = Curl_meta_get(data, CURL_META_SSH_EASY);\n  curl_socket_t sock = conn->sock[FIRSTSOCKET];\n  int rc;\n\n  if(!sshc || !sshp)\n    return CURLE_FAILED_INIT;\n\n  /* We default to persistent connections. We set this already in this connect\n     function to make the reuse checks properly be able to check this bit. */\n  connkeep(conn, \"SSH default\");\n\n  if(conn->handler->protocol & CURLPROTO_SCP) {\n    conn->recv[FIRSTSOCKET] = wscp_recv;\n    conn->send[FIRSTSOCKET] = wscp_send;\n  }\n  else {\n    conn->recv[FIRSTSOCKET] = wsftp_recv;\n    conn->send[FIRSTSOCKET] = wsftp_send;\n  }\n  sshc->ctx = wolfSSH_CTX_new(WOLFSSH_ENDPOINT_CLIENT, NULL);\n  if(!sshc->ctx) {\n    failf(data, \"No wolfSSH context\");\n    goto error;\n  }\n\n  sshc->ssh_session = wolfSSH_new(sshc->ctx);\n  if(!sshc->ssh_session) {\n    failf(data, \"No wolfSSH session\");\n    goto error;\n  }\n\n  rc = wolfSSH_SetUsername(sshc->ssh_session, conn->user);\n  if(rc != WS_SUCCESS) {\n    failf(data, \"wolfSSH failed to set username\");\n    goto error;\n  }\n\n  /* set callback for authentication */\n  wolfSSH_SetUserAuth(sshc->ctx, userauth);\n  wolfSSH_SetUserAuthCtx(sshc->ssh_session, data);\n\n  rc = wolfSSH_set_fd(sshc->ssh_session, (int)sock);\n  if(rc) {\n    failf(data, \"wolfSSH failed to set socket\");\n    goto error;\n  }\n\n#if 0\n  wolfSSH_Debugging_ON();\n#endif\n\n  *done = TRUE;\n  if(conn->handler->protocol & CURLPROTO_SCP)\n    wssh_state(data, sshc, SSH_INIT);\n  else\n    wssh_state(data, sshc, SSH_SFTP_INIT);\n\n  return wssh_multi_statemach(data, done);\nerror:\n  wssh_sshc_cleanup(sshc);\n  return CURLE_FAILED_INIT;\n}\n```\n\n   - State machine: after `wolfSSH_connect()` succeeds, it transitions directly to `SSH_STOP` without any `SSH_HOSTKEY` verification step.\n\n```637:657:curl/lib/vssh/wolfssh.c\ncase SSH_S_STARTUP:\n  rc = wolfSSH_connect(sshc->ssh_session);\n  if(rc != WS_SUCCESS)\n    rc = wolfSSH_get_error(sshc->ssh_session);\n  if(rc == WS_WANT_READ) {\n    *block = TRUE;\n    conn->waitfor = KEEP_RECV;\n    return CURLE_OK;\n  }\n  else if(rc == WS_WANT_WRITE) {\n    *block = TRUE;\n    conn->waitfor = KEEP_SEND;\n    return CURLE_OK;\n  }\n  else if(rc != WS_SUCCESS) {\n    wssh_state(data, sshc, SSH_STOP);\n    return CURLE_SSH;\n  }\n  infof(data, \"wolfssh connected\");\n  wssh_state(data, sshc, SSH_STOP);\n  break;\n```\n\n   - The `SSH_HOSTKEY` state exists in the common SSH state enumeration but is not used by the wolfSSH state machine above.\n\n```56:75:curl/lib/vssh/ssh.h\ntypedef enum {\n  SSH_NO_STATE = -1,  /* Used for \"nextState\" so say there is none */\n  SSH_STOP = 0,       /* do nothing state, stops the state machine */\n\n  SSH_INIT,           /* First state in SSH-CONNECT */\n  SSH_S_STARTUP,      /* Session startup */\n  SSH_HOSTKEY,        /* verify hostkey */\n  SSH_AUTHLIST,\n  SSH_AUTH_PKEY_INIT,\n  SSH_AUTH_PKEY,\n  SSH_AUTH_PASS_INIT,\n  SSH_AUTH_PASS,\n  SSH_AUTH_AGENT_INIT, /* initialize then wait for connection to agent */\n  SSH_AUTH_AGENT_LIST, /* ask for list then wait for entire list to come */\n  SSH_AUTH_AGENT,      /* attempt one key at a time */\n  SSH_AUTH_HOST_INIT,\n  SSH_AUTH_HOST,\n  SSH_AUTH_KEY_INIT,\n  SSH_AUTH_KEY,\n  SSH_AUTH_GSSAPI,\n  SSH_AUTH_DONE,\n  SSH_SFTP_INIT,\n  SSH_SFTP_REALPATH,   /* Last state in SSH-CONNECT */\n```\n\n## Supporting Material/References:\n\n- Tool help and error outputs from the local wolfSSH build:\n\n```\n$ ./src/curl --help ssh\nssh: SSH protocol\n     --compressed-ssh          Enable SSH compression\n     --hostpubmd5 <md5>        Acceptable MD5 hash of host public key\n     --hostpubsha256 <sha256>  Acceptable SHA256 hash of host public key\n -k, --insecure                Allow insecure server connections\n     --key <key>               Private key filename\n     --pass <phrase>           Passphrase for the private key\n     --pubkey <key>            SSH Public key filename\n```\n\n```\n$ ./src/curl --ssh-knownhosts /tmp/kh -vvv sftp://localhost:22/\ncurl: option --ssh-knownhosts: is unknown\n```\n\n```\n$ ./src/curl -v --hostpubsha256 AAAA sftp://demo:password@test.rebex.net/readme.txt\ncurl: option --hostpubsha256: the installed libcurl version does not support this\n```\n\nThese observations, together with the wolfSSH connection and state machine code above, show that host identity verification is not implemented for this backend.\n\n## Impact\n\n## Summary:\nIf curl/libcurl is built with the wolfSSH backend and used for SFTP, server host identities are not verified. This permits potential man‑in‑the‑middle attacks on SSH/SFTP connections in environments using the wolfSSH backend, since any presented server host key is effectively accepted by the client (no known_hosts or fingerprint enforcement, and no hostkey verification step in the state machine).",
  "weakness": {
    "id": 28,
    "name": "Improper Certificate Validation"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2025-12-05T07:15:22.101Z",
  "allow_singular_disclosure_after": 2538013.346374388,
  "singular_disclosure_allowed": false,
  "vote_count": 1,
  "voters": [
    "2026"
  ],
  "severity": {
    "rating": "low",
    "author_type": "Team"
  },
  "structured_scope": {
    "databaseId": 18844,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/curl/curl",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
