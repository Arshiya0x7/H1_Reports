{
  "id": 240958,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNDA5NTg=",
  "url": "https://hackerone.com/reports/240958",
  "title": "Firefly's verify_access_token() function does a byte-by-byte comparison of HMAC values.",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "none",
  "readable_substate": "Resolved",
  "created_at": "2017-06-17T10:03:52.550Z",
  "submitted_at": "2017-06-17T10:03:52.550Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "edoverflow",
    "url": "/edoverflow",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 545,
    "url": "https://hackerone.com/yelp",
    "handle": "yelp",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/000/545/de556165eaf2da7600f9ce75d1179281ee2d538f_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/545/de556165eaf2da7600f9ce75d1179281ee2d538f_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Yelp",
      "twitter_handle": "",
      "website": "https://www.yelp.com",
      "about": "Connecting people to great local businesses in communities around the world."
    }
  },
  "has_bounty?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2017-07-10T16:42:06.997Z",
  "bug_reporter_agreed_on_going_public_at": "2017-07-07T12:43:25.776Z",
  "team_member_agreed_on_going_public_at": "2017-07-10T16:42:06.941Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Dear Yelp bug bounty team,\n\n# Summary\n---\n\n[Firefly](https://github.com/Yelp/firefly) is vulnerable to timing attacks, because the `verify_access_token()` function performs a byte-by-byte comparison, which terminates early when two characters do not match.\n\nTiming attacks are a type of side channel attack where one can discover valuable information by recording the time it takes for a cryptographic algorithm to execute.\n\n~~~python\ndef verify_access_token(token, key):\n    \"\"\"Verify that the given access token is still valid. Returns true if it is,\n    false if it either failed to validate or has expired.\n    A token is a combination of a unix timestamp and a signature\"\"\"\n    t = token[:15]\n    signature = token[15:]\n    expected_signature = hmac.new(key, msg=t, digestmod=hashlib.sha1).hexdigest()\n    return signature == expected_signature and int(t) >= int(time.time())\n~~~\n\nThe `==` operation does a byte-by-byte comparison of two values and as soon as the two differentiate it terminates. This means the longer it takes until the operation returns, the more correct characters the attacker has guessed. An attacker can then create a valid HMAC without knowing the HMAC key.\n\n# How can this be fixed?\n---\n\nYou have already imported the hmac module, so this fix simply consists of changing one line.\n\n~~~diff\ndef verify_access_token(token, key):\n    \"\"\"Verify that the given access token is still valid. Returns true if it is,\n    false if it either failed to validate or has expired.\n    A token is a combination of a unix timestamp and a signature\"\"\"\n    t = token[:15]\n    signature = token[15:]\n    expected_signature = hmac.new(key, msg=t, digestmod=hashlib.sha1).hexdigest()\n-   return signature == expected_signature and int(t) >= int(time.time())\n+   return hmac.compare_digest(signature, expected_signature) and int(t) >= int(time.time())\n~~~\n\nThe `hmac.compare_digest()` function does not terminate as soon as two bytes are not the same.\n\nIf you would like me to submit a PR to address this issue, I would be more than happy to do that.\n\nBest regards,\nEd",
  "weakness": {
    "id": 32,
    "name": "Cryptographic Issues - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2017-08-06T12:43:25.820Z",
  "allow_singular_disclosure_after": -256466632.48825896,
  "singular_disclosure_allowed": true,
  "vote_count": 7,
  "voters": [
    "jokebookservice1",
    "gerben_javado",
    "r3y",
    "eveeez",
    "khizer47",
    "japz",
    "hacklad"
  ],
  "severity": {
    "rating": "none",
    "author_type": "Team"
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
