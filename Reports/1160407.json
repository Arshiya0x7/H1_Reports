{
  "id": 1160407,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTYwNDA3",
  "url": "https://hackerone.com/reports/1160407",
  "title": "Cache poisoning Denial of Service affecting assets.gitlab-static.net",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "high",
  "readable_substate": "Resolved",
  "created_at": "2021-04-10T19:53:30.255Z",
  "submitted_at": "2021-04-10T19:53:30.325Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "youstin",
    "url": "/youstin",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/7fa69sqmcecdvsh4bx61usmqg79r/c8a1698ff707a5e3e8a91a3484838363845daac68cb82c86d55c9e2d44d67b67"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 264,
    "url": "https://hackerone.com/gitlab",
    "handle": "gitlab",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/f0hovtq73f9ap815a0r1w42bocp4/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/f0hovtq73f9ap815a0r1w42bocp4/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "GitLab",
      "twitter_handle": "gitlab",
      "website": "https://about.gitlab.com",
      "about": "A single application for the entire software development lifecycle."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2021-12-22T23:36:26.498Z",
  "bug_reporter_agreed_on_going_public_at": "2021-12-22T23:36:26.383Z",
  "team_member_agreed_on_going_public_at": "2021-12-03T18:16:33.581Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "# Summary\n\nHi,\n\nGitlab.com is hosting JS and CSS on `https://assets.gitlab-static.net/` and uses them on gitlab.com/*\nThe static files seem to be stored on a gcp host, which by default accepts the `x-http-method-override` header. Since the CDN is using Varnish to cache files, I was able to combine the GCP behaviour and poison the cache into returning an empty resource, inherenetly causing a denial of service on gitlab.com and all gitlab assets that use the specific cdn. \n\n###  Disclaimer\n\nNo actual denial of service attack was caused troughout my testing. All the testing used cache-busters, meaning it did not affect the live website in any way.\n \n# Steps to reproduce\n\n1. Sending a request such as:\n\n```http\nGET /assets/webpack/commons-pages.admin.sessions-pages.groups.omniauth_callbacks-pages.ldap.omniauth_callbacks-pages.omn-c3aaf8c4.3f9d44ba.chunk.js HTTP/1.1\nHost: assets.gitlab-static.net\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:87.0) Gecko/20100101 Firefox/87.0\nConnection: close\n```\nwill return the expected js file. \nBy taking a quick look at the response headers, we can see the file is currently cached by varnish because of the following headers:\n```http\nAge: 498\nX-Served-By: cache-dca17752-DCA, cache-osl6520-OSL\nX-Cache: HIT, HIT\nX-Cache-Hits: 1, 1\n```\n2. In order to test cache poisoning without affecting the live website, we can add random query parameters that will act as cache busters. In order to poison a resource, an attacker would send the following request:\n\n```http\nGET /assets/webpack/commons-pages.admin.sessions-pages.groups.omniauth_callbacks-pages.ldap.omniauth_callbacks-pages.omn-c3aaf8c4.3f9d44ba.chunk.js?cb=youstin-xyz HTTP/1.1\nHost: assets.gitlab-static.net\nx-http-method-override: HEAD\n```\n\nThis will return an empty response, as it is expected from a `HEAD` request. However since the `x-http-method-override` header is not included in the cache key and the varnish configuration used does not proccess the `x-http-method-override`, this empty response will also be forwarded to all other users requesting the file, with normal GET requests. \n\n{F1260892}\n\nYou can also confirm the cache can be poisoned by visiting the file in your browser, making sure to include the parameter used as a cachebuster. You should notice the empty repsonse, typical to a HEAD request.\n\nThis vulnerability can be used on files used by the live site even if they are already cached, by making use of the PURGE http method, which clears the cache, allowing for an easily reproducible DoS attack.\n\n## Impact\n\nSince Gitlab does not forbid unauthorized users from using the PURGE http method, which clears the cache, it is possible for an attacker to clear the cache for actual JS or CSS files used on gitlab.com and poison it with an empty response. Doing so will lead to missing JS and CSS files, making gitlab completely unuseable. \nThis vulnerability affects all instances of gitlab where the cdn is used for JS and CSS files.",
  "weakness": {
    "id": 48,
    "name": "Uncontrolled Resource Consumption"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 1260892,
      "file_name": "Screenshot-20210410223924-532x502.png",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/c6bhq8c89rrj9ty94x8ixfou71c5?response-content-disposition=attachment%3B%20filename%3D%22Screenshot-20210410223924-532x502.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot-20210410223924-532x502.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQURJER4JF%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T004655Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEH8aCXVzLXdlc3QtMiJHMEUCIQCxCHubCAopuS5sT1c622J7mKsRjnVdN1TDoD9qZ6mC4gIga9rswNKd0tEdR3vF%2BaUY9%2F4iBI2o6amy8bPqGGq0HRAquwUI%2BP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDBV1E3M8E%2FTNNrDtsiqPBRzpIXhojQmU%2BFN0yP83HsenKpA2bf1qN92n8R562AwW0Y6INtXm9SFutk7QWG1pn2DH2l9rrKWGsmHVi7MAWNlsMv%2FKOE73CF2j6ywpIFTZODJ3tFS0NPG2RzY2ePz1FAwCsAW%2B32pyFdIpnawn2FJf6E0nzEdw%2FjqEP1%2FYLBSxVhUyxTWBmV55BjTCQdv%2FQ6fWgvcE3gNzPgyWTTreLm5H5e3uNSW54iiSLvca3HIEAKB9GX%2BSVpcsJaeDT03yc9WTkQ7v4%2BxF9aCQMkjZnQuEVdhOcr4RTQKWJbWd%2FBGfbAwvmuiCR2%2FjNQzN%2FGUyO8Rlz0XmSvLlWmjbakVuYB%2FGsp20Cz%2BjBNOrITj2DZwCl1EQY%2FXqpXNzFfulARmpmFyJGabsni%2BxiG7hnmLX0LVSdUpzH2KZDC8EBfFeKZX29UNnyGpAd0tTVMK2mq%2FjSiXj%2FBjLJSpgpV8EtfsA4zaw6ioNWpg8covYBxrxMS2WHr6NMifoBSqeRLi1Lxj9I2GAEuY%2F6WkO3QQyrl7EpFma2aGP8RN7K4avSM05F3wzDdztP8LSeNtXMCXD4kYdtSv8cCz0xIfXMxf3rhrU95M6Sz1THj%2Fc2DDrtKsYfE3HRrUefmOw0gBVl1LJSkQ3PnPhYDK7nTkWdtn4%2Fv5ZkYY9eGLaYdQ2MQQ0QPrwpiZcVBsI1s9it9lH3ytoEGhUUUHFzrT5zshPAKZeitEsDAAeWgqndG3qvavIo0BNUZhycNsKopaXIas94Fhr%2BKlX%2FwN%2B6a3SbkHkQVfK0723zCh8n%2FVKOUajLzrlgJfFLOfvsM%2BHZiuAW2l9PhWua4DVDRn0x7gk%2BJ2pSvnH6e5NW2Hd%2FQC%2BvAaL4fAuCr4O%2FUow99S8xgY6sQFlLDO%2Byl7F6dSnUhdT%2BvvUwfN1PIJyhdgMSMSt%2Ba8Lc%2FH5bw4ztyomzacDRvhZwdJA18WnmLlXlcCvV4ME7TrhoXAPu7%2BrD7GOwXd5tKxKivbK48g7CO7vXxi8uEaulROEQ0uN31SC3nFIqKLjeAWwhkwORnBJozLu9UekkcrPu9aW9B5on7n%2Ff9Rj%2FGxt7nfBYbmj0MqK8UI5%2Bd6XsaT3jF7wNrelKIF6jIUoLNYFGVM%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=dc139be2d53040bcc1d6a5f4dcf726da0fcbfd4b215be03b29ca06c8bdae05fb",
      "file_size": 71518,
      "type": "image/png",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": null,
  "vote_count": 80,
  "voters": [
    "tinmo",
    "monke",
    "muslimfrompk",
    "n1m0",
    "drsniper",
    "bombon",
    "youstin",
    "alp",
    "thruster",
    "arsene_lupin",
    "and 70 more..."
  ],
  "severity": {
    "rating": "high",
    "score": 7.5,
    "author_type": "User",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "none",
      "integrity": "none",
      "availability": "high"
    }
  },
  "structured_scope": {
    "databaseId": 18138,
    "asset_type": "URL",
    "asset_identifier": "gitlab.com",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "id": 117742,
      "category": "researcher",
      "content": "For more details about the vulnerability, check out:\nhttps://youst.in/posts/cache-poisoning-at-scale/",
      "updated_at": "2021-12-22T23:32:28.049Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 1059963,
        "username": "youstin",
        "name": "iustin",
        "bio": "17/04/2020",
        "cleared": true,
        "verified": true,
        "website": "https://youst.in",
        "location": "",
        "created_at": "2020-04-20T22:22:10.136Z",
        "url": "https://hackerone.com/youstin",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/7fa69sqmcecdvsh4bx61usmqg79r/c8a1698ff707a5e3e8a91a3484838363845daac68cb82c86d55c9e2d44d67b67",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/7fa69sqmcecdvsh4bx61usmqg79r/74790fe75ac5dbe8a5140a122388d59ebac913dcfa941f0b3a45e6cad161f9ea",
          "xtralarge": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6NTgzODExNSwicHVyIjoiYmxvYl9pZCJ9fQ==--db7e9afe8e23f0bc09449cc7533a2ebf05397f85/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGVnIiwicmVzaXplIjoiMjYweDI2MFx1MDAzZSJ9LCJwdXIiOiJ2YXJpYXRpb24ifX0=--cea846659d6dfdc215f3c0fb14f7ed8ebc9f95ef/profile.jpeg"
        }
      }
    }
  ]
}
