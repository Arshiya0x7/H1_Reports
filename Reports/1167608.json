{
  "id": 1167608,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTY3NjA4",
  "url": "https://hackerone.com/reports/1167608",
  "title": "Broken parsing of Git diff allows an attacker to inject arbitrary Ruby scripts to Casks on official taps",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "critical",
  "readable_substate": "Resolved",
  "created_at": "2021-04-18T08:08:14.704Z",
  "submitted_at": "2021-04-18T08:08:14.730Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "ryotak",
    "url": "/ryotak",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/Nb79aqy3v6SyMh8rwZZh43cu/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 19399,
    "url": "https://hackerone.com/homebrew",
    "handle": "homebrew",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/019/399/2f26b1d3c096d89ed989900225c128f670ab0ef0_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/019/399/2f26b1d3c096d89ed989900225c128f670ab0ef0_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "paused",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": false,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Homebrew",
      "twitter_handle": "MacHomebrew",
      "website": "https://brew.sh",
      "about": "The missing package manager for macOS (and Linux)"
    }
  },
  "has_bounty?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2021-04-21T11:24:49.165Z",
  "bug_reporter_agreed_on_going_public_at": "2021-04-21T11:24:49.117Z",
  "team_member_agreed_on_going_public_at": "2021-04-21T11:23:24.022Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Description\nDue to improper parsing of Git diff in [Homebrew/actions/review-cask-pr](https://github.com/Homebrew/actions/tree/336bd2aae5314f8c17c66a8319adeba99f13c093/review-cask-pr), it's possible to confuse parser to ignore additional lines.\nWhich leads injection of malicious Ruby scripts.\n\n## Root cause\n`review-cask-pr` uses the git diff file to check if the pull request is \"simple\" enough to automatically merge it.\nTo parse the git diff file, it uses [`git_diff`](https://github.com/anolson/git_diff/) gem with some modifications.\nhttps://github.com/Homebrew/actions/blob/master/review-cask-pr/git_diff_extension.rb\nSince `git_diff` has a small bug that allows a crafted diff file to confuse additions as a `a_path`, it's possible to confuse `review-cask-pr`.\nhttps://github.com/anolson/git_diff/blob/21913c2a51661449a7250cc3a5ba5f5f4f128959/lib/git_diff/file.rb#L61-L62\n\n## Steps to reproduce\n1. Fork [Homebrew/homebrew-cask](https://github.com/Homebrew/homebrew-cask).\n2. Modify a cask file to add following lines:\n```ruby\n++ \"b/#{puts 'Going to report it - RyotaK (https://hackeorne.com/ryotak)';b = 1;Casks = 1;iterm2 = {};iterm2.define_singleton_method(:rb) do 1 end}\"\n++ b/Casks/iterm2.rb\n```\n3. Open a pull request on [Homebrew/homebrew-cask](https://github.com/Homebrew/homebrew-cask).\n4. BrewTestBot will approve these changes.\n\nhttps://github.com/Homebrew/homebrew-cask/pull/104191\n\n## Impact\n\nInjected script will be evaluated once someone installed the cask, which may allows remote code execution.",
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2021-05-21T11:23:24.133Z",
  "allow_singular_disclosure_after": -136828027.72290477,
  "singular_disclosure_allowed": true,
  "vote_count": 49,
  "voters": [
    "mokusou",
    "arist0phanes",
    "ian",
    "ola0",
    "pudsec",
    "dee-see",
    "battle_angel",
    "nagli",
    "w31rd0",
    "nikitastupin",
    "and 39 more..."
  ],
  "severity": {
    "rating": "critical",
    "author_type": "User"
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 44217,
      "category": "team",
      "content": "https://brew.sh/2021/04/21/security-incident-disclosure/",
      "updated_at": "2021-04-21T11:15:36.530Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 152571,
        "username": "mikemcquaid",
        "name": "Mike McQuaid",
        "bio": "Homebrew Project Leader.",
        "cleared": false,
        "verified": false,
        "website": "https://mikemcquaid.com",
        "location": "Edinburgh, Scotland",
        "created_at": "2017-03-21T08:51:16.977Z",
        "url": "https://hackerone.com/mikemcquaid",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/rwqfvd8y58p42weq9cq5q3j52jij/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef?response-content-disposition=inline%3B%20filename%3D%22Me.jpg%22%3B%20filename%2A%3DUTF-8%27%27Me.jpg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQVNBPDR7O%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T031031Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDSr2j0ANL%2FfAcmIbuIFEIi9OJ%2FVFZT8wrecZEVdmYHEAiEAgP3zlhzHVDlq%2BCJzOWJ3UUwbsLBCc%2FPD%2Ba0XriD4giYquwUI%2Bv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDMLk2GWuCcI%2BMVYOXSqPBd9luZyoHF9b%2BDdxp%2FY%2BFcX9%2Fc4eX8y870FeL1mI5z6xjbVHQwZad%2Bylag09vnTVGjL5XVWRtK196nvD5fcSaNU5%2B%2BSTqRBpb7DH%2Bda1FamYaWZ7x68jxRzoKwomxLPZcx7FzFrmt3JfiAO7%2BC6Bu4ktEJxsC8X5ZYCXLK9pbjCw3%2BjmPJ4x6L9YwNBcz3jWAB9ovqT4faEZKFeGree2ccVladldjw%2FwOEYS3mDD0yFI%2BZ8PlR9RxiMTbQW7LX7yi5I0r8sduHZl9INKIIiuBk1yyLeMtXXrnGZtEAdtcMlB2%2BiaP0PuUjKTktZywnpycqWd9748l61feLRE3xaj0BbSHouwQEvs5Tu3w3mwXuUDUP8Zbf2bkiCOKA7NwFAIKf2QguxHLWTnMLgl41tp1YDqxrkJ9EXcva212Slyrb7S2722tf92zgVj8iXtVAGD0fPo9ouf3iDz9Ck20pdK1J%2BsIdGifZwUPEBAlCIkKL0M1Eh3q2mHvnqPlLxKrFqiyGd2IlAOiZZq5tzQ50Y4n96Bf%2BmvRtPenDf0LlngGY3iH0liD0iQKLN9bW5GIg2B11Iy29hTboWNAFONqboYqWFvBqT8O9Lb7%2FcVy%2FheIZf0JJ6swTFEYqo0qLXFpqpX639a2FH9i9i3%2BaW1LWoOhIpsANTLrkud8OiiYaTywDVLZvKS32OX3jDm4n%2FjWaPGP6H767lCoKDmzaBPoRsykxYV2UOZ%2B2Nw3B%2F6O4Q4slp1Q03jgO9isFzBds1vuWuVwd8cX49erKNOLbyoe%2BrxWs0R48b6a7XDFHj3QHPoyPt726Y4V12nONi6Dh2K6Bp3S7YOla19XgsKYKEQRlPGAsOcIzb%2FpIJ%2B6fFVQ0TRt50wgZG9xgY6sQEw3KOjzD4f511fXPvvYjT8%2FU70VQ9yGcEGk4jeTchqUM%2BuL%2FTHWOge5DnafJzX0m8ZW%2BFm1XIfCGT%2B6YsL52OQudQlbs6zRMwxetinv2S%2Fb%2BBtg8Frn2uaiAKqDIC2S7%2FNZHaYNeszGbOb582XMHQeCXgStpFcaGFNyndoY3I8YxcqnEy9VXxBGcqObRH7XcG%2B%2F9www5LogunQ%2FfQ3BW%2F%2B7%2FakkNfttDxEyu%2BuYJWHgio%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=33f8d03a99adf8c4c42bdf12502fb2684cf8b92f0bf061eb07f01e67aaaa9fc4",
          "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/rwqfvd8y58p42weq9cq5q3j52jij/d9695107bfcd68eeb1c9e0912b109cdae9a6c00c0bda6fd4cbd6d9bdb828840a?response-content-disposition=inline%3B%20filename%3D%22Me.jpg%22%3B%20filename%2A%3DUTF-8%27%27Me.jpg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQVNBPDR7O%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T031031Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIDSr2j0ANL%2FfAcmIbuIFEIi9OJ%2FVFZT8wrecZEVdmYHEAiEAgP3zlhzHVDlq%2BCJzOWJ3UUwbsLBCc%2FPD%2Ba0XriD4giYquwUI%2Bv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDMLk2GWuCcI%2BMVYOXSqPBd9luZyoHF9b%2BDdxp%2FY%2BFcX9%2Fc4eX8y870FeL1mI5z6xjbVHQwZad%2Bylag09vnTVGjL5XVWRtK196nvD5fcSaNU5%2B%2BSTqRBpb7DH%2Bda1FamYaWZ7x68jxRzoKwomxLPZcx7FzFrmt3JfiAO7%2BC6Bu4ktEJxsC8X5ZYCXLK9pbjCw3%2BjmPJ4x6L9YwNBcz3jWAB9ovqT4faEZKFeGree2ccVladldjw%2FwOEYS3mDD0yFI%2BZ8PlR9RxiMTbQW7LX7yi5I0r8sduHZl9INKIIiuBk1yyLeMtXXrnGZtEAdtcMlB2%2BiaP0PuUjKTktZywnpycqWd9748l61feLRE3xaj0BbSHouwQEvs5Tu3w3mwXuUDUP8Zbf2bkiCOKA7NwFAIKf2QguxHLWTnMLgl41tp1YDqxrkJ9EXcva212Slyrb7S2722tf92zgVj8iXtVAGD0fPo9ouf3iDz9Ck20pdK1J%2BsIdGifZwUPEBAlCIkKL0M1Eh3q2mHvnqPlLxKrFqiyGd2IlAOiZZq5tzQ50Y4n96Bf%2BmvRtPenDf0LlngGY3iH0liD0iQKLN9bW5GIg2B11Iy29hTboWNAFONqboYqWFvBqT8O9Lb7%2FcVy%2FheIZf0JJ6swTFEYqo0qLXFpqpX639a2FH9i9i3%2BaW1LWoOhIpsANTLrkud8OiiYaTywDVLZvKS32OX3jDm4n%2FjWaPGP6H767lCoKDmzaBPoRsykxYV2UOZ%2B2Nw3B%2F6O4Q4slp1Q03jgO9isFzBds1vuWuVwd8cX49erKNOLbyoe%2BrxWs0R48b6a7XDFHj3QHPoyPt726Y4V12nONi6Dh2K6Bp3S7YOla19XgsKYKEQRlPGAsOcIzb%2FpIJ%2B6fFVQ0TRt50wgZG9xgY6sQEw3KOjzD4f511fXPvvYjT8%2FU70VQ9yGcEGk4jeTchqUM%2BuL%2FTHWOge5DnafJzX0m8ZW%2BFm1XIfCGT%2B6YsL52OQudQlbs6zRMwxetinv2S%2Fb%2BBtg8Frn2uaiAKqDIC2S7%2FNZHaYNeszGbOb582XMHQeCXgStpFcaGFNyndoY3I8YxcqnEy9VXxBGcqObRH7XcG%2B%2F9www5LogunQ%2FfQ3BW%2F%2B7%2FakkNfttDxEyu%2BuYJWHgio%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=5008ed5a477f700eb125e1c0008c042e34c1f8d9433cdb880b403a735e3fb837",
          "xtralarge": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MTQzOTc2OCwicHVyIjoiYmxvYl9pZCJ9fQ==--7664d49db5d94203201245a53de0125bb0940e4a/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGciLCJyZXNpemUiOiIyNjB4MjYwXHUwMDNlIn0sInB1ciI6InZhcmlhdGlvbiJ9fQ==--cf3aeca803d1baf476958c689ca7b472a4cb54f1/Me.jpg"
        }
      }
    },
    {
      "id": 44218,
      "category": "researcher",
      "content": "https://blog.ryotak.me/post/homebrew-security-incident-en/",
      "updated_at": "2021-04-21T11:25:12.020Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 569456,
        "username": "ryotak",
        "name": "RyotaK",
        "bio": "",
        "cleared": true,
        "verified": true,
        "website": "https://ryotak.net",
        "location": "",
        "created_at": "2019-04-04T07:16:31.098Z",
        "url": "https://hackerone.com/ryotak",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/Nb79aqy3v6SyMh8rwZZh43cu/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/Nb79aqy3v6SyMh8rwZZh43cu/d9695107bfcd68eeb1c9e0912b109cdae9a6c00c0bda6fd4cbd6d9bdb828840a",
          "xtralarge": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6NzM1NzUyLCJwdXIiOiJibG9iX2lkIn19--4a81390f64fe60af2e81fe4aa64c3a4ccad7c709/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGciLCJyZXNpemUiOiIyNjB4MjYwXHUwMDNlIn0sInB1ciI6InZhcmlhdGlvbiJ9fQ==--cf3aeca803d1baf476958c689ca7b472a4cb54f1/drmYzeQn.jpg"
        }
      }
    }
  ]
}
