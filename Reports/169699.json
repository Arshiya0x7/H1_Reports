{
  "id": 169699,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNjk2OTk=",
  "url": "https://hackerone.com/reports/169699",
  "title": "CSRF in the \"Add restaurant picture\" function",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2016-09-16T00:08:43.021Z",
  "submitted_at": "2016-09-16T00:08:43.021Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "0xamir",
    "url": "/0xamir",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/039/124/1b521ca60048e6145df498b397f6bd086667d18f_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 2943,
    "url": "https://hackerone.com/eternal",
    "handle": "eternal",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/9525xdsq4bz7ubnoie172ssjv8ul/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/9525xdsq4bz7ubnoie172ssjv8ul/d9695107bfcd68eeb1c9e0912b109cdae9a6c00c0bda6fd4cbd6d9bdb828840a"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Eternal",
      "twitter_handle": "Zomato",
      "website": "https://www.eternal.com",
      "about": "Eternal is India’s largest new-age tech company by market cap, comprising of 4 businesses (as of now) – Zomato, Blinkit, District, & Hyperpure."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2017-09-14T22:57:21.979Z",
  "bug_reporter_agreed_on_going_public_at": "2017-08-15T22:57:02.831Z",
  "team_member_agreed_on_going_public_at": null,
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "##Overview  \nI found a CSRF vulnerability within the process responsible for adding photos for a restaurant which can lead to tricking victims into adding arbitrary photos to their restaurant's page.  \n##Details  \nThe CSRF vulnerability exists due to a misconfiguration on your part in which your `X-CSRF-TOKEN` header is set to \"Undefined\" which leads to any request being accepted and processed.  \nUploading a picture to your restaurant is a two step process, when you start the process you first have to upload a picture off your device to the server, after that you'll be presented with another form which will allow you to add any captions or descriptions you want to the photo. The misconfiguration in question resides in the first request (The photo upload request) which allows attackers to forge a picture upload request to the server, however the photo will not be added to the restaurant's page unless the second request from the second form (the captions and description form)  is also submitted.  \nIt's also worth noting that there're no CSRF protections in place on the second form.  \n##PoC  \nTo carry out a successful attack the attacker needs to obtain two values which will tie the requests to the victim's account. these values are namely `res_id` and `user_id`. After obtaining these two values (Which are publicly available for any user and restaurant) all the attacker will have to do is to fill these values in the GET parameters in the first request with the values of the victim and the `res_id` parameter in the body of the second POST request. I'll provide a PoC HTML file below in order to make it easier for you to reproduce the flaw, the PoC couldn't be included here due to the huge size of it (because the first request has the binary form of the photo being uploaded in the code itself.)  \nAfter modifying the values in the two requests, click the button that says \"Request 1\" to submit the first request and then \"Request 2\" the submit the second. By this point you can now visit the photos page in your restaurant's page and you'll find a picture of a star added there.  \n##PoC Code:  \n[You can download the exploit code from Mega.nz here](https://mega.nz/#!0wpkhLJL!Xkjm37fvqhcl7Ybp8yPBugnaRz0ruLU0eWS26icsz7s), The file is protected so there's no need to worry about accidental disclosure.  ",
  "bounty_amount": "50.0",
  "formatted_bounty": "$50",
  "weakness": {
    "id": 45,
    "name": "Cross-Site Request Forgery (CSRF)"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2017-09-14T22:57:02.876Z",
  "allow_singular_disclosure_after": -253056724.52186847,
  "singular_disclosure_allowed": true,
  "vote_count": 8,
  "voters": [
    "safehacker_2715",
    "try_to_hac",
    "malcolmx",
    "r3y",
    "eveeez",
    "ronygigi",
    "geekninja",
    "thejaguar"
  ],
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
