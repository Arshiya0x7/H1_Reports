{
  "id": 3328367,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMzI4MzY3",
  "url": "https://hackerone.com/reports/3328367",
  "title": "Path traversal via archive.extract - CVE 2021-3281 incomplete patch",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "low",
  "readable_substate": "Resolved",
  "created_at": "2025-09-05T13:21:38.349Z",
  "submitted_at": "2025-09-05T13:21:38.487Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "is_triager?": false,
  "reporter": {
    "disabled": false,
    "username": "stackered",
    "url": "/stackered",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/vw8uf97yenmngw3n4n0pjtjla2ov/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1"
    },
    "is_me?": false,
    "cleared": false,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 23,
    "url": "https://hackerone.com/django",
    "handle": "django",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/000/023/b457fd4bd71786ab14973cc3d53f9faf4d6c38ea_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/023/b457fd4bd71786ab14973cc3d53f9faf4d6c38ea_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Django",
      "twitter_handle": null,
      "website": "",
      "about": ""
    }
  },
  "has_bounty?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2021-3281"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2025-11-21T19:05:24.380Z",
  "bug_reporter_agreed_on_going_public_at": "2025-11-21T11:36:02.198Z",
  "team_member_agreed_on_going_public_at": "2025-11-21T19:05:24.218Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Hi,\n\nWhile performing a code review on previous vulnerability patches, I found that the fix for the CVE-2021-3281 is incomplete. Just as a reminder, in order to mitigate this vulnerability, the following guard logic has been added in the `extract` function of both `ZipArchive` and `TarArchive` classes to ensure that all files are extracted under the base folder (`target_path`).\n\n```python\n# django/django/utils/archive.py\ndef target_filename(self, to_path, name):\n    target_path = os.path.abspath(to_path)\n    filename = os.path.abspath(os.path.join(target_path, name))\n    if not filename.startswith(target_path):\n        raise SuspiciousOperation(\"Archive contains invalid path: '%s'\" % name)\n    return filename\n```\n\nThe `abspath` function is used to retrieve the absolute and normalized unique path. Then, the `startswith` function is leveraged to verify that the destination path is part of the intended base folder. However, the `abspath` function removes terminating path separators, which makes the guard logic protection insufficient to protect against partial-path traversal.\n\nAssuming the base folder is defined as `/var/lib/`, and the initial file name as `/var/library/test.txt`. As the trailing slash is removed, an attacker could still partially path traversal to another directory starting with the same characters since this passes the check.\n\n```python\n\"/var/library/test.txt\".startswith(\"/var/lib\") == true\n```\n\nAs an example, executing the following lines in a Python CLI does not raise the intended Exception.\n\n```\nimport os\ntarget_path = os.path.abspath(\"/var/lib/\")\nfilename = os.path.abspath(os.path.join(target_path, \"/var/library/test.txt\"))\nif not filename.startswith(target_path):\n   raise Exception\n```\n\nA real-life example of such a partial path traversal vulnerability can be found [here](https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3).\n\n## Impact\n\nThis leads to a partial-path traversal vulnerability, which allows an attacker to write files outside of the base directory when unzipping archives (tar and zip).",
  "weakness": {
    "id": 19,
    "name": "Path Traversal"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2025-12-21T11:36:02.315Z",
  "allow_singular_disclosure_after": 2564453.918030011,
  "singular_disclosure_allowed": false,
  "vote_count": 0,
  "voters": [],
  "severity": {
    "rating": "low",
    "score": 3.7,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "high",
      "privileges_required": "none",
      "user_interaction": "none",
      "scope": "unchanged",
      "confidentiality": "none",
      "integrity": "low",
      "availability": "none"
    }
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
