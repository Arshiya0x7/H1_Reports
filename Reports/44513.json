{
  "id": 44513,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NDUxMw==",
  "url": "https://hackerone.com/reports/44513",
  "title": "RCE due to Web Console IP Whitelist bypass in Rails 4.0 and 4.1",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2015-01-21T12:51:04.867Z",
  "submitted_at": "2015-01-21T12:51:04.867Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "joernchen",
    "url": "/joernchen",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 22,
    "url": "https://hackerone.com/rails",
    "handle": "rails",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Ruby on Rails",
      "twitter_handle": "rails",
      "website": "http://rubyonrails.org/security",
      "about": "Web development that doesn't hurt."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2015-06-16T19:21:46.422Z",
  "bug_reporter_agreed_on_going_public_at": "2015-06-16T19:21:46.137Z",
  "team_member_agreed_on_going_public_at": "2015-06-16T19:16:20.595Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "With the release of Ruby on Rails 4.2 the so called [Web Console](https://github.com/rails/web-console) was introduced. \r\n\r\nAs the Web Console documentation states:\r\n*Web Console is built explicitly for Rails 4.*\r\n\r\nBy default the Web Console is available in the Rails Development Environment and allows only the IPs `127.0.0.1` and `::1` to access the console in order to evaluate arbitrary Ruby statements for the purpose of debugging.\r\n\r\nHowever with Rails Versions 4.1 and 4.0 the Web Console built in IP whitelist is bypassable.\r\nThis is due to the fact that Web Console parses the `request.remote_ip` to check if the IP is whitelisted with the Ruby class `IPAddr`. The Rails stack prior to 4.2 when calculating `request.remote_ip` uses [these regular expressions](https://github.com/rails/rails/blob/4-1-stable/actionpack/lib/action_dispatch/middleware/remote_ip.rb#L31-38) to strip out trusted Proxies from the HTTP Headers `X-Forwarded-For` and `Client-IP`.\r\n\r\nDue to this parser differential an attacker might bypass the Web Console IP whitelist by supplying a HTTP header value of:\r\n\r\n`X-Forwarded-For: 0000::1` \r\n\r\nThis IPv6 address in the given notation would bypass the `TRUSTED_PROXIES` entry `^::1$` but match the `IPAddr` value of `::1` within Web Console.\r\n\r\nAs the Web Console is *intended* for debugging in the Development Environment this will most likely not affect Production setups, unless Web Console is explicitly enabled. But gaining RCE on Developer laptops might be fun as well ;).\r\n\r\nI've already sent a description of this to the Rails Security Team via mail, but I've been asked to submit here again. \r\n\r\nThe easiest mitigation of this issue would be to disallow execution of Web Console within Rails < 4.2.",
  "weakness": {
    "id": 70,
    "name": "Code Injection"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2015-07-16T19:16:20.836Z",
  "allow_singular_disclosure_after": -321494434.9655171,
  "singular_disclosure_allowed": true,
  "vote_count": 12,
  "voters": [
    "sw33tlie",
    "drsniper",
    "dee-see",
    "c1phy",
    "mattberg",
    "savitar0x01",
    "exception",
    "japz",
    "cryptographer",
    "shivammusic",
    "and 2 more..."
  ],
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 165,
      "category": "team",
      "content": "IP whitelist bypass in Web Console \n\nThere is a remote code execution vulnerability in Web Console. \nThis vulnerability has been assigned the CVE identifier CVE-2015-3224. \n\nVersions Affected:  All \nNot affected:       Environments inaccessible from remote IPs, or without Web Console enabled \nFixed Versions:     2.1.3 \n\nImpact \n------ \nSpecially crafted remote requests can spoof their origin, bypassing the IP whitelist, in any environment where Web Console is enabled (development and test, by default). \n\nUsers whose application is only accessible from localhost (as is the default behaviour in Rails 4.2) are not affected, unless a local proxy is involved. \n\nAll affected users should either upgrade or use one of the work arounds immediately. \n\nReleases \n-------- \nThe 2.1.3 release is available at the normal locations. \n\nWorkarounds \n----------- \nTo work around this issue, turn off web-console in all environments, by removing/commenting it from the application's Gemfile. \n\nPatches \n------- \nTo aid users who aren't able to upgrade immediately we have provided patches for the two supported release series.  They are in git-am format and consist of a single changeset. \n\n* 2-1-ip-whitelist.patch - Patch for 2.1 series \n\nPlease note that only the 2.1.x series is supported at present.  Users of earlier unsupported releases are advised to upgrade as soon as possible. \n\nCredits \n------- \nThis vulnerability was reported by both joernchen of Phenoelit and Ben Murphy.  Thanks to each of them for reporting the issue to us and verifying the fix. ",
      "updated_at": "2015-06-17T20:45:45.770Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 20,
        "username": "arice",
        "name": " e",
        "bio": "hackerone | internet bug bounty",
        "cleared": false,
        "verified": false,
        "website": "https://twitter.com/senorarroz",
        "location": "",
        "created_at": "2013-06-18T19:55:34.230Z",
        "url": "https://hackerone.com/arice",
        "hackerone_triager": false,
        "hackerone_employee": true,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/c8a1698ff707a5e3e8a91a3484838363845daac68cb82c86d55c9e2d44d67b67",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/000/020/83152cb2d070f3f6a63c1b61bae47257722b5ad2_original.jpeg/74790fe75ac5dbe8a5140a122388d59ebac913dcfa941f0b3a45e6cad161f9ea",
          "xtralarge": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MTM5NSwicHVyIjoiYmxvYl9pZCJ9fQ==--1d0fa1e4ca880200b9918e9bd8302a4ed7a14e4a/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGVnIiwicmVzaXplIjoiMjYweDI2MFx1MDAzZSJ9LCJwdXIiOiJ2YXJpYXRpb24ifX0=--cea846659d6dfdc215f3c0fb14f7ed8ebc9f95ef/ee40326e6dfc3a0726a7b5c97844921d.jpeg"
        }
      }
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
