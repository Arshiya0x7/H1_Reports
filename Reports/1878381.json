{
  "id": 1878381,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODc4Mzgx",
  "url": "https://hackerone.com/reports/1878381",
  "title": "CSRF protection on OIDC login is broken",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2023-02-18T11:43:16.340Z",
  "submitted_at": "2023-02-18T11:43:16.493Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "mikaelgundersen",
    "url": "/mikaelgundersen",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 13291,
    "url": "https://hackerone.com/nextcloud",
    "handle": "nextcloud",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/tnqlkt8d6fcch8hj8brdjp8nw864/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/tnqlkt8d6fcch8hj8brdjp8nw864/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Nextcloud",
      "twitter_handle": "nextclouders",
      "website": "https://nextcloud.com",
      "about": "Access, share and protect your files, calendars, contacts, communication & more at home and in your enterprise."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2023-28848"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2023-04-04T08:03:38.236Z",
  "bug_reporter_agreed_on_going_public_at": "2023-03-29T12:49:28.582Z",
  "team_member_agreed_on_going_public_at": "2023-04-04T08:03:38.159Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "To protect against CSRF the \"state\" is used in the OIDC flow. On callback this code is verified against the code stored in the session for that user. However in case the token does not match a JSON response is provided that includes the expected state. Thus making it trivial for the attacker to obtain the correct state.\n\nJudging from the code it clearly seem to be debug leftovers https://github.com/nextcloud/user_oidc/blob/main/lib/Controller/LoginController.php#L336-L344\n\nFixing the todo there should mitigate the issue and ensure the OIDC flow is more secure.\n\n\nI didn't test ID4ME. But the code is almost identical. So I assume the bug is also the same https://github.com/nextcloud/user_oidc/blob/main/lib/Controller/Id4meController.php#L175-L181\n\n## Impact\n\nThe CSRF protection provided with the state is practically useless now.",
  "bounty_amount": "500.0",
  "formatted_bounty": "$500",
  "weakness": {
    "id": 45,
    "name": "Cross-Site Request Forgery (CSRF)"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2023-04-28T12:49:28.654Z",
  "allow_singular_disclosure_after": -75716595.35098967,
  "singular_disclosure_allowed": true,
  "vote_count": 74,
  "voters": [
    "rullzer",
    "tango__mango",
    "hamidhms",
    "zy9ard3",
    "shreyaschavhan",
    "shubham_srt",
    "pr0f0x01",
    "trib0rg",
    "hunterr0x01",
    "kerolesmagdy",
    "and 64 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 4.8,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "high",
      "user_interaction": "required",
      "scope": "changed",
      "confidentiality": "low",
      "integrity": "low",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 68215,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "nextcloud/user_oidc",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 268301,
      "category": "team",
      "content": "SA: https://github.com/nextcloud/security-advisories/security/advisories/GHSA-52hv-xw32-wf7f",
      "updated_at": "2023-03-27T09:37:20.042Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 2484735,
        "username": "julien_veyssier",
        "name": "Julien Veyssier",
        "bio": null,
        "cleared": false,
        "verified": false,
        "website": null,
        "location": null,
        "created_at": "2022-10-17T09:12:12.765Z",
        "url": "https://hackerone.com/julien_veyssier",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png",
          "medium": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png",
          "xtralarge": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
        }
      }
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
