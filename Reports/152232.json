{
  "id": 152232,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTIyMzI=",
  "url": "https://hackerone.com/reports/152232",
  "title": "NULL Pointer Dereference in exif_process_user_comment",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2016-07-19T07:55:52.244Z",
  "submitted_at": "2016-07-19T07:55:52.244Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "hoangnguyen",
    "url": "/hoangnguyen",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/074/688/42c5ca5265ff965283d70fc52df2681dfd648d44_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQXYMRJIHM%2F20250922%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250922T083220Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDhKWD7Lb4wiOrYMmOLbu6%2BPuNVYmt3W0tsSqLEg%2Bt78gIgDQS1Q5Bmu2DPy7GZRHrpF7zgN1Y8YV1MqUwjZbTtDJwqsQUIKBADGgwwMTM2MTkyNzQ4NDkiDJ%2Bdl8CtYaaAHgNP5SqOBdBpTyzU9pCwrFpiHHJp8n3XZ0NnnzeRl2M3WnecFW9C7WANKwtZX7fwUGXLFlxE2J%2BeEOkRx39sXAmkJ72oftzLVNx3a5MuLXX5GUNC7TpylgTDho5Pulapv9CR5ocEzLB%2Fi73cx2prF8m5N%2Fi1gdlUZH%2BPgYO3ITOL%2Fj%2BTtmsjjy82g7n3dl8vFcLqsjwTZSsKN7PJKwwUWSpUIroHj5hQsPaHt5IVyFRit47TjWLqTSYsPAijR7sq%2FgG5nA6Vp3zNZaV6jKqkMk6EliKp%2B%2BxuCbrkI73EvVNfE6eczU3azX3ECLmnhUsBG9L3rTcFw9DAhBgwly843HPnQXN8KKqrf%2FBsfc%2FxDy9U10GK876Oq8J5e1Der0dStdSZOZYOqZC4dHs5BXdyuPuQjeiEkmpX1vdtMEToIL4Rt0XhwCyqTXjsCEByuvN0YyWN7QjVwCsBHjniqOussUnOOxs9bvSez4uN%2Fk5cnLWxz8tFXV0NqOAga2JvT1tcb2hv6WUuj2qqNF%2Fc5x2H%2BNtfIjcL0pTCDPxAh8%2BmxEJPrDOUSoNRYwJpVWKqpZNrfVwnAYF8M47M4jyan3DT1zQnEfoCXcxQ6%2BgSIFsaYYWB5K8ldwliCjleJ2q%2F2Sv%2FlnVwLWKpOb4lY1mTvvavYVKnnif9eisx86r6ms%2FdWOIVdUNCR2a4yplVMY72Q%2F3dH4tkH7ImapmBP1dv2jBO6acwHtxL8EDaWs%2F7fmv24F7lZaiG%2Fr6cYm4XdKTwhQROP7ju%2BbizG0LBOe6BJBlwU9BvtX9ykZlnmTViJ%2FHi%2F9lNDykNe%2F9bEezsXVRNr1nKStmRQP2KkzwAmlZMjcnmB4CBqJxTREcxnEf6zg5MQdX87VSPJzDD7sPGBjqxASo4wG8PBbwVU1Rsio9A4GIGPWXBU%2ByVJl7VMuDz7I2YZ8OOkuBvwASXx8XHD%2BOF9EtEbUNgLkntjS4sgMeyU%2FyJVXIapq7LQvcvx2uWPp9mpg4XxcQ4xOXBbGAJhQ0J%2FxZQfSEOprLCPs3KaEyTCDltrlVHeKMlSXjVvjTFzT56Hu9hyABHNqd4wqymCz35YfYPX3Dn%2Bv5M6x3eXUGP9kHEVR3uff0YE4AFXJdwSA3riQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=bd26a82b3a3fb8918e5064e67a2709e8321f4bd5eac5c8e7b2ac8a140719824c",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQXYMRJIHM%2F20250922%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250922T083220Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDhKWD7Lb4wiOrYMmOLbu6%2BPuNVYmt3W0tsSqLEg%2Bt78gIgDQS1Q5Bmu2DPy7GZRHrpF7zgN1Y8YV1MqUwjZbTtDJwqsQUIKBADGgwwMTM2MTkyNzQ4NDkiDJ%2Bdl8CtYaaAHgNP5SqOBdBpTyzU9pCwrFpiHHJp8n3XZ0NnnzeRl2M3WnecFW9C7WANKwtZX7fwUGXLFlxE2J%2BeEOkRx39sXAmkJ72oftzLVNx3a5MuLXX5GUNC7TpylgTDho5Pulapv9CR5ocEzLB%2Fi73cx2prF8m5N%2Fi1gdlUZH%2BPgYO3ITOL%2Fj%2BTtmsjjy82g7n3dl8vFcLqsjwTZSsKN7PJKwwUWSpUIroHj5hQsPaHt5IVyFRit47TjWLqTSYsPAijR7sq%2FgG5nA6Vp3zNZaV6jKqkMk6EliKp%2B%2BxuCbrkI73EvVNfE6eczU3azX3ECLmnhUsBG9L3rTcFw9DAhBgwly843HPnQXN8KKqrf%2FBsfc%2FxDy9U10GK876Oq8J5e1Der0dStdSZOZYOqZC4dHs5BXdyuPuQjeiEkmpX1vdtMEToIL4Rt0XhwCyqTXjsCEByuvN0YyWN7QjVwCsBHjniqOussUnOOxs9bvSez4uN%2Fk5cnLWxz8tFXV0NqOAga2JvT1tcb2hv6WUuj2qqNF%2Fc5x2H%2BNtfIjcL0pTCDPxAh8%2BmxEJPrDOUSoNRYwJpVWKqpZNrfVwnAYF8M47M4jyan3DT1zQnEfoCXcxQ6%2BgSIFsaYYWB5K8ldwliCjleJ2q%2F2Sv%2FlnVwLWKpOb4lY1mTvvavYVKnnif9eisx86r6ms%2FdWOIVdUNCR2a4yplVMY72Q%2F3dH4tkH7ImapmBP1dv2jBO6acwHtxL8EDaWs%2F7fmv24F7lZaiG%2Fr6cYm4XdKTwhQROP7ju%2BbizG0LBOe6BJBlwU9BvtX9ykZlnmTViJ%2FHi%2F9lNDykNe%2F9bEezsXVRNr1nKStmRQP2KkzwAmlZMjcnmB4CBqJxTREcxnEf6zg5MQdX87VSPJzDD7sPGBjqxASo4wG8PBbwVU1Rsio9A4GIGPWXBU%2ByVJl7VMuDz7I2YZ8OOkuBvwASXx8XHD%2BOF9EtEbUNgLkntjS4sgMeyU%2FyJVXIapq7LQvcvx2uWPp9mpg4XxcQ4xOXBbGAJhQ0J%2FxZQfSEOprLCPs3KaEyTCDltrlVHeKMlSXjVvjTFzT56Hu9hyABHNqd4wqymCz35YfYPX3Dn%2Bv5M6x3eXUGP9kHEVR3uff0YE4AFXJdwSA3riQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=58e341def3acf24ecc474861c253aecf1926e55c42bd96a3f32777832a970eb7"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2016-08-30T18:58:10.546Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2016-07-31T18:57:53.926Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "There is a bug occur in exif_process_user_comment when trying to encode JIS string.\n```\nelse if (!memcmp(szValuePtr, \"JIS\\0\\0\\0\\0\\0\", 8)) {\n\t\t\t/* JIS should be tanslated to MB or we leave it to the user - leave it to the user */\n\t\t\t*pszEncoding = estrdup((const char*)szValuePtr);\n\t\t\tszValuePtr = szValuePtr+8;\n\t\t\tByteCount -= 8;\n\t\t\t/* XXX this will fail again if encoding_converter returns on error something different than SIZE_MAX   */\n\t\t\tif (zend_multibyte_encoding_converter(\n\t\t\t\t\t(unsigned char**)pszInfoPtr,\n\t\t\t\t\t&len,\n\t\t\t\t\t(unsigned char*)szValuePtr,\n\t\t\t\t\tByteCount,\n\t\t\t\t\tzend_multibyte_fetch_encoding(ImageInfo->encode_jis),\n\t\t\t\t\tzend_multibyte_fetch_encoding(ImageInfo->motorola_intel ? ImageInfo->decode_jis_be : ImageInfo->decode_jis_le)\n\t\t\t\t\t) == (size_t)-1) {\n\t\t\t\tlen = exif_process_string_raw(pszInfoPtr, szValuePtr, ByteCount);\n\t\t\t}\n\t\t\treturn len;\n```\nAs you can see at function call zend_multibyte_fetch_encoding(ImageInfo->encode_jis). At PHP_INI_BEGIN encode_jis was set at empty string so that the result of this call above return NULL and then pass to zend_multibyte_encoding_converter. If this php version is compiled with *mbstring*, this NULL pointer is passed to mbfl_buffer_converter_new2 through *to* pointer.\n```\nmbfl_buffer_converter_new2(\n\tconst mbfl_encoding *from,\n\tconst mbfl_encoding *to,\n    int buf_initsz)\n{\n    ******SNIP********\n\t/* initialize */\n\tconvd->from = from;\n\tconvd->to = to;\n\t/* create convert filter */\n\tconvd->filter1 = NULL;\n\tconvd->filter2 = NULL;\n\tif (mbfl_convert_filter_get_vtbl(convd->from->no_encoding, convd->to->no_encoding) != NULL) {\n    ******SNIP********\n```\n\nBecause of none checking 2 pointers *from* and *to* so NULL pointer is passed directly to convd->to and result is the crash when calling mbfl_convert_filter_get_vtbl.\n\nHere crash jpeg file : https://drive.google.com/file/d/0B0D1DYQpkA9URnRROVdLdG5jdFE/view?usp=sharing\n\nThis bug also works on Mac OS X and Windows.\n\nTest script:\n---------------\n```\n<?php\n\t$exif = exif_read_data('null.jpg');\n\tvar_dump($exif);\n?>\n```\nThe bug here : https://bugs.php.net/bug.php?id=72618",
  "weakness": {
    "id": 2,
    "name": "Memory Corruption - Generic"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2016-08-30T18:57:54.011Z",
  "allow_singular_disclosure_after": -285946466.2900029,
  "singular_disclosure_allowed": true,
  "vote_count": 2,
  "voters": [
    "yaworsk",
    "dyabla"
  ],
  "structured_scope": {
    "databaseId": 84120,
    "asset_type": "OTHER",
    "asset_identifier": "PHP",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
