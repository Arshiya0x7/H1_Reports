{
  "id": 361951,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNjE5NTE=",
  "url": "https://hackerone.com/reports/361951",
  "title": "Exploiting JSONP callback on /username/charts.json endpoint leads to information disclosure despite user's privacy settings",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2018-06-05T02:23:45.221Z",
  "submitted_at": "2018-06-05T02:23:45.221Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "kapytein",
    "url": "/kapytein",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/36yjb4mltb4jebgvw3esuaw059a0/c8a1698ff707a5e3e8a91a3484838363845daac68cb82c86d55c9e2d44d67b67"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 28411,
    "url": "https://hackerone.com/liberapay",
    "handle": "liberapay",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "paused",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Liberapay",
      "twitter_handle": "liberapay",
      "website": "https://liberapay.com",
      "about": "An open source platform designed to facilitate recurrent donations."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2018-06-05T15:46:23.714Z",
  "bug_reporter_agreed_on_going_public_at": "2018-06-05T15:46:23.594Z",
  "team_member_agreed_on_going_public_at": "2018-06-05T15:42:19.375Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "Hello!\n\n## Vulnerability Details\nThe `/username/charts.json` endpoint can return a JSONP callback due to the fact that `jsonp_dump` is used in the file `charts.json.spt`. It appears that the content of the JSONP request depends on the authentication of the user. If the user enabled the privacy setting which hides the receiving donation data of the user,  a 403 error will be returned **unless**  the user is authenticated.\n\nThis happens [here](https://github.com/liberapay/liberapay.com/blob/b56172c6a6382595b8cfabccf424ba182820ea0e/www/%25username/charts.json.spt#L19):\n\n```python\nif participant.hide_receiving:\n    if user != participant and not user.is_admin:\n        raise response.error(403)\n```\n\nThe vulnerable code is [here](https://github.com/liberapay/liberapay.com/blob/b56172c6a6382595b8cfabccf424ba182820ea0e/www/%25username/charts.json.spt#L85):\n\n```python\n[---] application/json via jsonp_dump\n```\n\nBasically, a `jsonp_dump` is unnecessary in this case (I did not notice a case where cross-domain requests need to be done), and it should be replaced with `json_dump` instead.\n\n## How could this be exploited?\nThis would eventually allow any site to call the JSONP callback, and receive the receiving donation data of the user, despite it's privacy settings. This will lead to unwanted information disclosure.\n\n## Proof of Concept\n```html\n<script>\nfunction rip(a) {\n\nalert(JSON.stringify(a[1]));\n\n}\n</script>\n<script src=\"https://liberapay.com/~153779/charts.json?callback=rip\"></script>\n```\n\nHost this file, visit the site authenticated and it will print out the first row in the JSON Array. If you have not received any donation through LIbrapay so far, an empty JSON array will be returned.\n\n## Impact\n\nThis will lead to unwanted information disclosure due to the fact that privacy settings of the user will be ignored.",
  "weakness": {
    "id": 18,
    "name": "Information Disclosure"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2018-07-05T15:42:19.508Z",
  "allow_singular_disclosure_after": -227672018.60384536,
  "singular_disclosure_allowed": true,
  "vote_count": 33,
  "voters": [
    "jensec",
    "drtrace",
    "sp1d3rs",
    "europa",
    "mattberg",
    "kapytein",
    "muon4",
    "mister_mime",
    "hunter",
    "yumi",
    "and 23 more..."
  ],
  "severity": {
    "rating": "medium",
    "score": 4.3,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "none",
      "user_interaction": "required",
      "scope": "unchanged",
      "confidentiality": "low",
      "integrity": "none",
      "availability": "none"
    }
  },
  "structured_scope": {
    "databaseId": 8927,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/liberapay/liberapay.com",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 7615,
      "category": "team",
      "content": "@kapytein submitted a wonderful report describing an XSSI vulnerability in liberapay.com. During the initial review, we thought that the endpoint did not disclose data from profiles that had disabled sharing details on their profiles. However, @kapytein did provide us with additional information that demonstrated leaking private data to a third-party website.",
      "updated_at": "2018-06-05T11:42:19.654Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 116374,
        "username": "edoverflow",
        "name": "Ed",
        "bio": "Web developer & security researcher. @EdOverflow",
        "cleared": false,
        "verified": false,
        "website": "https://edoverflow.com",
        "location": "",
        "created_at": "2016-10-10T17:09:21.272Z",
        "url": "https://hackerone.com/edoverflow",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/116/374/9a3cf4d62b2f507a0d33808aacbad863ec4455ac_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c",
          "xtralarge": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MTk3MDcsInB1ciI6ImJsb2JfaWQifX0=--8802c4e791a143c4840aecba85c2424170406444/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJwbmciLCJyZXNpemUiOiIyNjB4MjYwXHUwMDNlIn0sInB1ciI6InZhcmlhdGlvbiJ9fQ==--c155082ce6f9751dcb29cd6ea061a7e4d7329577/18099289.png"
        }
      }
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
