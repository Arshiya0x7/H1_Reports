{
  "id": 3302484,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zMzAyNDg0",
  "url": "https://hackerone.com/reports/3302484",
  "title": "CWE-195 in ExternalMemoryAccounter::Increase()",
  "state": "Closed",
  "substate": "informative",
  "readable_substate": "Informative",
  "created_at": "2025-08-17T12:07:55.916Z",
  "submitted_at": "2025-08-18T06:42:25.940Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "codingthunder",
    "url": "/codingthunder",
    "profile_picture_urls": {
      "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 22984,
    "url": "https://hackerone.com/nodejs",
    "handle": "nodejs",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/36bca6668139d77be42208d896968344ae7a76c55ee0f8b0f28281ccd492ff02",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/19c85a12ac35f466af1ea2b0ae853bfe5e8f057fb1d6fb62db131707bb67b30d"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Node.js",
      "twitter_handle": "nodejs",
      "website": "https://nodejs.org",
      "about": "The Node.js JavaScript Runtime"
    }
  },
  "has_bounty?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2025-08-26T06:11:30.033Z",
  "bug_reporter_agreed_on_going_public_at": "2025-08-26T06:11:29.851Z",
  "team_member_agreed_on_going_public_at": "2025-08-26T06:05:49.032Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "**Summary:**\n\nV8's `ExternalMemoryAccounter::Increase()` expects an unsigned `size_t` argument, but a signed `ssize_t` which in some cases results in garbage collection to happen during garbage collection. Here's a simplified version of what happens (full backtrace has been attached in the issue):\n```\nv8::internal::Heap::CollectAllGarbage\nGC triggered by as negative integer passed to\nv8::ExternalMemoryAccounter::Increase(v8::Isolate*, unsigned int)\ncalled by\nnode::(anonymous namespace)::CompressionStream<node::(anonymous namespace)::ZlibContext>::Close()\nduring destruction of\nnode::(anonymous namespace)::ZlibStream::~ZlibStream\nduring an active GC\nv8::internal::Heap::CollectGarbage\n```\n\nI could not produce a PoC due to limited experience with bug bounty. I believe provided these details, it is possible to do a PoC though. Also this is my first security report, so please feel free to correct me where I am wrong.\n\n**Description:**\n\n\nThis bug was introduced in the commit https://github.com/nodejs/node/commit/1d5d7b6eedb2274c9ad48b5f378598a10479e4a7 while replacing deprecated calls to `Isolate::AdjustAmountOfExternalAllocatedMemory`. However mistakenly `ExternalMemoryAccounter::Increase()` is being called instead of `ExternalMemoryAccounter::Update()`.\n\nDuring GC, native objects are being destructed by V8. This results in calling destructor for ZlibStream which calls `ExternalMemoryAccounter::Increase()` instead of `ExternalMemoryAccounter::Update()`\n\n**Suggested Fix:**\n\nThe following patch changes calls from `ExternalMemoryAccounter::Increase()` `ExternalMemoryAccounter::Update()` for passing in `ssize_t` (the patch has been prepared for the v24.6.0 tag and may not apply cleanly for other branches/main branch):\n\n```\ndiff --git a/src/node_mem-inl.h b/src/node_mem-inl.h\nindex 06871d031d3..70d28dd524b 100644\n--- a/src/node_mem-inl.h\n+++ b/src/node_mem-inl.h\n@@ -59,7 +59,7 @@ void* NgLibMemoryManager<Class, T>::ReallocImpl(void* ptr,\n     // Environment*/Isolate* parameter and call the V8 method transparently.\n     const int64_t new_size = size - previous_size;\n     manager->IncreaseAllocatedSize(new_size);\n-    manager->env()->external_memory_accounter()->Increase(\n+    manager->env()->external_memory_accounter()->Update(\n         manager->env()->isolate(), new_size);\n     *reinterpret_cast<size_t*>(mem) = size;\n     mem += sizeof(size_t);\ndiff --git a/src/node_zlib.cc b/src/node_zlib.cc\nindex c088c547539..b8617093bdf 100644\n--- a/src/node_zlib.cc\n+++ b/src/node_zlib.cc\n@@ -644,7 +644,7 @@ class CompressionStream : public AsyncWrap, public ThreadPoolWork {\n     if (report == 0) return;\n     CHECK_IMPLIES(report < 0, zlib_memory_ >= static_cast<size_t>(-report));\n     zlib_memory_ += report;\n-    AsyncWrap::env()->external_memory_accounter()->Increase(\n+    AsyncWrap::env()->external_memory_accounter()->Update(\n         AsyncWrap::env()->isolate(), report);\n   }\n\n```\n\n`ExternalMemoryAllocator::Update()` and `ExternalMemoryAllocator::Decrease()` properly takes care of not executing GC when memory is being released.\n\nThe above patch showed no regression in test cases on Linux x64 as well as Android i686\n\n## Steps To Reproduce:\n\nI could only reproduce this issue inside https://github.com/termux/termux-docker for i686 and arm architecture. Although I believe this is a real issue on other architectures as well.\n\nThis is also reproducible on arm container, but I'll go ahead with i686 as arm container requires qemu-binfmt on x86 hosts or a arm host.\n\n1. Create the container for reproduction:\n`docker run -v -it --privileged termux/termux-docker:i686`\n`docker container start <container_name>`\n\n2. Workaround for bionic on Android not supporting pid >= 2**16 on 32-bit architectures (note that privileged docker containers are required for this workaround)\n`docker exec --user root   -it \"$container_id\" bash -c \"echo 32767 > /proc/sys/kernel/pid_max\"\n`\n3.  Start the shell\n`docker exec --user system -it \"$container_id\" bash`\n\n4. Install nodejs\n```sh\npkg update\npkg install nodejs\n```\n\nI've also attached debug builds of nodejs for Android i686 before and after the suggested patch. The debs can be installed using `apt install ./path/to/nodejs.deb` after copying them to the container\n\nThe packages are built using `./scripts/run-docker.sh ./build-package -I -a i686 -d nodejs` with patches being applied from `packages/nodejs/` directory\n\n## Impact\n\nAs far as I can tell GC inside GC is not an intended behaviour in the V8 engine. In the source tree I can see checks in place to ensure that it does not happen. But at the same time I could not find any high level documentation regarding internals of V8.\n\nKnown affected platforms: Android x86 and Android arm32. I could not reproduce this bug on other architectures/platforms, although I believe this does also affect other platforms.\n\n## Supporting Material/References\n\nIssue originally reported to downstream Termux project packaging nodejs in https://github.com/termux/termux-packages/issues/25455 ",
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 4686909,
      "file_name": "full-thread-backtrace.txt",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/e684ca9r3pf2u4dq2rga76xllqku?response-content-disposition=attachment%3B%20filename%3D%22full-thread-backtrace.txt%22%3B%20filename%2A%3DUTF-8%27%27full-thread-backtrace.txt&response-content-type=text%2Fplain&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQZKWTKIFJ%2F20250826%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250826T061508Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBQaCXVzLXdlc3QtMiJIMEYCIQD4ZA0BkEJ7%2BTTOhHz%2BAgrIEIGJC5zTSIf%2BdlgQfEaAlgIhAP9HXAuKj4fVfeXLSgsUHmWwO5ODUAhMJcI7l09nVxcwKrIFCG0QAxoMMDEzNjE5Mjc0ODQ5IgwOPjyDN83hTtamJXIqjwXTVL0eLYdvPqOIW8qR26zep5PybBwSySaT8Bs45JZwyXcgmLWcH4q8njVflxyxnk5Fh%2FBeK7mSY%2BWnDLUTXA%2F9n1SbySQIDF3LuBvc%2BcBKOy1JbkO%2BD3jtYcgJnI5c9IzOdrMq0wuoN6mC9TLm0ssArRCWF5k%2BytwscisQ5%2BtuY%2BTRfc5SqZfJMeK8b6XhHRyUXrSvM4Hd%2FMaBFW%2FIDmYR1%2F70FSamh7ShEb7VEFUkJumPUAHQVrfec%2B7pqgVbH3onJDgmFOKZD9uOzFIxPFI6m7kOLakPf0L48X3biqbZ%2BAxjGBDY7dIQq6JaTpKViyHj4yl%2FCpeJeEwmLN85rQgY2AcMwsfoKRC33dC8oylxLUVvTRjR49hY17j3pMacUaRm49m2bXrMXVHXgTRqfwgYrUXZN6HWQzfCemt5fDlUUXIvlJfbu%2FOCzhwCqi0qHq9bGMPHBdj4FSkyS2xVGjcI%2F%2BaaLnxCHd7Ek7vo1NbWRBcRtTD3ol%2BYhEC7hbEEHicLOrXSrs63gmBPW6LTIM4b%2FfHqVuwZheOvq8iMqxg4kjQU8fosoFFxT3GkhyotqwPd2raPt3AJovxb68dnevqUoxFfJ0GCKA6uJKek%2BqYYfT8ujeotJCq3xz8MKHrpdfink90wUrXudrByWHWsXMKk0CDhyK%2FXdURiLb5ia2HEoPh2c3i1a8S1HagADAC8LRsmImWwx%2BOQn4Sp0pMLQE%2BsV3Lg2gYk1v%2BQ0x78OpN9RvB6%2BIh62USeL4Nt6VbflHRMS5T9vEYJQb6XTuJk3soLc4Z3LAQVL9mvZq23YD2J8ZHybu%2BiEmznvY7Nh4o1W6rKvfJWd82eXqXj%2BdHs99VBe5wdjKAj5pUTTWdtD4wHMMvktMUGOrABP95VBfEKNbt3hRVP5s%2BvdYZS%2FgGK3Psw4V%2F%2FvoByVE%2BrsmIWLwuTWLTVJs%2FPaX3yNnMbKBtAtjqnQz%2F7pdcfqBx93aLt0SG%2Bbeqjp5TFpiJ6MghjabFmU%2FkdSmMy%2BMCBmChYcftyWoKwURE4K%2FYSrrCny3hK6LcomhSAEA80oWsJslVZlckVK8EsKSVt3k3LKZTQOJQZIFD3Os51NKd1DUxrHaSto5%2FcS6QWEwKxItY%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=8cbbd2ec91f5fdecc150639513bc6d80c57a10a9307bb48e343cf8c7bf53e9d8",
      "file_size": 8777,
      "type": "text/plain",
      "moderated": null
    },
    {
      "id": 4688223,
      "file_name": "nodejs-dbg-fixed-cve_24.6.0_i686.deb",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/lnvf0ukqe7ue5xswiqgct2s9fjpt?response-content-disposition=attachment%3B%20filename%3D%22nodejs-dbg-fixed-cve_24.6.0_i686.deb%22%3B%20filename%2A%3DUTF-8%27%27nodejs-dbg-fixed-cve_24.6.0_i686.deb&response-content-type=application%2Fx-debian-package&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQZKWTKIFJ%2F20250826%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250826T061508Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBQaCXVzLXdlc3QtMiJIMEYCIQD4ZA0BkEJ7%2BTTOhHz%2BAgrIEIGJC5zTSIf%2BdlgQfEaAlgIhAP9HXAuKj4fVfeXLSgsUHmWwO5ODUAhMJcI7l09nVxcwKrIFCG0QAxoMMDEzNjE5Mjc0ODQ5IgwOPjyDN83hTtamJXIqjwXTVL0eLYdvPqOIW8qR26zep5PybBwSySaT8Bs45JZwyXcgmLWcH4q8njVflxyxnk5Fh%2FBeK7mSY%2BWnDLUTXA%2F9n1SbySQIDF3LuBvc%2BcBKOy1JbkO%2BD3jtYcgJnI5c9IzOdrMq0wuoN6mC9TLm0ssArRCWF5k%2BytwscisQ5%2BtuY%2BTRfc5SqZfJMeK8b6XhHRyUXrSvM4Hd%2FMaBFW%2FIDmYR1%2F70FSamh7ShEb7VEFUkJumPUAHQVrfec%2B7pqgVbH3onJDgmFOKZD9uOzFIxPFI6m7kOLakPf0L48X3biqbZ%2BAxjGBDY7dIQq6JaTpKViyHj4yl%2FCpeJeEwmLN85rQgY2AcMwsfoKRC33dC8oylxLUVvTRjR49hY17j3pMacUaRm49m2bXrMXVHXgTRqfwgYrUXZN6HWQzfCemt5fDlUUXIvlJfbu%2FOCzhwCqi0qHq9bGMPHBdj4FSkyS2xVGjcI%2F%2BaaLnxCHd7Ek7vo1NbWRBcRtTD3ol%2BYhEC7hbEEHicLOrXSrs63gmBPW6LTIM4b%2FfHqVuwZheOvq8iMqxg4kjQU8fosoFFxT3GkhyotqwPd2raPt3AJovxb68dnevqUoxFfJ0GCKA6uJKek%2BqYYfT8ujeotJCq3xz8MKHrpdfink90wUrXudrByWHWsXMKk0CDhyK%2FXdURiLb5ia2HEoPh2c3i1a8S1HagADAC8LRsmImWwx%2BOQn4Sp0pMLQE%2BsV3Lg2gYk1v%2BQ0x78OpN9RvB6%2BIh62USeL4Nt6VbflHRMS5T9vEYJQb6XTuJk3soLc4Z3LAQVL9mvZq23YD2J8ZHybu%2BiEmznvY7Nh4o1W6rKvfJWd82eXqXj%2BdHs99VBe5wdjKAj5pUTTWdtD4wHMMvktMUGOrABP95VBfEKNbt3hRVP5s%2BvdYZS%2FgGK3Psw4V%2F%2FvoByVE%2BrsmIWLwuTWLTVJs%2FPaX3yNnMbKBtAtjqnQz%2F7pdcfqBx93aLt0SG%2Bbeqjp5TFpiJ6MghjabFmU%2FkdSmMy%2BMCBmChYcftyWoKwURE4K%2FYSrrCny3hK6LcomhSAEA80oWsJslVZlckVK8EsKSVt3k3LKZTQOJQZIFD3Os51NKd1DUxrHaSto5%2FcS6QWEwKxItY%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=93dc755ddcc6cb5e9445f3d6245fa9c60bbec860f2a3ac7064aea0a484645ea7",
      "file_size": 167526028,
      "type": "application/x-debian-package",
      "moderated": null
    },
    {
      "id": 4688497,
      "file_name": "nodejs-dbg_24.6.0_i686.deb",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/fg8jbwoz80mhyu4v909rwap4y49b?response-content-disposition=attachment%3B%20filename%3D%22nodejs-dbg_24.6.0_i686.deb%22%3B%20filename%2A%3DUTF-8%27%27nodejs-dbg_24.6.0_i686.deb&response-content-type=application%2Fx-debian-package&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQZKWTKIFJ%2F20250826%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250826T061508Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBQaCXVzLXdlc3QtMiJIMEYCIQD4ZA0BkEJ7%2BTTOhHz%2BAgrIEIGJC5zTSIf%2BdlgQfEaAlgIhAP9HXAuKj4fVfeXLSgsUHmWwO5ODUAhMJcI7l09nVxcwKrIFCG0QAxoMMDEzNjE5Mjc0ODQ5IgwOPjyDN83hTtamJXIqjwXTVL0eLYdvPqOIW8qR26zep5PybBwSySaT8Bs45JZwyXcgmLWcH4q8njVflxyxnk5Fh%2FBeK7mSY%2BWnDLUTXA%2F9n1SbySQIDF3LuBvc%2BcBKOy1JbkO%2BD3jtYcgJnI5c9IzOdrMq0wuoN6mC9TLm0ssArRCWF5k%2BytwscisQ5%2BtuY%2BTRfc5SqZfJMeK8b6XhHRyUXrSvM4Hd%2FMaBFW%2FIDmYR1%2F70FSamh7ShEb7VEFUkJumPUAHQVrfec%2B7pqgVbH3onJDgmFOKZD9uOzFIxPFI6m7kOLakPf0L48X3biqbZ%2BAxjGBDY7dIQq6JaTpKViyHj4yl%2FCpeJeEwmLN85rQgY2AcMwsfoKRC33dC8oylxLUVvTRjR49hY17j3pMacUaRm49m2bXrMXVHXgTRqfwgYrUXZN6HWQzfCemt5fDlUUXIvlJfbu%2FOCzhwCqi0qHq9bGMPHBdj4FSkyS2xVGjcI%2F%2BaaLnxCHd7Ek7vo1NbWRBcRtTD3ol%2BYhEC7hbEEHicLOrXSrs63gmBPW6LTIM4b%2FfHqVuwZheOvq8iMqxg4kjQU8fosoFFxT3GkhyotqwPd2raPt3AJovxb68dnevqUoxFfJ0GCKA6uJKek%2BqYYfT8ujeotJCq3xz8MKHrpdfink90wUrXudrByWHWsXMKk0CDhyK%2FXdURiLb5ia2HEoPh2c3i1a8S1HagADAC8LRsmImWwx%2BOQn4Sp0pMLQE%2BsV3Lg2gYk1v%2BQ0x78OpN9RvB6%2BIh62USeL4Nt6VbflHRMS5T9vEYJQb6XTuJk3soLc4Z3LAQVL9mvZq23YD2J8ZHybu%2BiEmznvY7Nh4o1W6rKvfJWd82eXqXj%2BdHs99VBe5wdjKAj5pUTTWdtD4wHMMvktMUGOrABP95VBfEKNbt3hRVP5s%2BvdYZS%2FgGK3Psw4V%2F%2FvoByVE%2BrsmIWLwuTWLTVJs%2FPaX3yNnMbKBtAtjqnQz%2F7pdcfqBx93aLt0SG%2Bbeqjp5TFpiJ6MghjabFmU%2FkdSmMy%2BMCBmChYcftyWoKwURE4K%2FYSrrCny3hK6LcomhSAEA80oWsJslVZlckVK8EsKSVt3k3LKZTQOJQZIFD3Os51NKd1DUxrHaSto5%2FcS6QWEwKxItY%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=72bd8ad19327197f03c6095a3ac2257ad6bbd9ed5ad77c3ce4195bdd5f752ff1",
      "file_size": 167526028,
      "type": "application/x-debian-package",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": null,
  "vote_count": 0,
  "voters": [],
  "structured_scope": {
    "databaseId": 666,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/nodejs/node",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
