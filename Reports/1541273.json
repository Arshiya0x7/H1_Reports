{
  "id": 1541273,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTQxMjcz",
  "url": "https://hackerone.com/reports/1541273",
  "title": "[WiiU/Switch] Remote code execution inside the ENL library",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "high",
  "readable_substate": "Resolved",
  "created_at": "2022-04-14T11:18:42.078Z",
  "submitted_at": "2022-04-14T11:18:42.132Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "crazy_man123",
    "url": "/crazy_man123",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/8r3fqcjglboqk3hwiqm07bomd3bl/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 16634,
    "url": "https://hackerone.com/nintendo",
    "handle": "nintendo",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/016/634/999cefca933756faeeb2ea39c07557943437c94f_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/016/634/999cefca933756faeeb2ea39c07557943437c94f_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Nintendo",
      "twitter_handle": "",
      "website": "http://www.nintendo.com",
      "about": ""
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "no-content",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2023-08-11T03:34:46.574Z",
  "bug_reporter_agreed_on_going_public_at": "2022-12-24T22:49:09.674Z",
  "team_member_agreed_on_going_public_at": "2023-08-11T03:34:46.450Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "",
  "weakness": {
    "id": 3,
    "name": "Classic Buffer Overflow"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": null,
  "vote_count": 36,
  "voters": [
    "roccodev",
    "crazy_man123",
    "zy9ard3",
    "tusnj",
    "shreyaschavhan",
    "amine-sajid",
    "moshakes",
    "mehb_",
    "loulu",
    "tylergs776",
    "and 26 more..."
  ],
  "severity": {
    "rating": "high",
    "score": 7.4,
    "author_type": "Team",
    "metrics": {
      "attack_vector": "network",
      "attack_complexity": "low",
      "privileges_required": "low",
      "user_interaction": "none",
      "scope": "changed",
      "confidentiality": "low",
      "integrity": "low",
      "availability": "low"
    }
  },
  "structured_scope": {
    "databaseId": 372585,
    "asset_type": "HARDWARE",
    "asset_identifier": "Nintendo Switch applications for which Nintendo is the publisher worldwide",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 332014,
      "category": "team",
      "content": "-",
      "updated_at": "2023-08-11T03:33:38.216Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 60412,
        "username": "tattsun",
        "name": "Ramen Chevalier",
        "bio": null,
        "cleared": false,
        "verified": false,
        "website": null,
        "location": null,
        "created_at": "2016-03-11T10:24:56.230Z",
        "url": "https://hackerone.com/tattsun",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png",
          "medium": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png",
          "xtralarge": "/assets/avatars/default-14ffa99f59cd01423c64904352cc130ffcb6a802eadfd11777a54485749e60f2.png"
        }
      }
    },
    {
      "id": 331594,
      "category": "researcher",
      "content": "# Introduction\n\n**The vulnerability is fixed on all of the impacted games, the last fix was released for Splatoon 1 and Mario Kart 8 on August 3, 2023**\n\nNintendo uses its own private library called ENL, it can do matchmaking using NEX (networking library for Nintendo game servers) and communication between players is done using PIA (UDP peer-to-peer networking library) \n\nThis library is used in many Nintendo games including:\n\n- Mario Kart 8 / Mario Kart 8 Deluxe\n- Splatoon 1 / 2 / 3\n- Animal Crossing: New Horizons\n- Super Mario Maker 2\n- Nintendo Switch Sports\n\n---\n&nbsp;\n\n# How ENL works\n\n- ENL only sends packet through a Unreliable Protocol (PIA can also do reliable UDP transmission)\n- Games can register \"content transporters\" to ENL, each content transporter have a unique ID\n- Each content transporter implements its own data format\n\nA packet can contain one or more ENL messages and each message has the following format:\n\n| Type | Description |\n| -------- | ------- |\n| uint8 | Content transporter ID |\n| uint16 | Data length |\n| bytes | Data  |\n\nThere's an **End marker** marking the end of a packet:\n\n| Type | Description | Value |\n| -------- | ------- | ------- |\n| uint8 | Content transporter ID | 255 |\n| uint16 | Data length | 0 |\n\n---\n&nbsp;\n\n# The vulnerability\n\n- All of the data received and sent is handled by the **TransportManager** (i won't display any reverse engineered pseudo-code because the summary would be too long), but the logic didn't check the data or its size. (But you can expect a link to a more in-depth explanation to be added here in the future)\n\n- A \"buffer\" refers to a ``enl::Buffer``, an object with a data pointer, a size and a capacity, the content is changed using ``enl::Buffer::set(data, size)``, a simple memcpy() and it updates the \"size\" field\n\n- Prior to the fixes, this method **did not check the size was less or equal to the capacity**.\n\nHere's two of the main issues of the receive logic:\n\n- The received data could be bigger than the global receive buffer (0x442 bytes)\n- The received data could be bigger than the content transporter receive buffers (2 per player, size defined per content transporter)\n\nIn this last case, it triggers an heap overflow (to your assigned enl::Buffer, let's call it **PlayerBuffer**).\n\nAnd ~~thankfully~~ the data right after each of the receive buffers is a pointer to a enl::Buffer (let's call it **MagicBuffer**), so if you could guess the address or overwrite the bottom bytes of this pointer (Switch is Little Endian, and WiiU has no ASLR :P), you could redirect it to controlled data, and craft a enl::Buffer entry.\n\nAdditional logic would then trigger a copy of the data from the **PlayerBuffer** to the **MagicBuffer** (so, to an address you control), so if for example it's a stack address, you can do ROP, thus making it a **Remote Code Execution** vulnerability\n\n**NOTE:** Remote Code Execution was only demonstrated to Nintendo for Mario Kart 8 on the Wii U\n\n---\n&nbsp;\n\n# Impact\n\n- Remote code execution and/or denial of service, chained with other vulnerabilities, a malicious actor could gain full access to the device\n\n{F2591101}",
      "updated_at": "2023-08-11T03:50:09.385Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [
        {
          "id": 2591101,
          "filename": "thumbsup.jpg",
          "size": 88884,
          "type": "image/jpeg",
          "url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/as8457wt7ul30itrt6kd3njlstbc?response-content-disposition=attachment%3B%20filename%3D%22thumbsup.jpg%22%3B%20filename%2A%3DUTF-8%27%27thumbsup.jpg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQUEFNBZDO%2F20250920%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250920T202803Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHsaCXVzLXdlc3QtMiJHMEUCIEIr2tuHJqgOgs7KEI%2FqDm60qRLCwhMTqQRGOUiOzCQnAiEA43pm6I3Q4CxIQENaTk5yNszPGrNHTI7QMRzkQa44N00quwUI9P%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDLmKB%2FalSpOKZ%2FlGZCqPBfiwzB8TGCj0nx21eeqNPpczA9w6m6GLysesNRGBY7d1q2GgoIzgyta1a%2F6po%2BcyDMMi4abv4VmDSmD%2BLh1VgOAh80SY2au9koyX7McPgyq4eGZEQhEAsGv0Qlr%2FWW6WfecuBFd6f4bZTB6EeT62XYVuI8mSB9SeWBt0UaUExk7mSnkYcPk9Jndy2Htmfz6AVQ3UHJKvHKsf8IaQd0DWI6l%2B0gP6nfJM0sWqZo5M%2B4e0PX%2Bp6TD5szHOn9U5e96dp8VbHuBO3PZUJQ1fFKDoz2vGQZ7K%2BHmQjS3Vdp1FPYw7DNbfB6FEeYV7JmpTMpl0SVTo%2BkQOlc%2BdkmjVIOuOFdeJdXEo0nXuDr23jQiOETVpT9dcB006Ff0LETKHsdJmniS1hD6kv1Wv2tZzGbNykRGiKY0Tz0zjNU51LCRtvxNLpmdxq6yZA9hMNvyoIO%2FELkBqkbWC10YbFeSA16RPQkD7jcXIIb5vfvqFD16lOi0ZU6%2F0oY%2BBbTfVqXp5pCJxot2Fe4z3utwsmWFxxauLkZw%2B75%2BPtxTKJGOIeHO7e63m7RVL0FmqzQ4dc0bIsvI0xi2eLbuxJ3K8YkIk8EFHJd5p0FhrDBKjVltmUzVIM3M%2B%2Fg4WaL5d3H45wRnuaYeORRKG7TignZjmHtBW2VVn3K3SUImdsJkWFKeoVoUrIK2d3X070EzK1wQBcyBv615ZZBNH5NkYJzRCG%2BxRU21MWriYn21dja8WGEVb93Grv5gTG0idagqmbKwwTMEGj2lMi6%2FTlEyLBOeJT%2FcKpX3%2BQHbjVd6XbJ6r%2Bu7GqEebJ69rXhsnOoirKjO%2BLMbNniWczBugfpyLOzr6oSNG%2F4vWej1jBFSjQSDRzBRSXCj%2BVJswvvm7xgY6sQF0fpYKdVX9Mva32DHTxAbjKnORY2aP99e6iSfjBUxiMyJiqYuvWvz9cwanf%2FmbR37nntuXt%2FBNY5clIRJOeHFMoNBDP7DRpToC2NXtcOV0K2GR1P5BuN%2F4do3nh91w0FwXIoObAcS3j7CCE0Qxzi%2BBDRGRJPivcr7dS4R8COgAyy2lmr5sc9MkcFQESMoRkaEJjUyIrz%2FDhuI41HNyEk0o6TZ3rLeo9%2Bncol2lgIUFXyI%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=5c2d9855f4485b1e9dafb8cd2e982ad4f76e4b061c45e500a5f8d99a0a81a05c"
        }
      ],
      "user": {
        "id": 921434,
        "username": "crazy_man123",
        "name": "Rambo6Glaz",
        "bio": "Un étudiant français",
        "cleared": false,
        "verified": false,
        "website": null,
        "location": "",
        "created_at": "2020-01-26T10:27:41.496Z",
        "url": "https://hackerone.com/crazy_man123",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/8r3fqcjglboqk3hwiqm07bomd3bl/3cb67cc78dc0cba55b102dd9eca2ee89b206d3e960be830f070583d9070b69ef",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/8r3fqcjglboqk3hwiqm07bomd3bl/d9695107bfcd68eeb1c9e0912b109cdae9a6c00c0bda6fd4cbd6d9bdb828840a",
          "xtralarge": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MjExNjI4NiwicHVyIjoiYmxvYl9pZCJ9fQ==--24b171d3dc09aa312cfcbbefe1c8c0a4a4fc7d26/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGciLCJyZXNpemUiOiIyNjB4MjYwXHUwMDNlIn0sInB1ciI6InZhcmlhdGlvbiJ9fQ==--cf3aeca803d1baf476958c689ca7b472a4cb54f1/10162905_m.jpg"
        }
      }
    }
  ]
}
