{
  "id": 2377760,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMzc3NzYw",
  "url": "https://hackerone.com/reports/2377760",
  "title": "fetch with integrity option is too lax when algorithm is specified but hash value is in incorrect",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2024-02-18T12:17:23.947Z",
  "submitted_at": "2024-02-18T12:17:24.035Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "uzlopak",
    "url": "/uzlopak",
    "profile_picture_urls": {
      "small": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MTk3MDAxMCwicHVyIjoiYmxvYl9pZCJ9fQ==--db37b8c00dfc00f98bb83579ac41788eed1a949d/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJwbmciLCJncmF2aXR5IjoiQ2VudGVyIiwicmVzaXplIjoiNjJ4NjJeIiwiY3JvcCI6IjYyeDYyKzArMCJ9LCJwdXIiOiJ2YXJpYXRpb24ifX0=--a4d91faed3dff6024dfc1a7b7f8ccc6b45e38396/100084638.png"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 22984,
    "url": "https://hackerone.com/nodejs",
    "handle": "nodejs",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/000/022/984/e600648ace4a8553247bce967d461a030aa81d49_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Node.js",
      "twitter_handle": "nodejs",
      "website": "https://nodejs.org",
      "about": "The Node.js JavaScript Runtime"
    }
  },
  "has_bounty?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [
    "CVE-2024-30261"
  ],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2024-05-03T17:41:15.961Z",
  "bug_reporter_agreed_on_going_public_at": null,
  "team_member_agreed_on_going_public_at": "2024-04-03T17:41:11.780Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "__A potential solution is attached as 0001-improve-bytesMatch.patch__\n\n**Summary:** \nI was investigating for some low hanging fruits regarding performance bottlenecks in undici, when I found this potential security issue in undici, and thus in nodejs. First I wrote a benchmark for bytesMatch and saw the following result:\n\n```sh\naras@aras-Lenovo-Legion-5-17ARH05H:~/workspace/undici$ node benchmarks/bytesMatch.mjs \ncpu: AMD Ryzen 7 4800H with Radeon Graphics\nruntime: node v21.6.2 (x64-linux)\n\nbenchmark                                    time (avg)             (min … max)       p75       p99      p999\n------------------------------------------------------------------------------- -----------------------------\nbytesMatch valid sha256 and base64        2'292 ns/iter   (2'009 ns … 9'452 ns)  2'209 ns  7'709 ns  9'452 ns\nbytesMatch invalid sha256 and base64      2'153 ns/iter   (2'013 ns … 2'306 ns)  2'209 ns  2'275 ns  2'306 ns\nbytesMatch valid sha256 and base64url       243 ns/iter       (205 ns … 318 ns)    261 ns    286 ns    301 ns\nbytesMatch invalid sha256 and base64url     245 ns/iter       (203 ns … 400 ns)    264 ns    320 ns    390 ns\n```\n\nSee attached 0001-add-benchmark.patch\n\nSo for some reason base64url was significantly faster than base64, even in the invalid case. So further investigations resulted in the finding that parseHashWithOptions in the underlying undici library is not matching base64url encoded hashes. Worse it is not matching any algorithms provided with invalid hashes. E.g. `sha256--` wont result in detecting that a sha256 hash was provided, thus skipping totally the whole SRI check.\n\nhttps://github.com/nodejs/undici/blob/e1195cbf32cb5f10f25e820d580264f24c7edc71/lib/fetch/util.js#L591\n\n\n## Steps To Reproduce:\n\nSee attached 0001-add-test.patch. It contains unit tests, which you can run against main branch.\n\n## Impact: \n\nResources which should be checked via SRI Logic are loaded nonetheless. \n\n## Supporting Material/References:\n\n  * List any additional material (e.g. screenshots, logs, references, commits, code examples, etc.).\n\n## Impact\n\nResources which should be checked via SRI Logic are loaded nonetheless.",
  "weakness": {
    "id": 57,
    "name": "Violation of Secure Design Principles"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [
    {
      "id": 3057763,
      "file_name": "0001-add-test.patch",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/y3gghkhmn2146q53vwidsrfjvvo8?response-content-disposition=attachment%3B%20filename%3D%220001-add-test.patch%22%3B%20filename%2A%3DUTF-8%27%270001-add-test.patch&response-content-type=application%2Fmbox&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ3VJ7R3GL%2F20250920%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250920T190148Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHkaCXVzLXdlc3QtMiJHMEUCID4Bv74%2FLGGAbJg2KqgFCyyLIB%2FnnAMpcaWX5h3iUUvFAiEAvh3QDobEHNY5c%2BymXe1h2IFxpeX24FwTKHOqnQY9n2AqugUI8v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDIBcg%2Fp45849bp0hRCqOBShkDx8ZqXH2y09B0r3niwOdi6v83ziVdoKv0eS2jH6TjOucKVJuwPHg%2FiUfPLIVdHDKVMVL0QsEx5jlrusWR2oZqF6v7aKJVQt6keyt9mRyoEqVrDRh3dhcfZpL1Hrq5isHT%2FDyrzYER8oqlhSkMI3OyBpyALAr6yEWcWXPwWgZHty26s8TNu3buT%2FZdyih9ddC8u4zzXFjcjYLw3MN7jGNU3doM4wWs%2Fj2jFoICSKZtdIlQjc4L5sFlzAMJy%2B3yVk5hKvBXsWaouoV9GhbxHCdB6s%2B%2FXfj47Sh6ZiBin4Bv5ijl4DUppVP0elJn8fgfzj11hI7DarkxZsK%2Buq27hhYV4cr1jeInGIZPK5DSPg7qSIWL9QIJxAsHnuuIhWeRd%2BZATtC1BC8tCBaBDedaQ8Pj1%2FBwfmFWvi5ouaPyNY7vVyIxzBRANjC2V%2F6BjuNbsoUMSnAfS9te%2F4Nhw8oJU%2FmSgEK5rgQP6GmJBG1cGl4e2WSz0YBxbvD2ukUuUnXGvI2dEHrFsvpzqt77YKYGl1hZ4oT14vgBYKjibvBa3%2FUd%2FEZfYxYFs%2BTFsQkDLBkhdZ5koJjo90fHv%2FHK5SadelOg%2FUU2XJuLbV0KeuElwhOemzNuh%2B%2FriFUdE%2BvA8bSNJVUexGBp01itxIVMCFvw1%2FRNT6Zyadsc71xnRLFdJxTj0GuKNVC9Z8J9y2N0RfjYgOaxLDcGxHjCnSinBNMaAKzv%2Bw%2F%2B3Ax25sgqBFsmp0ESM3j21ALJRi6wSCsYudSksh9HGBnAyw3UydtDGkoQ3w0wpukQkskI2a%2FV6qROAuzSSzXvTiCjZmbfi8lVdA1IrW10uDIjay8iLi%2BJ2RRDSnYizTme2pcxp2Ya2oS8DCrw7vGBjqxAfzHC5y7PUE8bIt78rThsF7ttQZaA1AU1I9coXpUQ9hMhYRSJVv88e13CqI78pnHFhQloloYx%2FoCa0s%2F8apnF91AG5Hm%2FkilrW8c50Wb62wK62uyBB4TjT8G6MWe9COqt%2Bx6EMZC4clMU1hLQaYhuLzcMWP7kbxG91lox4hfA%2FlOZ6QYVTJ%2B7XYO5sgZ0zPOxAqT35CfJVK3nXkRnYHwInwB4TZrV4zS0VCJqxS%2BPLy4pQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=50a8d107bd24dd680553fdbacd79f6255e60d6565638ad9f246fde2ba0442323",
      "file_size": 2471,
      "type": "application/mbox",
      "moderated": null
    },
    {
      "id": 3057764,
      "file_name": "0001-add-benchmark.patch",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/rvtriv8kwx9uajifbvikbk7abopc?response-content-disposition=attachment%3B%20filename%3D%220001-add-benchmark.patch%22%3B%20filename%2A%3DUTF-8%27%270001-add-benchmark.patch&response-content-type=application%2Fmbox&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ3VJ7R3GL%2F20250920%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250920T190148Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHkaCXVzLXdlc3QtMiJHMEUCID4Bv74%2FLGGAbJg2KqgFCyyLIB%2FnnAMpcaWX5h3iUUvFAiEAvh3QDobEHNY5c%2BymXe1h2IFxpeX24FwTKHOqnQY9n2AqugUI8v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDIBcg%2Fp45849bp0hRCqOBShkDx8ZqXH2y09B0r3niwOdi6v83ziVdoKv0eS2jH6TjOucKVJuwPHg%2FiUfPLIVdHDKVMVL0QsEx5jlrusWR2oZqF6v7aKJVQt6keyt9mRyoEqVrDRh3dhcfZpL1Hrq5isHT%2FDyrzYER8oqlhSkMI3OyBpyALAr6yEWcWXPwWgZHty26s8TNu3buT%2FZdyih9ddC8u4zzXFjcjYLw3MN7jGNU3doM4wWs%2Fj2jFoICSKZtdIlQjc4L5sFlzAMJy%2B3yVk5hKvBXsWaouoV9GhbxHCdB6s%2B%2FXfj47Sh6ZiBin4Bv5ijl4DUppVP0elJn8fgfzj11hI7DarkxZsK%2Buq27hhYV4cr1jeInGIZPK5DSPg7qSIWL9QIJxAsHnuuIhWeRd%2BZATtC1BC8tCBaBDedaQ8Pj1%2FBwfmFWvi5ouaPyNY7vVyIxzBRANjC2V%2F6BjuNbsoUMSnAfS9te%2F4Nhw8oJU%2FmSgEK5rgQP6GmJBG1cGl4e2WSz0YBxbvD2ukUuUnXGvI2dEHrFsvpzqt77YKYGl1hZ4oT14vgBYKjibvBa3%2FUd%2FEZfYxYFs%2BTFsQkDLBkhdZ5koJjo90fHv%2FHK5SadelOg%2FUU2XJuLbV0KeuElwhOemzNuh%2B%2FriFUdE%2BvA8bSNJVUexGBp01itxIVMCFvw1%2FRNT6Zyadsc71xnRLFdJxTj0GuKNVC9Z8J9y2N0RfjYgOaxLDcGxHjCnSinBNMaAKzv%2Bw%2F%2B3Ax25sgqBFsmp0ESM3j21ALJRi6wSCsYudSksh9HGBnAyw3UydtDGkoQ3w0wpukQkskI2a%2FV6qROAuzSSzXvTiCjZmbfi8lVdA1IrW10uDIjay8iLi%2BJ2RRDSnYizTme2pcxp2Ya2oS8DCrw7vGBjqxAfzHC5y7PUE8bIt78rThsF7ttQZaA1AU1I9coXpUQ9hMhYRSJVv88e13CqI78pnHFhQloloYx%2FoCa0s%2F8apnF91AG5Hm%2FkilrW8c50Wb62wK62uyBB4TjT8G6MWe9COqt%2Bx6EMZC4clMU1hLQaYhuLzcMWP7kbxG91lox4hfA%2FlOZ6QYVTJ%2B7XYO5sgZ0zPOxAqT35CfJVK3nXkRnYHwInwB4TZrV4zS0VCJqxS%2BPLy4pQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=0ba11b18099738354c5c96d51bcbb749a0d6bbad037a485b2c829f3c90d393eb",
      "file_size": 1485,
      "type": "application/mbox",
      "moderated": null
    },
    {
      "id": 3057767,
      "file_name": "0001-improve-bytesMatch.patch",
      "expiring_url": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/yfr73aqc6hy2ripfqobv33rzdhc4?response-content-disposition=attachment%3B%20filename%3D%220001-improve-bytesMatch.patch%22%3B%20filename%2A%3DUTF-8%27%270001-improve-bytesMatch.patch&response-content-type=application%2Fmbox&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ3VJ7R3GL%2F20250920%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250920T190148Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEHkaCXVzLXdlc3QtMiJHMEUCID4Bv74%2FLGGAbJg2KqgFCyyLIB%2FnnAMpcaWX5h3iUUvFAiEAvh3QDobEHNY5c%2BymXe1h2IFxpeX24FwTKHOqnQY9n2AqugUI8v%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDIBcg%2Fp45849bp0hRCqOBShkDx8ZqXH2y09B0r3niwOdi6v83ziVdoKv0eS2jH6TjOucKVJuwPHg%2FiUfPLIVdHDKVMVL0QsEx5jlrusWR2oZqF6v7aKJVQt6keyt9mRyoEqVrDRh3dhcfZpL1Hrq5isHT%2FDyrzYER8oqlhSkMI3OyBpyALAr6yEWcWXPwWgZHty26s8TNu3buT%2FZdyih9ddC8u4zzXFjcjYLw3MN7jGNU3doM4wWs%2Fj2jFoICSKZtdIlQjc4L5sFlzAMJy%2B3yVk5hKvBXsWaouoV9GhbxHCdB6s%2B%2FXfj47Sh6ZiBin4Bv5ijl4DUppVP0elJn8fgfzj11hI7DarkxZsK%2Buq27hhYV4cr1jeInGIZPK5DSPg7qSIWL9QIJxAsHnuuIhWeRd%2BZATtC1BC8tCBaBDedaQ8Pj1%2FBwfmFWvi5ouaPyNY7vVyIxzBRANjC2V%2F6BjuNbsoUMSnAfS9te%2F4Nhw8oJU%2FmSgEK5rgQP6GmJBG1cGl4e2WSz0YBxbvD2ukUuUnXGvI2dEHrFsvpzqt77YKYGl1hZ4oT14vgBYKjibvBa3%2FUd%2FEZfYxYFs%2BTFsQkDLBkhdZ5koJjo90fHv%2FHK5SadelOg%2FUU2XJuLbV0KeuElwhOemzNuh%2B%2FriFUdE%2BvA8bSNJVUexGBp01itxIVMCFvw1%2FRNT6Zyadsc71xnRLFdJxTj0GuKNVC9Z8J9y2N0RfjYgOaxLDcGxHjCnSinBNMaAKzv%2Bw%2F%2B3Ax25sgqBFsmp0ESM3j21ALJRi6wSCsYudSksh9HGBnAyw3UydtDGkoQ3w0wpukQkskI2a%2FV6qROAuzSSzXvTiCjZmbfi8lVdA1IrW10uDIjay8iLi%2BJ2RRDSnYizTme2pcxp2Ya2oS8DCrw7vGBjqxAfzHC5y7PUE8bIt78rThsF7ttQZaA1AU1I9coXpUQ9hMhYRSJVv88e13CqI78pnHFhQloloYx%2FoCa0s%2F8apnF91AG5Hm%2FkilrW8c50Wb62wK62uyBB4TjT8G6MWe9COqt%2Bx6EMZC4clMU1hLQaYhuLzcMWP7kbxG91lox4hfA%2FlOZ6QYVTJ%2B7XYO5sgZ0zPOxAqT35CfJVK3nXkRnYHwInwB4TZrV4zS0VCJqxS%2BPLy4pQ%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=ad686db5e25483d48902a2a6e64a085f6e3f9baf71f97efd2d317245e4cc74e3",
      "file_size": 5846,
      "type": "application/mbox",
      "moderated": null
    }
  ],
  "allow_singular_disclosure_at": "2024-05-03T17:41:12.090Z",
  "allow_singular_disclosure_after": -43636835.95076401,
  "singular_disclosure_allowed": true,
  "vote_count": 11,
  "voters": [
    "zy9ard3",
    "aecherli",
    "soohongkim123",
    "m45hrur",
    "b4sh0ne",
    "null__byte",
    "98709900",
    "8501",
    "grnmtn",
    "amr4l44",
    "and 1 more..."
  ],
  "structured_scope": {
    "databaseId": 666,
    "asset_type": "SOURCE_CODE",
    "asset_identifier": "https://github.com/nodejs/node",
    "max_severity": "critical"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
